EMgamma = 0.577215664901532860606512090082402431
M = m1+m2
mu = m1*m2/M
eta = mu/M
r = sp.sqrt(x*x+y*y+z*z)
u = 1/r
sigmastar3 = m2/m1*S1z+m1/m2*S2z
sigmastar2 = m2/m1*S1y+m1/m2*S2y
sigmastar1 = m2/m1*S1x+m1/m2*S2x
sigma3 = S1z+S2z
sigma2 = S1y+S2y
sigma1 = S1x+S2x
Skerr3 = sigma3
Skerr2 = sigma2
Skerr1 = sigma1
Skerrmag = sp.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
Skerrhat3 = Skerr3/Skerrmag
Skerrhat2 = Skerr2/Skerrmag
Skerrhat1 = Skerr1/Skerrmag
a = Skerrmag
L3 = x*p2-y*p1
L2 = z*p1-x*p3
L1 = y*p3-z*p2
Lnorm = sp.sqrt(L1*L1+L2*L2+L3*L3)
Lhat3 = L3/Lnorm
Lhat2 = L2/Lnorm
Lhat1 = L1/Lnorm
S2dotLhat = S2x*Lhat1+S2y*Lhat2+S2z*Lhat3
S1dotLhat = S1x*Lhat1+S1y*Lhat2+S1z*Lhat3
S1perp3 = S1z-S1dotLhat*Lhat3
S1perp2 = S1y-S1dotLhat*Lhat2
S1perp1 = S1x-S1dotLhat*Lhat1
S2perp3 = S2z-S2dotLhat*Lhat3
S2perp2 = S2y-S2dotLhat*Lhat2
S2perp1 = S2x-S2dotLhat*Lhat1
Sperp3 = S1perp3+S2perp3
Sperp2 = S1perp2+S2perp2
Sperp1 = S1perp1+S2perp1
n3 = z/r
n2 = y/r
n1 = x/r
lambdavec3 = Lhat1*n2-Lhat2*n3
lambdavec2 = Lhat3*n1-Lhat1*n3
lambdavec1 = Lhat2*n3-Lhat3*n2
lambdavecnorm = sp.sqrt(lambdavec1*lambdavec1+lambdavec2*lambdavec2+lambdavec3*lambdavec3)
lambdahat3 = lambdavec3/lambdavecnorm
lambdahat2 = lambdavec2/lambdavecnorm
lambdahat1 = lambdavec1/lambdavecnorm
lambdahat_dot_Skerrhat = lambdahat1*Skerrhat1+lambdahat2*Skerrhat2+lambdahat3*Skerrhat3
lambdahat_cross_Skerrhat3 = lambdahat1*Skerrhat2-lambdahat2*Skerrhat1
lambdahat_cross_Skerrhat2 = lambdahat3*Skerrhat1-lambdahat1*Skerrhat3
lambdahat_cross_Skerrhat1 = lambdahat2*Skerrhat3-lambdahat3*Skerrhat2
Skerrhat_dot_n = Skerrhat1*n1+Skerrhat2*n2+Skerrhat3*n3
cos_0_1_deg = 0.9999983800004374
sin_0_1_deg = 0.0017999990280001574
TINYDOUBLE = 1e-100
condition_lhs = 1-sp.Abs(Skerrhat_dot_n)
condition_rhs = 1e-8
greaterthan_bound = sp.Rational(1,2)*(condition_lhs-condition_rhs+sp.Abs(condition_lhs-condition_rhs))/(condition_lhs-condition_rhs-TINYDOUBLE)
lesserthan_equal_bound = sp.Rational(1,2)*(condition_lhs-condition_rhs-TINYDOUBLE-sp.Abs(condition_lhs-condition_rhs-TINYDOUBLE))/(condition_lhs-condition_rhs-TINYDOUBLE)
e31 = Skerrhat1*greaterthan_bound+(Skerrhat1*cos_0_1_deg+lambdahat_cross_Skerrhat1*sin_0_1_deg+lambdahat1*lambdahat_dot_Skerrhat*(1-cos_0_1_deg))*lesserthan_equal_bound
e32 = Skerrhat2*greaterthan_bound+(Skerrhat2*cos_0_1_deg+lambdahat_cross_Skerrhat2*sin_0_1_deg+lambdahat2*lambdahat_dot_Skerrhat*(1-cos_0_1_deg))*lesserthan_equal_bound
e33 = Skerrhat3*greaterthan_bound+(Skerrhat3*cos_0_1_deg+lambdahat_cross_Skerrhat3*sin_0_1_deg+lambdahat3*lambdahat_dot_Skerrhat*(1-cos_0_1_deg))*lesserthan_equal_bound
xi3 = e31*n2-e32*n1
xi2 = -e31*n3+e33*n1
xi1 = e32*n3-e33*n2
v3 = n1*xi2-n2*xi1
v2 = n3*xi1-n1*xi3
v1 = n2*xi3-n3*xi2
costheta = e31*n1+e32*n2+e33*n3
sin2theta = 1-costheta*costheta
xisq = sin2theta
w2 = a*a+r*r
Sigma = r*r+a*a*costheta*costheta
Dinv = 1+sp.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
Dinvprime = -u*u*(12*eta*u+6*(26-3*eta)*eta*u*u)/(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
omegatilde = 2*a*r
chi = (Skerr1*Lhat1+Skerr2*Lhat2+Skerr3*Lhat3)/(1-2*eta)+sp.Rational(1,2)*(Sperp1*Skerr1+Sperp2*Skerr2+Sperp3*Skerr3)/(Skerrmag*(1.-2.*eta))
Kchi0 = 267.788*eta*eta*eta-126.687*eta*eta+10.2573*eta+1.7336
K = -59.1658*chi*chi*chi*eta*eta*eta-0.426958*chi*chi*chi*eta+1.43659*chi*chi*chi+31.1746*chi*chi*eta*eta*eta+6.16466*chi*chi*eta*eta-1.38086*chi*chi-27.5201*chi*eta*eta*eta+17.3736*chi*eta*eta+2.26831*chi*eta-1.62045*chi+Kchi0
etaKminus1 = eta*K-1
Delta0 = K*(eta*K-2)
Delta1 = -2*etaKminus1*(K+Delta0)
Delta2 = sp.Rational(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
Delta3 = -sp.Rational(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
Delta4 = sp.Rational(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(sp.Rational(94,3)-sp.Rational(41,32)*sp.pi*sp.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
Delta5 = etaKminus1*etaKminus1*(sp.Rational(-4237,60)+sp.Rational(128,5)*EMgamma+sp.Rational(2275,512)*sp.pi*sp.pi-sp.Rational(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+sp.Rational(256,5)*sp.log(2)+(sp.Rational(41,32)*sp.pi*sp.pi-sp.Rational(221,6))*eta)
Delta5l = etaKminus1*etaKminus1*sp.Rational(64,5)
logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*sp.log(u))))))
Deltaucalib = 1+eta*(Delta0+sp.log(sp.Abs(1+logarg)))
Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*sp.log(u)))))))/(1+logarg)
Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
Deltau = sp.Abs(Deltaubar*Deltaucalib)
Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
Deltatprime = 2*r*Deltau+r*r*Deltauprime
Deltat = r*r*Deltau
Deltar = Deltat*Dinv
Deltarprime = Deltatprime*Dinv+Deltat*Dinvprime
Lambt = sp.Abs(w2*w2-a*a*Deltat*sin2theta)
csi = sp.sqrt(sp.Abs(Deltar*Deltat))/w2
csiprime = (Deltatprime*Deltar+Deltarprime*Deltat)/(2*sp.sqrt(Deltar*Deltat)*w2)-2.*r*sp.sqrt(Deltat*Deltar)/(w2*w2)
csi1 = 1+(1-sp.Abs(1-tortoise))*(csi-1)
csi2 = 1+(sp.Rational(1,2)-sp.Rational(1,2)*sp.sign(sp.Rational(3,2)-tortoise))*(csi-1)
prT = csi2*(p1*n1+p2*n2+p3*n3)
phat3 = p3-prT*(1-1/csi1)*n3
phat2 = p2-prT*(1-1/csi1)*n2
phat1 = p1-prT*(1-1/csi1)*n1
pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
pdotn = phat1*n1+phat2*n2+phat3*n3
pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
pphi = pdotxir
Qcoeff2 = 1/(Sigma*sin2theta)
Qcoeff1 = Sigma/(Lambt*sin2theta)
DrSipn2 = Deltar*pdotn*pdotn/Sigma
Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
Qminus1 = Q-1
Jtilde = sp.sqrt(Deltar)
exp2mu = Sigma
expmu = sp.sqrt(exp2mu)
Brtilde = (sp.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*sp.sqrt(Deltar*Deltat))
Btilde = sp.sqrt(Deltat)
exp2nu = Deltat*Sigma/Lambt
expnu = sp.sqrt(exp2nu)
omega = omegatilde/Lambt
omegatildeprime = 2*a
Lambtprime = 4*(a*a+r*r)*r-a*a*Deltatprime*sin2theta
mucostheta = a*a*costheta/Sigma
nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
mur = r/Sigma-1/sp.sqrt(Deltar)
nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
dSO = 147.481*chi*chi*chi*eta*eta-568.651*chi*chi*chi*eta+66.1987*chi*chi*chi-343.313*chi*chi*eta+2495.29*chi*eta*eta-44.5324
sigmacoeffTerm3 = eta*dSO*u*u*u
sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
Sstar3 = sigmastar3+Deltasigmastar3
Sstar2 = sigmastar2+Deltasigmastar2
Sstar1 = sigmastar1+Deltasigmastar1
S3 = Sstar3
S2 = Sstar2
S1 = Sstar1
Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
Sdotn = S1*n1+S2*n2+S3*n3
Sdotv = S1*v1+S2*v2+S3*v3
Sdotxi = S1*xi1+S2*xi2+S3*xi3
HdsumTerm2 = 3*Sstardotn*Sstardotn
HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
Hdsum = HdsumTerm1-HdsumTerm2
Hdcoeff = sp.Rational(1,2)/(r*r*r)
Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
Hnsradicand = 1+gammappsum+Q4
alpha = sp.sqrt(Deltat*Sigma/Lambt)
betapsum = omegatilde*pphi/Lambt
HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(sp.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+sp.sqrt(Q)))
HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(sp.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+sp.sqrt(Q))*xisq)
HssTerm1 = omega*SdotSkerrhat
Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(sp.sqrt(Q)+1)*Sdotv
HsoTerm2b = expmu*expnu*pdotxir*(2*sp.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(sp.sqrt(Q)+1)-mucostheta*pdotn*xisq-sp.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+sp.sqrt(Q))*xisq)
HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*sp.sqrt(Q)*xisq)
Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
Hd = Hdcoeff*Hdsum
Hns = betapsum+alpha*sp.sqrt(Hnsradicand)
Hs = Hso+Hss
dSS = 528.511*chi*chi*chi*eta*eta-41.0003*chi*chi*chi*eta+1161.78*chi*chi*eta*eta*eta-326.325*chi*chi*eta*eta+37.1964*chi*eta+706.958*eta*eta*eta-36.0272*eta+6.06807
Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
Hreal = sp.sqrt(1+2*eta*(sp.Abs(Heff)-1))

r_prm = (x*x_prm + y*y_prm + z*z_prm)/sp.sqrt(x**2 + y**2 + z**2)
u_prm = -r_prm/r**2
sigmastar3_prm = S1z_prm*m2/m1 + S2z_prm*m1/m2
sigmastar2_prm = S1y_prm*m2/m1 + S2y_prm*m1/m2
sigmastar1_prm = S1x_prm*m2/m1 + S2x_prm*m1/m2
sigma3_prm = S1z_prm + S2z_prm
sigma2_prm = S1y_prm + S2y_prm
sigma1_prm = S1x_prm + S2x_prm
Skerr3_prm = sigma3_prm
Skerr2_prm = sigma2_prm
Skerr1_prm = sigma1_prm
Skerrmag_prm = (Skerr1*Skerr1_prm + Skerr2*Skerr2_prm + Skerr3*Skerr3_prm)/sp.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
Skerrhat3_prm = -Skerr3*Skerrmag_prm/Skerrmag**2 + Skerr3_prm/Skerrmag
Skerrhat2_prm = -Skerr2*Skerrmag_prm/Skerrmag**2 + Skerr2_prm/Skerrmag
Skerrhat1_prm = -Skerr1*Skerrmag_prm/Skerrmag**2 + Skerr1_prm/Skerrmag
a_prm = Skerrmag_prm
L3_prm = -p1*y_prm - p1_prm*y + p2*x_prm + p2_prm*x
L2_prm = p1*z_prm + p1_prm*z - p3*x_prm - p3_prm*x
L1_prm = -p2*z_prm - p2_prm*z + p3*y_prm + p3_prm*y
Lnorm_prm = (L1*L1_prm + L2*L2_prm + L3*L3_prm)/sp.sqrt(L1**2 + L2**2 + L3**2)
Lhat3_prm = -L3*Lnorm_prm/Lnorm**2 + L3_prm/Lnorm
Lhat2_prm = -L2*Lnorm_prm/Lnorm**2 + L2_prm/Lnorm
Lhat1_prm = -L1*Lnorm_prm/Lnorm**2 + L1_prm/Lnorm
S2dotLhat_prm = Lhat1*S2x_prm + Lhat1_prm*S2x + Lhat2*S2y_prm + Lhat2_prm*S2y + Lhat3*S2z_prm + Lhat3_prm*S2z
S1dotLhat_prm = Lhat1*S1x_prm + Lhat1_prm*S1x + Lhat2*S1y_prm + Lhat2_prm*S1y + Lhat3*S1z_prm + Lhat3_prm*S1z
S1perp3_prm = -Lhat3*S1dotLhat_prm - Lhat3_prm*S1dotLhat + S1z_prm
S1perp2_prm = -Lhat2*S1dotLhat_prm - Lhat2_prm*S1dotLhat + S1y_prm
S1perp1_prm = -Lhat1*S1dotLhat_prm - Lhat1_prm*S1dotLhat + S1x_prm
S2perp3_prm = -Lhat3*S2dotLhat_prm - Lhat3_prm*S2dotLhat + S2z_prm
S2perp2_prm = -Lhat2*S2dotLhat_prm - Lhat2_prm*S2dotLhat + S2y_prm
S2perp1_prm = -Lhat1*S2dotLhat_prm - Lhat1_prm*S2dotLhat + S2x_prm
Sperp3_prm = S1perp3_prm + S2perp3_prm
Sperp2_prm = S1perp2_prm + S2perp2_prm
Sperp1_prm = S1perp1_prm + S2perp1_prm
n3_prm = z_prm/r - r_prm*z/r**2
n2_prm = y_prm/r - r_prm*y/r**2
n1_prm = x_prm/r - r_prm*x/r**2
lambdavec3_prm = Lhat1*n2_prm + Lhat1_prm*n2 - Lhat2*n3_prm - Lhat2_prm*n3
lambdavec2_prm = -Lhat1*n3_prm - Lhat1_prm*n3 + Lhat3*n1_prm + Lhat3_prm*n1
lambdavec1_prm = Lhat2*n3_prm + Lhat2_prm*n3 - Lhat3*n2_prm - Lhat3_prm*n2
lambdavecnorm_prm = (lambdavec1*lambdavec1_prm + lambdavec2*lambdavec2_prm + lambdavec3*lambdavec3_prm)/sp.sqrt(lambdavec1**2 + lambdavec2**2 + lambdavec3**2)
lambdahat3_prm = -lambdavec3*lambdavecnorm_prm/lambdavecnorm**2 + lambdavec3_prm/lambdavecnorm
lambdahat2_prm = -lambdavec2*lambdavecnorm_prm/lambdavecnorm**2 + lambdavec2_prm/lambdavecnorm
lambdahat1_prm = -lambdavec1*lambdavecnorm_prm/lambdavecnorm**2 + lambdavec1_prm/lambdavecnorm
lambdahat_dot_Skerrhat_prm = Skerrhat1*lambdahat1_prm + Skerrhat1_prm*lambdahat1 + Skerrhat2*lambdahat2_prm + Skerrhat2_prm*lambdahat2 + Skerrhat3*lambdahat3_prm + Skerrhat3_prm*lambdahat3
lambdahat_cross_Skerrhat3_prm = -Skerrhat1*lambdahat2_prm - Skerrhat1_prm*lambdahat2 + Skerrhat2*lambdahat1_prm + Skerrhat2_prm*lambdahat1
lambdahat_cross_Skerrhat2_prm = Skerrhat1*lambdahat3_prm + Skerrhat1_prm*lambdahat3 - Skerrhat3*lambdahat1_prm - Skerrhat3_prm*lambdahat1
lambdahat_cross_Skerrhat1_prm = -Skerrhat2*lambdahat3_prm - Skerrhat2_prm*lambdahat3 + Skerrhat3*lambdahat2_prm + Skerrhat3_prm*lambdahat2
Skerrhat_dot_n_prm = Skerrhat1*n1_prm + Skerrhat1_prm*n1 + Skerrhat2*n2_prm + Skerrhat2_prm*n2 + Skerrhat3*n3_prm + Skerrhat3_prm*n3
condition_lhs_prm = -Skerrhat_dot_n_prm*sp.sign(Skerrhat_dot_n)
greaterthan_bound_prm = -condition_lhs_prm*(condition_lhs/2 - condition_rhs/2 + sp.Abs(condition_lhs - condition_rhs)/2)/(-TINYDOUBLE + condition_lhs - condition_rhs)**2 + (condition_lhs_prm*sp.sign(condition_lhs - condition_rhs)/2 + condition_lhs_prm/2)/(-TINYDOUBLE + condition_lhs - condition_rhs)
lesserthan_equal_bound_prm = -condition_lhs_prm*(-TINYDOUBLE/2 + condition_lhs/2 - condition_rhs/2 - sp.Abs(TINYDOUBLE - condition_lhs + condition_rhs)/2)/(-TINYDOUBLE + condition_lhs - condition_rhs)**2 + (condition_lhs_prm*sp.sign(TINYDOUBLE - condition_lhs + condition_rhs)/2 + condition_lhs_prm/2)/(-TINYDOUBLE + condition_lhs - condition_rhs)
e31_prm = Skerrhat1*greaterthan_bound_prm + Skerrhat1_prm*greaterthan_bound + lesserthan_equal_bound*(Skerrhat1_prm*cos_0_1_deg + lambdahat1*lambdahat_dot_Skerrhat_prm*(1 - cos_0_1_deg) + lambdahat1_prm*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat1_prm*sin_0_1_deg) + lesserthan_equal_bound_prm*(Skerrhat1*cos_0_1_deg + lambdahat1*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat1*sin_0_1_deg)
e32_prm = Skerrhat2*greaterthan_bound_prm + Skerrhat2_prm*greaterthan_bound + lesserthan_equal_bound*(Skerrhat2_prm*cos_0_1_deg + lambdahat2*lambdahat_dot_Skerrhat_prm*(1 - cos_0_1_deg) + lambdahat2_prm*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat2_prm*sin_0_1_deg) + lesserthan_equal_bound_prm*(Skerrhat2*cos_0_1_deg + lambdahat2*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat2*sin_0_1_deg)
e33_prm = Skerrhat3*greaterthan_bound_prm + Skerrhat3_prm*greaterthan_bound + lesserthan_equal_bound*(Skerrhat3_prm*cos_0_1_deg + lambdahat3*lambdahat_dot_Skerrhat_prm*(1 - cos_0_1_deg) + lambdahat3_prm*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat3_prm*sin_0_1_deg) + lesserthan_equal_bound_prm*(Skerrhat3*cos_0_1_deg + lambdahat3*lambdahat_dot_Skerrhat*(1 - cos_0_1_deg) + lambdahat_cross_Skerrhat3*sin_0_1_deg)
xi3_prm = e31*n2_prm + e31_prm*n2 - e32*n1_prm - e32_prm*n1
xi2_prm = -e31*n3_prm - e31_prm*n3 + e33*n1_prm + e33_prm*n1
xi1_prm = e32*n3_prm + e32_prm*n3 - e33*n2_prm - e33_prm*n2
v3_prm = n1*xi2_prm + n1_prm*xi2 - n2*xi1_prm - n2_prm*xi1
v2_prm = -n1*xi3_prm - n1_prm*xi3 + n3*xi1_prm + n3_prm*xi1
v1_prm = n2*xi3_prm + n2_prm*xi3 - n3*xi2_prm - n3_prm*xi2
costheta_prm = e31*n1_prm + e31_prm*n1 + e32*n2_prm + e32_prm*n2 + e33*n3_prm + e33_prm*n3
sin2theta_prm = -2*costheta*costheta_prm
xisq_prm = sin2theta_prm
w2_prm = 2*a*a_prm + 2*r*r_prm
Sigma_prm = 2*a**2*costheta*costheta_prm + 2*a*a_prm*costheta**2 + 2*r*r_prm
Dinv_prm = (eta*u**2*u_prm*(156 - 18*eta) + 12*eta*u*u_prm)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)
Dinvprime_prm = -u**2*(eta*u**2*(156 - 18*eta) + 12*eta*u)*(eta*u**2*u_prm*(18*eta - 156) - 12*eta*u*u_prm)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)**2 - u**2*(eta*u*u_prm*(312 - 36*eta) + 12*eta*u_prm)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1) + u*u_prm*(-2*eta*u**2*(156 - 18*eta) - 24*eta*u)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)
omegatilde_prm = 2*a*r_prm + 2*a_prm*r
chi_prm = (Lhat1*Skerr1_prm + Lhat1_prm*Skerr1 + Lhat2*Skerr2_prm + Lhat2_prm*Skerr2 + Lhat3*Skerr3_prm + Lhat3_prm*Skerr3)/(1 - 2*eta) + (Skerr1*Sperp1_prm/2 + Skerr1_prm*Sperp1/2 + Skerr2*Sperp2_prm/2 + Skerr2_prm*Sperp2/2 + Skerr3*Sperp3_prm/2 + Skerr3_prm*Sperp3/2)/(Skerrmag*(1.0 - 2.0*eta)) + Skerrmag_prm*(-Skerr1*Sperp1/2 - Skerr2*Sperp2/2 - Skerr3*Sperp3/2)/(Skerrmag**2*(1.0 - 2.0*eta))
Delta2_prm = -2*Delta0*a*a_prm*etaKminus1**2
Delta3_prm = Delta1*Delta2_prm - 2*Delta1*a*a_prm*etaKminus1**2 - 2*Delta2_prm*etaKminus1
Delta4_prm = -Delta1**2*Delta2_prm + Delta1*(2*Delta2_prm*etaKminus1 + Delta3_prm) + Delta2*Delta2_prm - Delta2_prm*a**2*etaKminus1**2 - 2*Delta3_prm*etaKminus1 + a*a_prm*etaKminus1**2*(Delta1**2 - 2*Delta2)
Delta5_prm = etaKminus1**2*(-a**2*(-3*Delta1*Delta2_prm + 3*Delta3_prm)/3 + a*a_prm*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2_prm + 4*Delta1*Delta3_prm + 4*Delta2*Delta2_prm - 4*Delta4_prm)/(2*etaKminus1) - (-5*Delta1**3*Delta2_prm + 5*Delta1**2*Delta3_prm + 10*Delta1*Delta2*Delta2_prm - 5*Delta1*Delta4_prm - 5*Delta2*Delta3_prm - 5*Delta2_prm*Delta3)/(5*etaKminus1**2))
logarg_prm = u*(u*(Delta2_prm + u*(Delta3_prm + u*(Delta4_prm + u*(Delta5l*u_prm/u + Delta5_prm) + u_prm*(Delta5 + Delta5l*sp.log(u))) + u_prm*(Delta4 + u*(Delta5 + Delta5l*sp.log(u)))) + u_prm*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*sp.log(u))))) + u_prm*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*sp.log(u)))))) + u_prm*(Delta1 + u*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*sp.log(u))))))
Deltaucalib_prm = eta*logarg_prm*sp.sign(logarg + 1)/sp.Abs(logarg + 1)
Deltaucalibprime_prm = eta*logarg_prm*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*sp.log(u))))))/(logarg + 1)**2 - eta*u**2*(u*(2*Delta2_prm + u*(3*Delta3_prm + u*(4*Delta4_prm + u*(5*Delta5l*u_prm/u + 5*Delta5_prm) + u_prm*(5*Delta5 + 5*Delta5l*sp.log(u))) + u_prm*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*sp.log(u)))) + u_prm*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*sp.log(u))))) + u_prm*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*sp.log(u))))))/(logarg + 1) + eta*u*u_prm*(-2*Delta1 - 2*u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*sp.log(u))))))/(logarg + 1)
Deltaubar_prm = 2*a**2*u*u_prm + 2*a*a_prm*u**2 + 2*u_prm/etaKminus1
Deltaubarprime_prm = -6*a**2*u**2*u_prm - 4*a*a_prm*u**3 - 4*u*u_prm/etaKminus1
Deltau_prm = (Deltaubar*Deltaucalib_prm + Deltaubar_prm*Deltaucalib)*sp.sign(Deltaubar*Deltaucalib)
Deltauprime_prm = Deltaubar*Deltaucalibprime_prm + Deltaubarprime*Deltaucalib_prm + Deltaubarprime_prm*Deltaucalib + Deltaubar_prm*Deltaucalibprime
Deltatprime_prm = 2*Deltau*r_prm + 2*Deltauprime*r*r_prm + Deltauprime_prm*r**2 + 2*Deltau_prm*r
Deltat_prm = 2*Deltau*r*r_prm + Deltau_prm*r**2
Deltar_prm = Deltat*Dinv_prm + Deltat_prm*Dinv
Deltarprime_prm = Deltat*Dinvprime_prm + Deltatprime*Dinv_prm + Deltatprime_prm*Dinv + Deltat_prm*Dinvprime
Lambt_prm = (Deltat*a**2*sin2theta_prm + 2*Deltat*a*a_prm*sin2theta + Deltat_prm*a**2*sin2theta - 2*w2*w2_prm)*sp.sign(Deltat*a**2*sin2theta - w2**2)
csi_prm = (Deltar*Deltat_prm + Deltar_prm*Deltat)*sp.sign(Deltar*Deltat)/(2*w2*sp.sqrt(sp.Abs(Deltar*Deltat))) - w2_prm*sp.sqrt(sp.Abs(Deltar*Deltat))/w2**2
csiprime_prm = 4.0*r*w2_prm*sp.sqrt(Deltar*Deltat)/w2**3 - 2.0*r_prm*sp.sqrt(Deltar*Deltat)/w2**2 + (Deltar*Deltatprime_prm + Deltarprime*Deltat_prm + Deltarprime_prm*Deltat + Deltar_prm*Deltatprime)/(2*w2*sp.sqrt(Deltar*Deltat)) - w2_prm*(Deltar*Deltatprime + Deltarprime*Deltat)/(2*w2**2*sp.sqrt(Deltar*Deltat)) - 2.0*r*sp.sqrt(Deltar*Deltat)*(Deltar*Deltat_prm/2 + Deltar_prm*Deltat/2)/(Deltar*Deltat*w2**2) + (Deltar*Deltatprime + Deltarprime*Deltat)*(-Deltar*Deltat_prm/2 - Deltar_prm*Deltat/2)/(2*Deltar*Deltat*w2*sp.sqrt(Deltar*Deltat))
csi1_prm = csi_prm*(1 - sp.Abs(tortoise - 1))
csi2_prm = csi_prm*(1/2 - sp.sign(3/2 - tortoise)/2)
prT_prm = csi2*(n1*p1_prm + n1_prm*p1 + n2*p2_prm + n2_prm*p2 + n3*p3_prm + n3_prm*p3) + csi2_prm*(n1*p1 + n2*p2 + n3*p3)
phat3_prm = n3*prT_prm*(-1 + 1/csi1) + n3_prm*prT*(-1 + 1/csi1) + p3_prm - csi1_prm*n3*prT/csi1**2
phat2_prm = n2*prT_prm*(-1 + 1/csi1) + n2_prm*prT*(-1 + 1/csi1) + p2_prm - csi1_prm*n2*prT/csi1**2
phat1_prm = n1*prT_prm*(-1 + 1/csi1) + n1_prm*prT*(-1 + 1/csi1) + p1_prm - csi1_prm*n1*prT/csi1**2
pdotxir_prm = r*(phat1*xi1_prm + phat1_prm*xi1 + phat2*xi2_prm + phat2_prm*xi2 + phat3*xi3_prm + phat3_prm*xi3) + r_prm*(phat1*xi1 + phat2*xi2 + phat3*xi3)
pdotn_prm = n1*phat1_prm + n1_prm*phat1 + n2*phat2_prm + n2_prm*phat2 + n3*phat3_prm + n3_prm*phat3
pdotvr_prm = r*(phat1*v1_prm + phat1_prm*v1 + phat2*v2_prm + phat2_prm*v2 + phat3*v3_prm + phat3_prm*v3) + r_prm*(phat1*v1 + phat2*v2 + phat3*v3)
pphi_prm = pdotxir_prm
Qcoeff2_prm = -sin2theta_prm/(Sigma*sin2theta**2) - Sigma_prm/(Sigma**2*sin2theta)
Qcoeff1_prm = -Sigma*sin2theta_prm/(Lambt*sin2theta**2) + Sigma_prm/(Lambt*sin2theta) - Lambt_prm*Sigma/(Lambt**2*sin2theta)
DrSipn2_prm = 2*Deltar*pdotn*pdotn_prm/Sigma - Deltar*Sigma_prm*pdotn**2/Sigma**2 + Deltar_prm*pdotn**2/Sigma
Q_prm = DrSipn2_prm + 2*Qcoeff1*pdotxir*pdotxir_prm + Qcoeff1_prm*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvr_prm + Qcoeff2_prm*pdotvr**2
Qminus1_prm = Q_prm
Jtilde_prm = Deltar_prm/(2*sp.sqrt(Deltar))
exp2mu_prm = Sigma_prm
expmu_prm = exp2mu_prm/(2*sp.sqrt(exp2mu))
Brtilde_prm = (sp.sqrt(Deltar)*Deltatprime_prm - 2*Deltat_prm + Deltar_prm*Deltatprime/(2*sp.sqrt(Deltar)))/(2*sp.sqrt(Deltar*Deltat)) + (sp.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltat_prm/2 - Deltar_prm*Deltat/2)/(2*Deltar*Deltat*sp.sqrt(Deltar*Deltat))
Btilde_prm = Deltat_prm/(2*sp.sqrt(Deltat))
exp2nu_prm = Deltat*Sigma_prm/Lambt - Deltat*Lambt_prm*Sigma/Lambt**2 + Deltat_prm*Sigma/Lambt
expnu_prm = exp2nu_prm/(2*sp.sqrt(exp2nu))
omega_prm = omegatilde_prm/Lambt - Lambt_prm*omegatilde/Lambt**2
omegatildeprime_prm = 2*a_prm
Lambtprime_prm = -Deltatprime*a**2*sin2theta_prm - 2*Deltatprime*a*a_prm*sin2theta - Deltatprime_prm*a**2*sin2theta + r*(8*a*a_prm + 8*r*r_prm) + r_prm*(4*a**2 + 4*r**2)
mucostheta_prm = a**2*costheta_prm/Sigma + 2*a*a_prm*costheta/Sigma - Sigma_prm*a**2*costheta/Sigma**2
nucostheta_prm = a**2*costheta*w2*(-Deltat_prm + w2_prm)/(Lambt*Sigma) + a**2*costheta*w2_prm*(-Deltat + w2)/(Lambt*Sigma) + a**2*costheta_prm*w2*(-Deltat + w2)/(Lambt*Sigma) + a*a_prm*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigma_prm*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambt_prm*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
omegacostheta_prm = -2*Deltat*a**2*costheta*omegatilde_prm/Lambt**2 - 2*Deltat*a**2*costheta_prm*omegatilde/Lambt**2 - 4*Deltat*a*a_prm*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambt_prm*a**2*costheta*omegatilde/Lambt**3 - 2*Deltat_prm*a**2*costheta*omegatilde/Lambt**2
mur_prm = r_prm/Sigma - Sigma_prm*r/Sigma**2 + Deltar_prm/(2*Deltar**(3/2))
nur_prm = r_prm/Sigma - Sigma_prm*r/Sigma**2 + w2*(-4*Deltat*r_prm + Deltatprime*w2_prm + Deltatprime_prm*w2 - 4*Deltat_prm*r)/(2*Deltat*Lambt) + w2_prm*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambt_prm*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltat_prm*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
omegar_prm = (Lambt*omegatildeprime_prm - Lambtprime*omegatilde_prm - Lambtprime_prm*omegatilde + Lambt_prm*omegatildeprime)/Lambt**2 + Lambt_prm*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
sigmacoeffTerm3_prm = 3*dSO*eta*u**2*u_prm
sigmacoeffTerm2_prm = eta*(eta*(r*(-882*DrSipn2_prm + 204*Qminus1_prm + r*(1620*DrSipn2*DrSipn2_prm - 234*DrSipn2*Qminus1_prm - 234*DrSipn2_prm*Qminus1) + r_prm*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) + r_prm*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1))) + r*(-96*DrSipn2_prm - 436*Qminus1_prm + r*(36*DrSipn2*Qminus1_prm + 36*DrSipn2_prm*Qminus1 - 90*Qminus1*Qminus1_prm) + r_prm*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) + r_prm*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)))/(144*r**2) + eta*r_prm*(-eta*(r*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) - 336) - r*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) + 896)/(72*r**3)
sigmacoeffTerm1_prm = eta*(-3*DrSipn2_prm + Qminus1_prm/4 + 2*r_prm/(3*r**2))
sigmacoeff_prm = sigmacoeffTerm1_prm + sigmacoeffTerm2_prm + sigmacoeffTerm3_prm
sigmastarcoeffTerm2_prm = eta*(eta*(r*(-324*DrSipn2_prm + 120*Qminus1_prm + r*(720*DrSipn2*DrSipn2_prm + Qminus1*(-126*DrSipn2_prm - 3*Qminus1_prm) + Qminus1_prm*(-126*DrSipn2 - 3*Qminus1)) + r_prm*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) + r_prm*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1)))) + r*(282*DrSipn2_prm + Qminus1*r*(96*DrSipn2_prm - 23*Qminus1_prm) + Qminus1*r_prm*(96*DrSipn2 - 23*Qminus1) + Qminus1_prm*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1_prm) + r_prm*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1))/(72*r**2) + eta*r_prm*(-eta*(r*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) - 54) - r*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1) - 706)/(36*r**3)
sigmastarcoeffTerm1_prm = eta*(-5*DrSipn2_prm/2 + Qminus1_prm/3 - 7*r_prm/(6*r**2))
sigmastarcoeff_prm = sigmastarcoeffTerm1_prm + sigmastarcoeffTerm2_prm
Deltasigmastar3_prm = sigma3*sigmacoeff_prm + sigma3_prm*sigmacoeff + sigmastar3*sigmastarcoeff_prm + sigmastar3_prm*sigmastarcoeff
Deltasigmastar2_prm = sigma2*sigmacoeff_prm + sigma2_prm*sigmacoeff + sigmastar2*sigmastarcoeff_prm + sigmastar2_prm*sigmastarcoeff
Deltasigmastar1_prm = sigma1*sigmacoeff_prm + sigma1_prm*sigmacoeff + sigmastar1*sigmastarcoeff_prm + sigmastar1_prm*sigmastarcoeff
Sstar3_prm = Deltasigmastar3_prm + sigmastar3_prm
Sstar2_prm = Deltasigmastar2_prm + sigmastar2_prm
Sstar1_prm = Deltasigmastar1_prm + sigmastar1_prm
S3_prm = Sstar3_prm
S2_prm = Sstar2_prm
S1_prm = Sstar1_prm
Sstardotn_prm = Sstar1*n1_prm + Sstar1_prm*n1 + Sstar2*n2_prm + Sstar2_prm*n2 + Sstar3*n3_prm + Sstar3_prm*n3
SdotSkerrhat_prm = S1*Skerrhat1_prm + S1_prm*Skerrhat1 + S2*Skerrhat2_prm + S2_prm*Skerrhat2 + S3*Skerrhat3_prm + S3_prm*Skerrhat3
Sdotn_prm = S1*n1_prm + S1_prm*n1 + S2*n2_prm + S2_prm*n2 + S3*n3_prm + S3_prm*n3
Sdotv_prm = S1*v1_prm + S1_prm*v1 + S2*v2_prm + S2_prm*v2 + S3*v3_prm + S3_prm*v3
Sdotxi_prm = S1*xi1_prm + S1_prm*xi1 + S2*xi2_prm + S2_prm*xi2 + S3*xi3_prm + S3_prm*xi3
HdsumTerm2_prm = 6*Sstardotn*Sstardotn_prm
HdsumTerm1_prm = 2*Sstar1*Sstar1_prm + 2*Sstar2*Sstar2_prm + 2*Sstar3*Sstar3_prm
Hdsum_prm = HdsumTerm1_prm - HdsumTerm2_prm
Hdcoeff_prm = -3*r_prm/(2*r**4)
Q4_prm = eta*prT**4*u*u_prm*(16 - 12*eta) + eta*prT**3*prT_prm*u**2*(32 - 24*eta)
gammappsum_prm = 2*Deltar*pdotn*pdotn_prm/Sigma - Deltar*Sigma_prm*pdotn**2/Sigma**2 + Deltar_prm*pdotn**2/Sigma - pdotvr**2*sin2theta_prm/(Sigma*sin2theta**2) + 2*pdotvr*pdotvr_prm/(Sigma*sin2theta) - Sigma_prm*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2theta_prm/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxir_prm/(Lambt*sin2theta) + Sigma_prm*pdotxir**2/(Lambt*sin2theta) - Lambt_prm*Sigma*pdotxir**2/(Lambt**2*sin2theta)
Hnsradicand_prm = Q4_prm + gammappsum_prm
alpha_prm = Lambt*sp.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigma_prm/(2*Lambt) - Deltat*Lambt_prm*Sigma/(2*Lambt**2) + Deltat_prm*Sigma/(2*Lambt))/(Deltat*Sigma)
betapsum_prm = omegatilde*pphi_prm/Lambt + omegatilde_prm*pphi/Lambt - Lambt_prm*omegatilde*pphi/Lambt**2
HssTerm3_prm = Btilde**2*(Sdotn*exp2mu*xisq*(-Q_prm - Q_prm/(2*sp.sqrt(Q))) + Sdotn*exp2mu*xisq_prm*(-sp.sqrt(Q) - Q) + Sdotn*exp2mu_prm*xisq*(-sp.sqrt(Q) - Q) + Sdotn_prm*exp2mu*xisq*(-sp.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotn_prm - Jtilde*Sdotv_prm*pdotn - Jtilde_prm*Sdotv*pdotn + Sdotn*pdotvr_prm + Sdotn_prm*pdotvr) + pdotvr_prm*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btilde_prm*(-2*Sdotn*exp2mu*xisq*(sp.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn_prm + Btilde*Jtilde*Sdotxi_prm*pdotn + Btilde*Jtilde_prm*Sdotxi*pdotn + Btilde_prm*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir_prm - Sdotn*expmu*expnu_prm*pdotxir - Sdotn*expmu_prm*expnu*pdotxir - Sdotn_prm*expmu*expnu*pdotxir) + expmu*expnu*pdotxir_prm*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnu_prm*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu_prm*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
HssTerm3coeff_prm = omegacostheta*(-Q_prm - Q_prm/(2*sp.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(sp.sqrt(Q) + Q)**2) + omegacostheta_prm/(Btilde*exp2mu*expmu*expnu*(2*sp.sqrt(Q) + 2*Q)) - expnu_prm*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*sp.sqrt(Q) + 2*Q)) - expmu_prm*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*sp.sqrt(Q) + 2*Q)) - exp2mu_prm*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*sp.sqrt(Q) + 2*Q)) - Btilde_prm*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*sp.sqrt(Q) + 2*Q))
HssTerm2_prm = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn_prm - Jtilde*Sdotv_prm*pdotn - Jtilde_prm*Sdotv*pdotn + Sdotn*pdotvr_prm + Sdotn_prm*pdotvr) + Jtilde*pdotn_prm*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtilde_prm*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Q_prm + Q_prm/(2*sp.sqrt(Q))) + Sdotv*exp2mu_prm*(sp.sqrt(Q) + Q) + Sdotv_prm*exp2mu*(sp.sqrt(Q) + Q)) + Btilde**2*xisq_prm*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(sp.sqrt(Q) + Q)) + Btilde*Btilde_prm*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(sp.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr_prm - Btilde*Sdotxi*expnu_prm*pdotvr - Btilde*Sdotxi_prm*expnu*pdotvr - Btilde_prm*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir_prm + Sdotv*exp2nu*expmu_prm*pdotxir + Sdotv*exp2nu_prm*expmu*pdotxir + Sdotv_prm*exp2nu*expmu*pdotxir) + expmu*pdotxir_prm*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmu_prm*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
HssTerm2coeff_prm = Jtilde*omegar*(-Q_prm - Q_prm/(2*sp.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(sp.sqrt(Q) + Q)**2) - Jtilde*omegar*xisq_prm/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*sp.sqrt(Q) + 2*Q)) + Jtilde*omegar_prm/(Btilde*exp2mu*expmu*expnu*xisq*(2*sp.sqrt(Q) + 2*Q)) - Jtilde*expnu_prm*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*sp.sqrt(Q) + 2*Q)) - Jtilde*expmu_prm*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*sp.sqrt(Q) + 2*Q)) - Jtilde*exp2mu_prm*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*sp.sqrt(Q) + 2*Q)) + Jtilde_prm*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*sp.sqrt(Q) + 2*Q)) - Btilde_prm*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*sp.sqrt(Q) + 2*Q))
HssTerm1_prm = SdotSkerrhat*omega_prm + SdotSkerrhat_prm*omega
Hss_prm = HssTerm1_prm + HssTerm2*HssTerm2coeff_prm + HssTerm2coeff*HssTerm2_prm + HssTerm3*HssTerm3coeff_prm + HssTerm3coeff*HssTerm3_prm
HsoTerm2c_prm = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxir_prm*(sp.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnu_prm*pdotxir*(sp.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu_prm*expnu*pdotxir*(sp.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv_prm*expmu*expnu*pdotxir*(sp.sqrt(Q) + 1) + Brtilde*Jtilde*Q_prm*Sdotv*expmu*expnu*pdotxir/(2*sp.sqrt(Q)) + Brtilde*Jtilde_prm*Sdotv*expmu*expnu*pdotxir*(sp.sqrt(Q) + 1) + Brtilde_prm*Jtilde*Sdotv*expmu*expnu*pdotxir*(sp.sqrt(Q) + 1)
HsoTerm2b_prm = Btilde*expmu*expnu*pdotxir*(2*sp.sqrt(Q) + 1)*(Jtilde*Sdotv*nur_prm + Jtilde*Sdotv_prm*nur + Jtilde_prm*Sdotv*nur - Sdotn*nucostheta*xisq_prm - Sdotn*nucostheta_prm*xisq - Sdotn_prm*nucostheta*xisq) + Btilde*expmu*expnu*pdotxir_prm*(2*sp.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnu_prm*pdotxir*(2*sp.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu_prm*expnu*pdotxir*(2*sp.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Q_prm*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/sp.sqrt(Q) + Btilde_prm*expmu*expnu*pdotxir*(2*sp.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
HsoTerm2a_prm = Btilde**2*Jtilde*Sdotxi*(-sp.sqrt(Q)*(nur*pdotvr_prm + nur_prm*pdotvr + pdotn*xisq*(mucostheta_prm - nucostheta_prm) + pdotn*xisq_prm*(mucostheta - nucostheta) + pdotn_prm*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq_prm - mucostheta*pdotn_prm*xisq - mucostheta_prm*pdotn*xisq + mur*pdotvr_prm*(sp.sqrt(Q) + 1) + mur_prm*pdotvr*(sp.sqrt(Q) + 1) + Q_prm*mur*pdotvr/(2*sp.sqrt(Q)) + Q_prm*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*sp.sqrt(Q))) + Btilde**2*Jtilde*Sdotxi_prm*(sp.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(sp.sqrt(Q) + 1)) + Btilde**2*Jtilde_prm*Sdotxi*(sp.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(sp.sqrt(Q) + 1)) + Btilde*Btilde_prm*Jtilde*Sdotxi*(2*sp.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(sp.sqrt(Q) + 1))
HsoTerm2_prm = HsoTerm2a_prm + HsoTerm2b_prm - HsoTerm2c_prm
HsoTerm2coeff_prm = expnu*(-Q_prm - Q_prm/(2*sp.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(sp.sqrt(Q) + Q)**2) - expnu*xisq_prm/(Btilde**2*exp2mu*xisq**2*(sp.sqrt(Q) + Q)) + expnu_prm/(Btilde**2*exp2mu*xisq*(sp.sqrt(Q) + Q)) - exp2mu_prm*expnu/(Btilde**2*exp2mu**2*xisq*(sp.sqrt(Q) + Q)) - 2*Btilde_prm*expnu/(Btilde**3*exp2mu*xisq*(sp.sqrt(Q) + Q))
HsoTerm1_prm = SdotSkerrhat*exp2nu*pdotxir*(-Btilde_prm + expmu*expnu_prm + expmu_prm*expnu)/(Btilde**2*sp.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisq_prm*(Btilde - expmu*expnu)/(Btilde**2*sp.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxir_prm*(-Btilde + expmu*expnu)/(Btilde**2*sp.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmu_prm*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*sp.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nu_prm*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*sp.sqrt(Q)*expmu*xisq) + SdotSkerrhat_prm*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*sp.sqrt(Q)*expmu*xisq) - Q_prm*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btilde_prm*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*sp.sqrt(Q)*expmu*xisq)
Hso_prm = HsoTerm1_prm + HsoTerm2*HsoTerm2coeff_prm + HsoTerm2coeff*HsoTerm2_prm
Hd_prm = Hdcoeff*Hdsum_prm + Hdcoeff_prm*Hdsum
Hns_prm = sp.sqrt(Hnsradicand)*alpha_prm + betapsum_prm + Hnsradicand_prm*alpha/(2*sp.sqrt(Hnsradicand))
Hs_prm = Hso_prm + Hss_prm
Heff_prm = -Hd_prm + Hns_prm + Hs_prm + dSS*eta*u**4*(2*S1x*S1x_prm + 2*S1y*S1y_prm + 2*S1z*S1z_prm + 2*S2x*S2x_prm + 2*S2y*S2y_prm + 2*S2z*S2z_prm) + dSS*eta*u**3*u_prm*(4*S1x**2 + 4*S1y**2 + 4*S1z**2 + 4*S2x**2 + 4*S2y**2 + 4*S2z**2)
Hreal_prm = Heff_prm*eta*sp.sign(Heff)/sp.sqrt(eta*(2*sp.Abs(Heff) - 2) + 1)
