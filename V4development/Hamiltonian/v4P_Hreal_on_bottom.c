#include math.h 
float compute_v4P_Hreal(float m1,float m2,INT tortoise,float x,float y,float z,float p1,float p2,float p3,float S1x,float S1y,float S1z,float S2x,float S2y,float S2z){
    float EMgamma = 0.577215664901532860606512090082402431 ;
    float M=m1+m2 ;
    float mu=m1*m2/M ;
    float eta=mu/M ;
    float r=sqrt(x*x+y*y+z*z) ;
    float u=1/r ;
    float sigmastar3=m2/m1*S1z+m1/m2*S2z ;
    float sigmastar2 = m2/m1*S1y + m1/m2*S2y ;
    float sigmastar1 = m2/m1*S1x + m1/m2*S2x ;
    float sigma3=S1z+S2z ;
    float sigma2 = S1y + S2y ;
    float sigma1 = S1x + S2x ;
    float Skerr3=sigma3 ;
    float Skerr2 = sigma2 ;
    float Skerr1 = sigma1 ;
    float Skerrmag=sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3) ;
    float Skerrhat3=Skerr3/Skerrmag ;
    float Skerrhat2 = Skerr2/Skerrmag ;
    float Skerrhat1 = Skerr1/Skerrmag ;
    float a=Skerrmag ;
    float L3=x*p2-y*p1 ;
    float L2 = z*p1 - x*p3 ;
    float L1 = y*p3 - z*p2 ;
    float Lnorm=sqrt(L1*L1+L2*L2+L3*L3) ;
    float Lhat3=L3/Lnorm ;
    float Lhat2 = L2/Lnorm ;
    float Lhat1 = L1/Lnorm ;
    float S2dotLhat=S2x*Lhat1+S2y*Lhat2+S2z*Lhat3 ;
    float S1dotLhat = S1x*Lhat1 + S1y*Lhat2 + S1z*Lhat3 ;
    float S1perp3=S1z-S1dotLhat*Lhat3 ;
    float S1perp2 = S1y - S1dotLhat*Lhat2 ;
    float S1perp1 = S1x - S1dotLhat*Lhat1 ;
    float S2perp3=S2z-S2dotLhat*Lhat3 ;
    float S2perp2 = S2y - S2dotLhat*Lhat2 ;
    float S2perp1 = S2x - S2dotLhat*Lhat1 ;
    float Sperp3=S1perp3+S2perp3 ;
    float Sperp2 = S1perp2 + S2perp2 ;
    float Sperp1 = S1perp1 + S2perp1 ;
    float n3=z/r ;
    float n2 = y/r ;
    float n1 = x/r ;
    float e33=Skerrhat3 ;
    float e32 = Skerrhat2 ;
    float e31 = Skerrhat1 ;
    float xi3=e31*n2-e32*n1 ;
    float xi2 = -e31*n3 + e33*n1 ;
    float xi1 = e32*n3 - e33*n2 ;
    float v3=n1*xi2-n2*xi1 ;
    float v2 = n3*xi1 - n1*xi3 ;
    float v1 = n2*xi3 - n3*xi2 ;
    float costheta=e31*n1+e32*n2+e33*n3 ;
    float sin2theta=1-costheta*costheta ;
    float xisq = sin2theta ;
    float w2=a*a+r*r ;
    float Sigma=r*r+a*a*costheta*costheta ;
    float Dinv=1+log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u) ;
    float omegatilde=2*a*r ;
    float chi=(Skerr1*Lhat1+Skerr2*Lhat2+Skerr3*Lhat3)/(1-2*eta)+fdivide(1,2)*(Sperp1*Skerr1+Sperp2*Skerr2+Sperp3*Skerr3)/(Skerrmag*(1.-2.*eta)) ;
    float Kchi0=267.788*eta*eta*eta-126.687*eta*eta+10.2573*eta+1.7336 ;
    float K=-59.1658*chi*chi*chi*eta*eta*eta-0.426958*chi*chi*chi*eta+1.43659*chi*chi*chi+31.1746*chi*chi*eta*eta*eta+6.16466*chi*chi*eta*eta-1.38086*chi*chi-27.5201*chi*eta*eta*eta+17.3736*chi*eta*eta+2.26831*chi*eta-1.62045*chi+Kchi0 ;
    float etaKminus1 = eta*K - 1 ;
    float Delta0=K*(eta*K-2) ;
    float Delta1=-2*etaKminus1*(K+Delta0) ;
    float Delta2=fdivide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0 ;
    float Delta3=-fdivide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1 ;
    float Delta4=fdivide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(fdivide(94,3)-fdivide(41,32)*M_PI*M_PI)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1)) ;
    float Delta5=etaKminus1*etaKminus1*(fdivide(-4237,60)+fdivide(128,5)*EMgamma+fdivide(2275,512)*M_PI*M_PI-fdivide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+fdivide(256,5)*log(2)+(fdivide(41,32)*M_PI*M_PI-fdivide(221,6))*eta) ;
    float Delta5l=etaKminus1*etaKminus1*fdivide(64,5) ;
    float logarg=u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*log(u)))))) ;
    float Deltaucalib = 1 + eta*(Delta0 + log(fabs(1 + logarg))) ;
    float Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*log(u)))))))/(1+logarg) ;
    float Deltaubar=a*a*u*u+(2*u+1/etaKminus1)/etaKminus1 ;
    float Deltaubarprime = -2*a*a*u*u*u - 2*u*u/(etaKminus1) ;
    float Deltau=fabs(Deltaubar*Deltaucalib) ;
    float Deltauprime = Deltaubarprime*Deltaucalib + Deltaubar*Deltaucalibprime ;
    float Deltatprime=2*r*Deltau+r*r*Deltauprime ;
    float Deltat=r*r*Deltau ;
    float Deltar=Deltat*Dinv ;
    float Lambdat=fabs(w2*w2-a*a*Deltat*sin2theta) ;
    float csi=sqrt(fabs(Deltar*Deltat))/w2 ;
    float csi1=1+(1-fabs(1-(float)tortoise))*(csi-1) ;
    float csi2=1+(fdivide(1,2)-fdivide(1,2)*sign(fdivide(3,2)-(float)tortoise))*(csi-1) ;
    float prT=csi2*(p1*n1+p2*n2+p3*n3) ;
    float phat3=p3-prT*(1-1/csi1)*n3 ;
    float phat2 = p2 - prT*(1 - 1/csi1)*n2 ;
    float phat1 = p1 - prT*(1 - 1/csi1)*n1 ;
    float pdotxir=(phat1*xi1+phat2*xi2+phat3*xi3)*r ;
    float pdotn=phat1*n1+phat2*n2+phat3*n3 ;
    float pdotvr=(phat1*v1+phat2*v2+phat3*v3)*r ;
    float pphi=pdotxir ;
    float Qcoeff2=1/(Sigma*sin2theta) ;
    float Qcoeff1=Sigma/(Lambdat*sin2theta) ;
    float DrSipn2=Deltar*pdotn*pdotn/Sigma ;
    float Q=1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr ;
    float Qminus1 = Q - 1 ;
    float Jtilde=sqrt(Deltar) ;
    float exp2mu=Sigma ;
    float expmu = sqrt(exp2mu) ;
    float Brtilde=(sqrt(Deltar)*Deltatprime-2*Deltat)/(2*sqrt(Deltar*Deltat)) ;
    float Btilde=sqrt(Deltat) ;
    float exp2nu=Deltat*Sigma/Lambdat ;
    float expnu = sqrt(exp2nu) ;
    float omega=omegatilde/Lambdat ;
    float omegatildeprime=2*a ;
    float Lambdatprime=4*(a*a+r*r)*r-a*a*Deltatprime*sin2theta ;
    float mucostheta=a*a*costheta/Sigma ;
    float nucostheta=a*a*w2*costheta*(w2-Deltat)/(Lambdat*Sigma) ;
    float omegacostheta=-2*a*a*costheta*Deltat*omegatilde/(Lambdat*Lambdat) ;
    float mur=r/Sigma-1/sqrt(Deltar) ;
    float nur=r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambdat*Deltat) ;
    float omegar=(Lambdat*omegatildeprime-Lambdatprime*omegatilde)/(Lambdat*Lambdat) ;
    float dSO=147.481*chi*chi*chi*eta*eta-568.651*chi*chi*chi*eta+66.1987*chi*chi*chi-343.313*chi*chi*eta+2495.29*chi*eta*eta-44.5324 ;
    float sigmacoeffTerm3 = eta*dSO*u*u*u ;
    float sigmacoeffTerm2=eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2)))) ;
    float sigmacoeffTerm1=eta/12*(-8/r+3*Qminus1-36*DrSipn2) ;
    float sigmacoeff=sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3 ;
    float sigmastarcoeffTerm2=eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1))))) ;
    float sigmastarcoeffTerm1=eta/12*(14/r+4*Qminus1-30*DrSipn2) ;
    float sigmastarcoeff=sigmastarcoeffTerm1+sigmastarcoeffTerm2 ;
    float Deltasigmastar3=sigmastar3*sigmastarcoeff+sigma3*sigmacoeff ;
    float Deltasigmastar2 = sigmastar2*sigmastarcoeff + sigma2*sigmacoeff ;
    float Deltasigmastar1 = sigmastar1*sigmastarcoeff + sigma1*sigmacoeff ;
    float Sstar3=sigmastar3+Deltasigmastar3 ;
    float Sstar2 = sigmastar2 + Deltasigmastar2 ;
    float Sstar1 = sigmastar1 + Deltasigmastar1 ;
    float S3 = Sstar3 ;
    float S2 = Sstar2 ;
    float S1 = Sstar1 ;
    float Sstardotn=Sstar1*n1+Sstar2*n2+Sstar3*n3 ;
    float SdotSkerrhat=S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3 ;
    float Sdotn=S1*n1+S2*n2+S3*n3 ;
    float Sdotv=S1*v1+S2*v2+S3*v3 ;
    float Sdotxi=S1*xi1+S2*xi2+S3*xi3 ;
    float HdsumTerm2=3*Sstardotn*Sstardotn ;
    float HdsumTerm1=Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3 ;
    float Hdsum=HdsumTerm1-HdsumTerm2 ;
    float Hdcoeff=fdivide(1,2)/(r*r*r) ;
    float Q4=2*prT*prT*prT*prT*u*u*(4-3*eta)*eta ;
    float gammappsum=Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambdat/sin2theta*pdotxir*pdotxir ;
    float Hnsradicand=1+gammappsum+Q4 ;
    float alpha=sqrt(Deltat*Sigma/Lambdat) ;
    float betapsum=omegatilde*pphi/Lambdat ;
    float HssTerm3=expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde ;
    float HssTerm3coeff=omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+sqrt(Q))) ;
    float HssTerm2=expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv)) ;
    float HssTerm2coeff=Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+sqrt(Q))*xisq) ;
    float HssTerm1=omega*SdotSkerrhat ;
    float Hss=HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3 ;
    float HsoTerm2c=Jtilde*Brtilde*expmu*expnu*pdotxir*(sqrt(Q)+1)*Sdotv ;
    float HsoTerm2b=expmu*expnu*pdotxir*(2*sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde ;
    float HsoTerm2a=Sdotxi*Jtilde*(mur*pdotvr*(sqrt(Q)+1)-mucostheta*pdotn*xisq-sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde ;
    float HsoTerm2=HsoTerm2a+HsoTerm2b-HsoTerm2c ;
    float HsoTerm2coeff=expnu/(exp2mu*Btilde*Btilde*(Q+sqrt(Q))*xisq) ;
    float HsoTerm1=exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*sqrt(Q)*xisq) ;
    float Hso=HsoTerm1+HsoTerm2coeff*HsoTerm2 ;
    float Hd=Hdcoeff*Hdsum ;
    float Hns=betapsum+alpha*sqrt(Hnsradicand) ;
    float Hs=Hso+Hss ;
    float dSS=528.511*chi*chi*chi*eta*eta-41.0003*chi*chi*chi*eta+1161.78*chi*chi*eta*eta*eta-326.325*chi*chi*eta*eta+37.1964*chi*eta+706.958*eta*eta*eta-36.0272*eta+6.06807 ;
    float Heff = Hs + Hns - Hd + dSS*eta*u*u*u*u*(S1x*S1x + S1y*S1y + S1z*S1z + S2x*S2x + S2y*S2y + S2z*S2z) ;
    float Hreal=sqrt(1+2*eta*(fabs(Heff)-1)) ;
    return Hreal;
}