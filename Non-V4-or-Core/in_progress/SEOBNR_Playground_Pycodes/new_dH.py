from __future__ import division
import numpy as np
def new_compute_dHdx(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    rprm_x = x/np.sqrt(x**2 + y**2 + z**2)
    uprm_x = -rprm_x/r**2
    n3prm_x = -rprm_x*z/r**2
    n2prm_x = -rprm_x*y/r**2
    n1prm_x = 1/r - rprm_x*x/r**2
    xi3prm_x = e31*n2prm_x - e32*n1prm_x
    xi2prm_x = -e31*n3prm_x + e33*n1prm_x
    xi1prm_x = e32*n3prm_x - e33*n2prm_x
    v3prm_x = n1*xi2prm_x + n1prm_x*xi2 - n2*xi1prm_x - n2prm_x*xi1
    v2prm_x = -n1*xi3prm_x - n1prm_x*xi3 + n3*xi1prm_x + n3prm_x*xi1
    v1prm_x = n2*xi3prm_x + n2prm_x*xi3 - n3*xi2prm_x - n3prm_x*xi2
    costhetaprm_x = e31*n1prm_x + e32*n2prm_x + e33*n3prm_x
    sin2thetaprm_x = -2*costheta*costhetaprm_x
    xisqprm_x = sin2thetaprm_x
    w2prm_x = 2*r*rprm_x
    Sigmaprm_x = 2*a**2*costheta*costhetaprm_x + 2*r*rprm_x
    Dinvprm_x = (3*eta*u**2*uprm_x*(52 - 6*eta) + 12*eta*u*uprm_x)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)
    omegatildeprm_x = 2*a*rprm_x
    logargprm_x = u*(u*(u*(u*(Delta5l*uprm_x + uprm_x*(Delta5 + Delta5l*np.log(u))) + uprm_x*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))) + uprm_x*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))) + uprm_x*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))))) + uprm_x*(Delta1 + u*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))))
    Deltaucalibprm_x = eta*logargprm_x/(logarg + 1)
    Deltaucalibprimeprm_x = eta*logargprm_x*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**2*(u*(u*(u*(5*Delta5l*uprm_x + uprm_x*(5*Delta5 + 5*Delta5l*np.log(u))) + uprm_x*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u)))) + uprm_x*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))) + uprm_x*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1) - 2*eta*u*uprm_x*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)
    Deltaubarprm_x = 2*a**2*u*uprm_x + 2*uprm_x/etaKminus1
    Deltaubarprimeprm_x = -6*a**2*u**2*uprm_x - 4*u*uprm_x/etaKminus1
    Deltauprm_x = Deltaubar*Deltaucalibprm_x + Deltaubarprm_x*Deltaucalib
    Deltauprimeprm_x = Deltaubar*Deltaucalibprimeprm_x + Deltaubarprime*Deltaucalibprm_x + Deltaubarprimeprm_x*Deltaucalib + Deltaubarprm_x*Deltaucalibprime
    Deltatprimeprm_x = 2*Deltau*rprm_x + 2*Deltauprime*r*rprm_x + Deltauprimeprm_x*r**2 + 2*Deltauprm_x*r
    Deltatprm_x = 2*Deltau*r*rprm_x + Deltauprm_x*r**2
    Deltarprm_x = Deltat*Dinvprm_x + Deltatprm_x*Dinv
    Lambtprm_x = -Deltat*a**2*sin2thetaprm_x - Deltatprm_x*a**2*sin2theta + 2*w2*w2prm_x
    csiprm_x = -w2prm_x*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_x/2 + Deltarprm_x*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_x = csiprm_x*(1 - abs(1 - tortoise))
    csi2prm_x = csiprm_x*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_x = csi2*(n1prm_x*p1 + n2prm_x*p2 + n3prm_x*p3) + csi2prm_x*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_x = n3*prTprm_x*(1 - 1/csi1) + n3prm_x*prT*(1 - 1/csi1) + csi1prm_x*n3*prT/csi1**2
    phat2prm_x = n2*prTprm_x*(1 - 1/csi1) + n2prm_x*prT*(1 - 1/csi1) + csi1prm_x*n2*prT/csi1**2
    phat1prm_x = n1*prTprm_x*(1 - 1/csi1) + n1prm_x*prT*(1 - 1/csi1) + csi1prm_x*n1*prT/csi1**2
    pdotxirprm_x = r*(phat1*xi1prm_x + phat1prm_x*xi1 + phat2*xi2prm_x + phat2prm_x*xi2 + phat3*xi3prm_x + phat3prm_x*xi3) + rprm_x*(phat1*xi1 + phat2*xi2 + phat3*xi3)
    pdotnprm_x = n1*phat1prm_x + n1prm_x*phat1 + n2*phat2prm_x + n2prm_x*phat2 + n3*phat3prm_x + n3prm_x*phat3
    pdotvrprm_x = r*(phat1*v1prm_x + phat1prm_x*v1 + phat2*v2prm_x + phat2prm_x*v2 + phat3*v3prm_x + phat3prm_x*v3) + rprm_x*(phat1*v1 + phat2*v2 + phat3*v3)
    pphiprm_x = pdotxirprm_x
    Qcoeff2prm_x = -sin2thetaprm_x/(Sigma*sin2theta**2) - Sigmaprm_x/(Sigma**2*sin2theta)
    Qcoeff1prm_x = -Sigma*sin2thetaprm_x/(Lambt*sin2theta**2) + Sigmaprm_x/(Lambt*sin2theta) - Lambtprm_x*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_x = 2*Deltar*pdotn*pdotnprm_x/Sigma - Deltar*Sigmaprm_x*pdotn**2/Sigma**2 + Deltarprm_x*pdotn**2/Sigma
    Qprm_x = DrSipn2prm_x + 2*Qcoeff1*pdotxir*pdotxirprm_x + Qcoeff1prm_x*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_x + Qcoeff2prm_x*pdotvr**2
    Qminus1prm_x = Qprm_x
    Jtildeprm_x = Deltarprm_x/(2*np.sqrt(Deltar))
    exp2muprm_x = Sigmaprm_x
    expmuprm_x = exp2muprm_x/(2*np.sqrt(exp2mu))
    Brtildeprm_x = (np.sqrt(Deltar)*Deltatprimeprm_x - 2*Deltatprm_x + Deltarprm_x*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_x/2 - Deltarprm_x*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_x = Deltatprm_x/(2*np.sqrt(Deltat))
    exp2nuprm_x = Deltat*Sigmaprm_x/Lambt - Deltat*Lambtprm_x*Sigma/Lambt**2 + Deltatprm_x*Sigma/Lambt
    expnuprm_x = exp2nuprm_x/(2*np.sqrt(exp2nu))
    omegaprm_x = omegatildeprm_x/Lambt - Lambtprm_x*omegatilde/Lambt**2
    Lambtprimeprm_x = -2*Deltatprime*a**2*sin2thetaprm_x - 2*Deltatprimeprm_x*a**2*sin2theta + 8*r**2*rprm_x + rprm_x*(4*a**2 + 4*r**2)
    mucosthetaprm_x = a**2*costhetaprm_x/Sigma - Sigmaprm_x*a**2*costheta/Sigma**2
    nucosthetaprm_x = a**2*costheta*w2*(-Deltatprm_x + w2prm_x)/(Lambt*Sigma) + a**2*costheta*w2prm_x*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_x*w2*(-Deltat + w2)/(Lambt*Sigma) - Sigmaprm_x*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_x*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_x = -2*Deltat*a**2*costheta*omegatildeprm_x/Lambt**2 - 2*Deltat*a**2*costhetaprm_x*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_x*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_x*a**2*costheta*omegatilde/Lambt**2
    murprm_x = rprm_x/Sigma - Sigmaprm_x*r/Sigma**2 + Deltarprm_x/(2*Deltar**(3/2))
    nurprm_x = rprm_x/Sigma - Sigmaprm_x*r/Sigma**2 + w2*(-4*Deltat*rprm_x + Deltatprime*w2prm_x + Deltatprimeprm_x*w2 - 4*Deltatprm_x*r)/(2*Deltat*Lambt) + w2prm_x*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_x = (-Lambtprime*omegatildeprm_x - Lambtprimeprm_x*omegatilde + Lambtprm_x*omegatildeprime)/Lambt**2 + Lambtprm_x*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm3prm_x = 3*dSO*eta*u**2*uprm_x
    sigmacoeffTerm2prm_x = eta*(eta*(r*(-882*DrSipn2prm_x + 204*Qminus1prm_x + r*(1620*DrSipn2*DrSipn2prm_x - 234*DrSipn2*Qminus1prm_x - 234*DrSipn2prm_x*Qminus1) + rprm_x*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) + rprm_x*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1))) + r*(-96*DrSipn2prm_x - 436*Qminus1prm_x + r*(36*DrSipn2*Qminus1prm_x + 36*DrSipn2prm_x*Qminus1 - 90*Qminus1*Qminus1prm_x) + rprm_x*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) + rprm_x*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)))/(144*r**2) - eta*rprm_x*(eta*(r*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) - 336) + r*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) - 896)/(72*r**3)
    sigmacoeffTerm1prm_x = eta*(-36*DrSipn2prm_x + 3*Qminus1prm_x + 8*rprm_x/r**2)/12
    sigmacoeffprm_x = sigmacoeffTerm1prm_x + sigmacoeffTerm2prm_x + sigmacoeffTerm3prm_x
    sigmastarcoeffTerm2prm_x = eta*(eta*(r*(-324*DrSipn2prm_x + 120*Qminus1prm_x + r*(720*DrSipn2*DrSipn2prm_x + Qminus1*(-126*DrSipn2prm_x - 3*Qminus1prm_x) + Qminus1prm_x*(-126*DrSipn2 - 3*Qminus1)) + rprm_x*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) + rprm_x*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1)))) + r*(282*DrSipn2prm_x + Qminus1*r*(96*DrSipn2prm_x - 23*Qminus1prm_x) + Qminus1*rprm_x*(96*DrSipn2 - 23*Qminus1) + Qminus1prm_x*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_x) + rprm_x*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1))/(72*r**2) - eta*rprm_x*(eta*(r*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) - 54) + r*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1) + 706)/(36*r**3)
    sigmastarcoeffTerm1prm_x = eta*(-30*DrSipn2prm_x + 4*Qminus1prm_x - 14*rprm_x/r**2)/12
    sigmastarcoeffprm_x = sigmastarcoeffTerm1prm_x + sigmastarcoeffTerm2prm_x
    Deltasigmastar3prm_x = sigma3*sigmacoeffprm_x + sigmastar3*sigmastarcoeffprm_x
    Deltasigmastar2prm_x = sigma2*sigmacoeffprm_x + sigmastar2*sigmastarcoeffprm_x
    Deltasigmastar1prm_x = sigma1*sigmacoeffprm_x + sigmastar1*sigmastarcoeffprm_x
    Sstar3prm_x = Deltasigmastar3prm_x
    Sstar2prm_x = Deltasigmastar2prm_x
    Sstar1prm_x = Deltasigmastar1prm_x
    S3prm_x = Sstar3prm_x
    S2prm_x = Sstar2prm_x
    S1prm_x = Sstar1prm_x
    Sstardotnprm_x = Sstar1*n1prm_x + Sstar1prm_x*n1 + Sstar2*n2prm_x + Sstar2prm_x*n2 + Sstar3*n3prm_x + Sstar3prm_x*n3
    SdotSkerrhatprm_x = S1prm_x*Skerrhat1 + S2prm_x*Skerrhat2 + S3prm_x*Skerrhat3
    Sdotnprm_x = S1*n1prm_x + S1prm_x*n1 + S2*n2prm_x + S2prm_x*n2 + S3*n3prm_x + S3prm_x*n3
    Sdotvprm_x = S1*v1prm_x + S1prm_x*v1 + S2*v2prm_x + S2prm_x*v2 + S3*v3prm_x + S3prm_x*v3
    Sdotxiprm_x = S1*xi1prm_x + S1prm_x*xi1 + S2*xi2prm_x + S2prm_x*xi2 + S3*xi3prm_x + S3prm_x*xi3
    HdsumTerm2prm_x = 6*Sstardotn*Sstardotnprm_x
    HdsumTerm1prm_x = 2*Sstar1*Sstar1prm_x + 2*Sstar2*Sstar2prm_x + 2*Sstar3*Sstar3prm_x
    Hdsumprm_x = HdsumTerm1prm_x - HdsumTerm2prm_x
    Hdcoeffprm_x = -3*rprm_x/(2*r**4)
    Q4prm_x = 4*eta*prT**4*u*uprm_x*(4 - 3*eta) + 8*eta*prT**3*prTprm_x*u**2*(4 - 3*eta)
    gammappsumprm_x = 2*Deltar*pdotn*pdotnprm_x/Sigma - Deltar*Sigmaprm_x*pdotn**2/Sigma**2 + Deltarprm_x*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_x/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_x/(Sigma*sin2theta) - Sigmaprm_x*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_x/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_x/(Lambt*sin2theta) + Sigmaprm_x*pdotxir**2/(Lambt*sin2theta) - Lambtprm_x*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_x = Q4prm_x + gammappsumprm_x
    alphaprm_x = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_x/(2*Lambt) - Deltat*Lambtprm_x*Sigma/(2*Lambt**2) + Deltatprm_x*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_x = omegatilde*pphiprm_x/Lambt + omegatildeprm_x*pphi/Lambt - Lambtprm_x*omegatilde*pphi/Lambt**2
    HssTerm3prm_x = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_x - Qprm_x/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_x*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_x*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_x*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_x - Jtilde*Sdotvprm_x*pdotn - Jtildeprm_x*Sdotv*pdotn + Sdotn*pdotvrprm_x + Sdotnprm_x*pdotvr) + pdotvrprm_x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_x*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_x + Btilde*Jtilde*Sdotxiprm_x*pdotn + Btilde*Jtildeprm_x*Sdotxi*pdotn + Btildeprm_x*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_x - Sdotn*expmu*expnuprm_x*pdotxir - Sdotn*expmuprm_x*expnu*pdotxir - Sdotnprm_x*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_x*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_x*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_x*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_x = omegacostheta*(-Qprm_x - Qprm_x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_x/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_x*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_x*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_x*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_x*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_x = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_x - Jtilde*Sdotvprm_x*pdotn - Jtildeprm_x*Sdotv*pdotn + Sdotn*pdotvrprm_x + Sdotnprm_x*pdotvr) + Jtilde*pdotnprm_x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_x*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_x + Qprm_x/(2*np.sqrt(Q))) + Sdotv*exp2muprm_x*(np.sqrt(Q) + Q) + Sdotvprm_x*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_x*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_x*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_x - Btilde*Sdotxi*expnuprm_x*pdotvr - Btilde*Sdotxiprm_x*expnu*pdotvr - Btildeprm_x*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_x + Sdotv*exp2nu*expmuprm_x*pdotxir + Sdotv*exp2nuprm_x*expmu*pdotxir + Sdotvprm_x*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_x*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_x*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_x = Jtilde*omegar*(-Qprm_x - Qprm_x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_x/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_x/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_x*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_x*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_x*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_x*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_x*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_x = SdotSkerrhat*omegaprm_x + SdotSkerrhatprm_x*omega
    Hssprm_x = HssTerm1prm_x + HssTerm2*HssTerm2coeffprm_x + HssTerm2coeff*HssTerm2prm_x + HssTerm3*HssTerm3coeffprm_x + HssTerm3coeff*HssTerm3prm_x
    HsoTerm2cprm_x = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_x*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_x*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_x*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_x*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_x*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_x*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_x*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_x = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_x + Jtilde*Sdotvprm_x*nur + Jtildeprm_x*Sdotv*nur - Sdotn*nucostheta*xisqprm_x - Sdotn*nucosthetaprm_x*xisq - Sdotnprm_x*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_x*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_x*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_x*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_x*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_x*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_x = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_x + nurprm_x*pdotvr + pdotn*xisq*(mucosthetaprm_x - nucosthetaprm_x) + pdotn*xisqprm_x*(mucostheta - nucostheta) + pdotnprm_x*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_x - mucostheta*pdotnprm_x*xisq - mucosthetaprm_x*pdotn*xisq + mur*pdotvrprm_x*(np.sqrt(Q) + 1) + murprm_x*pdotvr*(np.sqrt(Q) + 1) + Qprm_x*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_x*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_x*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_x*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_x*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_x = HsoTerm2aprm_x + HsoTerm2bprm_x - HsoTerm2cprm_x
    HsoTerm2coeffprm_x = expnu*(-Qprm_x - Qprm_x/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_x/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_x/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_x*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_x*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_x = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_x + expmu*expnuprm_x + expmuprm_x*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_x*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_x*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_x*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_x*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_x*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_x = HsoTerm1prm_x + HsoTerm2*HsoTerm2coeffprm_x + HsoTerm2coeff*HsoTerm2prm_x
    Hdprm_x = Hdcoeff*Hdsumprm_x + Hdcoeffprm_x*Hdsum
    Hnsprm_x = np.sqrt(Hnsradicand)*alphaprm_x + betapsumprm_x + Hnsradicandprm_x*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_x = Hsoprm_x + Hssprm_x
    Heffprm_x = -Hdprm_x + Hnsprm_x + Hsprm_x + 4*dSS*eta*u**3*uprm_x*(S1x**2 + S1y**2 + S1z**2 + S2x**2 + S2y**2 + S2z**2)
    Hrealprm_x = Heffprm_x*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_x, csiprm_x])
def new_compute_dHdy(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    rprm_y = y/np.sqrt(x**2 + y**2 + z**2)
    uprm_y = -rprm_y/r**2
    n3prm_y = -rprm_y*z/r**2
    n2prm_y = 1/r - rprm_y*y/r**2
    n1prm_y = -rprm_y*x/r**2
    xi3prm_y = e31*n2prm_y - e32*n1prm_y
    xi2prm_y = -e31*n3prm_y + e33*n1prm_y
    xi1prm_y = e32*n3prm_y - e33*n2prm_y
    v3prm_y = n1*xi2prm_y + n1prm_y*xi2 - n2*xi1prm_y - n2prm_y*xi1
    v2prm_y = -n1*xi3prm_y - n1prm_y*xi3 + n3*xi1prm_y + n3prm_y*xi1
    v1prm_y = n2*xi3prm_y + n2prm_y*xi3 - n3*xi2prm_y - n3prm_y*xi2
    costhetaprm_y = e31*n1prm_y + e32*n2prm_y + e33*n3prm_y
    sin2thetaprm_y = -2*costheta*costhetaprm_y
    xisqprm_y = sin2thetaprm_y
    w2prm_y = 2*r*rprm_y
    Sigmaprm_y = 2*a**2*costheta*costhetaprm_y + 2*r*rprm_y
    Dinvprm_y = (3*eta*u**2*uprm_y*(52 - 6*eta) + 12*eta*u*uprm_y)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)
    omegatildeprm_y = 2*a*rprm_y
    logargprm_y = u*(u*(u*(u*(Delta5l*uprm_y + uprm_y*(Delta5 + Delta5l*np.log(u))) + uprm_y*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))) + uprm_y*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))) + uprm_y*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))))) + uprm_y*(Delta1 + u*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))))
    Deltaucalibprm_y = eta*logargprm_y/(logarg + 1)
    Deltaucalibprimeprm_y = eta*logargprm_y*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**2*(u*(u*(u*(5*Delta5l*uprm_y + uprm_y*(5*Delta5 + 5*Delta5l*np.log(u))) + uprm_y*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u)))) + uprm_y*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))) + uprm_y*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1) - 2*eta*u*uprm_y*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)
    Deltaubarprm_y = 2*a**2*u*uprm_y + 2*uprm_y/etaKminus1
    Deltaubarprimeprm_y = -6*a**2*u**2*uprm_y - 4*u*uprm_y/etaKminus1
    Deltauprm_y = Deltaubar*Deltaucalibprm_y + Deltaubarprm_y*Deltaucalib
    Deltauprimeprm_y = Deltaubar*Deltaucalibprimeprm_y + Deltaubarprime*Deltaucalibprm_y + Deltaubarprimeprm_y*Deltaucalib + Deltaubarprm_y*Deltaucalibprime
    Deltatprimeprm_y = 2*Deltau*rprm_y + 2*Deltauprime*r*rprm_y + Deltauprimeprm_y*r**2 + 2*Deltauprm_y*r
    Deltatprm_y = 2*Deltau*r*rprm_y + Deltauprm_y*r**2
    Deltarprm_y = Deltat*Dinvprm_y + Deltatprm_y*Dinv
    Lambtprm_y = -Deltat*a**2*sin2thetaprm_y - Deltatprm_y*a**2*sin2theta + 2*w2*w2prm_y
    csiprm_y = -w2prm_y*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_y/2 + Deltarprm_y*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_y = csiprm_y*(1 - abs(1 - tortoise))
    csi2prm_y = csiprm_y*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_y = csi2*(n1prm_y*p1 + n2prm_y*p2 + n3prm_y*p3) + csi2prm_y*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_y = n3*prTprm_y*(1 - 1/csi1) + n3prm_y*prT*(1 - 1/csi1) + csi1prm_y*n3*prT/csi1**2
    phat2prm_y = n2*prTprm_y*(1 - 1/csi1) + n2prm_y*prT*(1 - 1/csi1) + csi1prm_y*n2*prT/csi1**2
    phat1prm_y = n1*prTprm_y*(1 - 1/csi1) + n1prm_y*prT*(1 - 1/csi1) + csi1prm_y*n1*prT/csi1**2
    pdotxirprm_y = r*(phat1*xi1prm_y + phat1prm_y*xi1 + phat2*xi2prm_y + phat2prm_y*xi2 + phat3*xi3prm_y + phat3prm_y*xi3) + rprm_y*(phat1*xi1 + phat2*xi2 + phat3*xi3)
    pdotnprm_y = n1*phat1prm_y + n1prm_y*phat1 + n2*phat2prm_y + n2prm_y*phat2 + n3*phat3prm_y + n3prm_y*phat3
    pdotvrprm_y = r*(phat1*v1prm_y + phat1prm_y*v1 + phat2*v2prm_y + phat2prm_y*v2 + phat3*v3prm_y + phat3prm_y*v3) + rprm_y*(phat1*v1 + phat2*v2 + phat3*v3)
    pphiprm_y = pdotxirprm_y
    Qcoeff2prm_y = -sin2thetaprm_y/(Sigma*sin2theta**2) - Sigmaprm_y/(Sigma**2*sin2theta)
    Qcoeff1prm_y = -Sigma*sin2thetaprm_y/(Lambt*sin2theta**2) + Sigmaprm_y/(Lambt*sin2theta) - Lambtprm_y*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_y = 2*Deltar*pdotn*pdotnprm_y/Sigma - Deltar*Sigmaprm_y*pdotn**2/Sigma**2 + Deltarprm_y*pdotn**2/Sigma
    Qprm_y = DrSipn2prm_y + 2*Qcoeff1*pdotxir*pdotxirprm_y + Qcoeff1prm_y*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_y + Qcoeff2prm_y*pdotvr**2
    Qminus1prm_y = Qprm_y
    Jtildeprm_y = Deltarprm_y/(2*np.sqrt(Deltar))
    exp2muprm_y = Sigmaprm_y
    expmuprm_y = exp2muprm_y/(2*np.sqrt(exp2mu))
    Brtildeprm_y = (np.sqrt(Deltar)*Deltatprimeprm_y - 2*Deltatprm_y + Deltarprm_y*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_y/2 - Deltarprm_y*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_y = Deltatprm_y/(2*np.sqrt(Deltat))
    exp2nuprm_y = Deltat*Sigmaprm_y/Lambt - Deltat*Lambtprm_y*Sigma/Lambt**2 + Deltatprm_y*Sigma/Lambt
    expnuprm_y = exp2nuprm_y/(2*np.sqrt(exp2nu))
    omegaprm_y = omegatildeprm_y/Lambt - Lambtprm_y*omegatilde/Lambt**2
    Lambtprimeprm_y = -2*Deltatprime*a**2*sin2thetaprm_y - 2*Deltatprimeprm_y*a**2*sin2theta + 8*r**2*rprm_y + rprm_y*(4*a**2 + 4*r**2)
    mucosthetaprm_y = a**2*costhetaprm_y/Sigma - Sigmaprm_y*a**2*costheta/Sigma**2
    nucosthetaprm_y = a**2*costheta*w2*(-Deltatprm_y + w2prm_y)/(Lambt*Sigma) + a**2*costheta*w2prm_y*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_y*w2*(-Deltat + w2)/(Lambt*Sigma) - Sigmaprm_y*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_y*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_y = -2*Deltat*a**2*costheta*omegatildeprm_y/Lambt**2 - 2*Deltat*a**2*costhetaprm_y*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_y*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_y*a**2*costheta*omegatilde/Lambt**2
    murprm_y = rprm_y/Sigma - Sigmaprm_y*r/Sigma**2 + Deltarprm_y/(2*Deltar**(3/2))
    nurprm_y = rprm_y/Sigma - Sigmaprm_y*r/Sigma**2 + w2*(-4*Deltat*rprm_y + Deltatprime*w2prm_y + Deltatprimeprm_y*w2 - 4*Deltatprm_y*r)/(2*Deltat*Lambt) + w2prm_y*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_y = (-Lambtprime*omegatildeprm_y - Lambtprimeprm_y*omegatilde + Lambtprm_y*omegatildeprime)/Lambt**2 + Lambtprm_y*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm3prm_y = 3*dSO*eta*u**2*uprm_y
    sigmacoeffTerm2prm_y = eta*(eta*(r*(-882*DrSipn2prm_y + 204*Qminus1prm_y + r*(1620*DrSipn2*DrSipn2prm_y - 234*DrSipn2*Qminus1prm_y - 234*DrSipn2prm_y*Qminus1) + rprm_y*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) + rprm_y*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1))) + r*(-96*DrSipn2prm_y - 436*Qminus1prm_y + r*(36*DrSipn2*Qminus1prm_y + 36*DrSipn2prm_y*Qminus1 - 90*Qminus1*Qminus1prm_y) + rprm_y*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) + rprm_y*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)))/(144*r**2) - eta*rprm_y*(eta*(r*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) - 336) + r*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) - 896)/(72*r**3)
    sigmacoeffTerm1prm_y = eta*(-36*DrSipn2prm_y + 3*Qminus1prm_y + 8*rprm_y/r**2)/12
    sigmacoeffprm_y = sigmacoeffTerm1prm_y + sigmacoeffTerm2prm_y + sigmacoeffTerm3prm_y
    sigmastarcoeffTerm2prm_y = eta*(eta*(r*(-324*DrSipn2prm_y + 120*Qminus1prm_y + r*(720*DrSipn2*DrSipn2prm_y + Qminus1*(-126*DrSipn2prm_y - 3*Qminus1prm_y) + Qminus1prm_y*(-126*DrSipn2 - 3*Qminus1)) + rprm_y*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) + rprm_y*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1)))) + r*(282*DrSipn2prm_y + Qminus1*r*(96*DrSipn2prm_y - 23*Qminus1prm_y) + Qminus1*rprm_y*(96*DrSipn2 - 23*Qminus1) + Qminus1prm_y*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_y) + rprm_y*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1))/(72*r**2) - eta*rprm_y*(eta*(r*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) - 54) + r*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1) + 706)/(36*r**3)
    sigmastarcoeffTerm1prm_y = eta*(-30*DrSipn2prm_y + 4*Qminus1prm_y - 14*rprm_y/r**2)/12
    sigmastarcoeffprm_y = sigmastarcoeffTerm1prm_y + sigmastarcoeffTerm2prm_y
    Deltasigmastar3prm_y = sigma3*sigmacoeffprm_y + sigmastar3*sigmastarcoeffprm_y
    Deltasigmastar2prm_y = sigma2*sigmacoeffprm_y + sigmastar2*sigmastarcoeffprm_y
    Deltasigmastar1prm_y = sigma1*sigmacoeffprm_y + sigmastar1*sigmastarcoeffprm_y
    Sstar3prm_y = Deltasigmastar3prm_y
    Sstar2prm_y = Deltasigmastar2prm_y
    Sstar1prm_y = Deltasigmastar1prm_y
    S3prm_y = Sstar3prm_y
    S2prm_y = Sstar2prm_y
    S1prm_y = Sstar1prm_y
    Sstardotnprm_y = Sstar1*n1prm_y + Sstar1prm_y*n1 + Sstar2*n2prm_y + Sstar2prm_y*n2 + Sstar3*n3prm_y + Sstar3prm_y*n3
    SdotSkerrhatprm_y = S1prm_y*Skerrhat1 + S2prm_y*Skerrhat2 + S3prm_y*Skerrhat3
    Sdotnprm_y = S1*n1prm_y + S1prm_y*n1 + S2*n2prm_y + S2prm_y*n2 + S3*n3prm_y + S3prm_y*n3
    Sdotvprm_y = S1*v1prm_y + S1prm_y*v1 + S2*v2prm_y + S2prm_y*v2 + S3*v3prm_y + S3prm_y*v3
    Sdotxiprm_y = S1*xi1prm_y + S1prm_y*xi1 + S2*xi2prm_y + S2prm_y*xi2 + S3*xi3prm_y + S3prm_y*xi3
    HdsumTerm2prm_y = 6*Sstardotn*Sstardotnprm_y
    HdsumTerm1prm_y = 2*Sstar1*Sstar1prm_y + 2*Sstar2*Sstar2prm_y + 2*Sstar3*Sstar3prm_y
    Hdsumprm_y = HdsumTerm1prm_y - HdsumTerm2prm_y
    Hdcoeffprm_y = -3*rprm_y/(2*r**4)
    Q4prm_y = 4*eta*prT**4*u*uprm_y*(4 - 3*eta) + 8*eta*prT**3*prTprm_y*u**2*(4 - 3*eta)
    gammappsumprm_y = 2*Deltar*pdotn*pdotnprm_y/Sigma - Deltar*Sigmaprm_y*pdotn**2/Sigma**2 + Deltarprm_y*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_y/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_y/(Sigma*sin2theta) - Sigmaprm_y*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_y/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_y/(Lambt*sin2theta) + Sigmaprm_y*pdotxir**2/(Lambt*sin2theta) - Lambtprm_y*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_y = Q4prm_y + gammappsumprm_y
    alphaprm_y = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_y/(2*Lambt) - Deltat*Lambtprm_y*Sigma/(2*Lambt**2) + Deltatprm_y*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_y = omegatilde*pphiprm_y/Lambt + omegatildeprm_y*pphi/Lambt - Lambtprm_y*omegatilde*pphi/Lambt**2
    HssTerm3prm_y = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_y - Qprm_y/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_y*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_y*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_y*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_y - Jtilde*Sdotvprm_y*pdotn - Jtildeprm_y*Sdotv*pdotn + Sdotn*pdotvrprm_y + Sdotnprm_y*pdotvr) + pdotvrprm_y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_y*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_y + Btilde*Jtilde*Sdotxiprm_y*pdotn + Btilde*Jtildeprm_y*Sdotxi*pdotn + Btildeprm_y*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_y - Sdotn*expmu*expnuprm_y*pdotxir - Sdotn*expmuprm_y*expnu*pdotxir - Sdotnprm_y*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_y*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_y*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_y*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_y = omegacostheta*(-Qprm_y - Qprm_y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_y/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_y*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_y*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_y*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_y*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_y = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_y - Jtilde*Sdotvprm_y*pdotn - Jtildeprm_y*Sdotv*pdotn + Sdotn*pdotvrprm_y + Sdotnprm_y*pdotvr) + Jtilde*pdotnprm_y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_y*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_y + Qprm_y/(2*np.sqrt(Q))) + Sdotv*exp2muprm_y*(np.sqrt(Q) + Q) + Sdotvprm_y*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_y*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_y*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_y - Btilde*Sdotxi*expnuprm_y*pdotvr - Btilde*Sdotxiprm_y*expnu*pdotvr - Btildeprm_y*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_y + Sdotv*exp2nu*expmuprm_y*pdotxir + Sdotv*exp2nuprm_y*expmu*pdotxir + Sdotvprm_y*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_y*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_y*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_y = Jtilde*omegar*(-Qprm_y - Qprm_y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_y/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_y/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_y*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_y*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_y*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_y*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_y*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_y = SdotSkerrhat*omegaprm_y + SdotSkerrhatprm_y*omega
    Hssprm_y = HssTerm1prm_y + HssTerm2*HssTerm2coeffprm_y + HssTerm2coeff*HssTerm2prm_y + HssTerm3*HssTerm3coeffprm_y + HssTerm3coeff*HssTerm3prm_y
    HsoTerm2cprm_y = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_y*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_y*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_y*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_y*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_y*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_y*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_y*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_y = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_y + Jtilde*Sdotvprm_y*nur + Jtildeprm_y*Sdotv*nur - Sdotn*nucostheta*xisqprm_y - Sdotn*nucosthetaprm_y*xisq - Sdotnprm_y*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_y*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_y*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_y*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_y*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_y*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_y = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_y + nurprm_y*pdotvr + pdotn*xisq*(mucosthetaprm_y - nucosthetaprm_y) + pdotn*xisqprm_y*(mucostheta - nucostheta) + pdotnprm_y*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_y - mucostheta*pdotnprm_y*xisq - mucosthetaprm_y*pdotn*xisq + mur*pdotvrprm_y*(np.sqrt(Q) + 1) + murprm_y*pdotvr*(np.sqrt(Q) + 1) + Qprm_y*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_y*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_y*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_y*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_y*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_y = HsoTerm2aprm_y + HsoTerm2bprm_y - HsoTerm2cprm_y
    HsoTerm2coeffprm_y = expnu*(-Qprm_y - Qprm_y/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_y/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_y/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_y*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_y*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_y = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_y + expmu*expnuprm_y + expmuprm_y*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_y*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_y*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_y*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_y*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_y*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_y = HsoTerm1prm_y + HsoTerm2*HsoTerm2coeffprm_y + HsoTerm2coeff*HsoTerm2prm_y
    Hdprm_y = Hdcoeff*Hdsumprm_y + Hdcoeffprm_y*Hdsum
    Hnsprm_y = np.sqrt(Hnsradicand)*alphaprm_y + betapsumprm_y + Hnsradicandprm_y*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_y = Hsoprm_y + Hssprm_y
    Heffprm_y = -Hdprm_y + Hnsprm_y + Hsprm_y + 4*dSS*eta*u**3*uprm_y*(S1x**2 + S1y**2 + S1z**2 + S2x**2 + S2y**2 + S2z**2)
    Hrealprm_y = Heffprm_y*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_y, csiprm_y])
def new_compute_dHdz(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    rprm_z = y/np.sqrt(x**2 + y**2 + z**2)
    uprm_z = -rprm_z/r**2
    n3prm_z = -rprm_z*z/r**2
    n2prm_z = 1/r - rprm_z*y/r**2
    n1prm_z = -rprm_z*x/r**2
    xi3prm_z = e31*n2prm_z - e32*n1prm_z
    xi2prm_z = -e31*n3prm_z + e33*n1prm_z
    xi1prm_z = e32*n3prm_z - e33*n2prm_z
    v3prm_z = n1*xi2prm_z + n1prm_z*xi2 - n2*xi1prm_z - n2prm_z*xi1
    v2prm_z = -n1*xi3prm_z - n1prm_z*xi3 + n3*xi1prm_z + n3prm_z*xi1
    v1prm_z = n2*xi3prm_z + n2prm_z*xi3 - n3*xi2prm_z - n3prm_z*xi2
    costhetaprm_z = e31*n1prm_z + e32*n2prm_z + e33*n3prm_z
    sin2thetaprm_z = -2*costheta*costhetaprm_z
    xisqprm_z = sin2thetaprm_z
    w2prm_z = 2*r*rprm_z
    Sigmaprm_z = 2*a**2*costheta*costhetaprm_z + 2*r*rprm_z
    Dinvprm_z = (3*eta*u**2*uprm_z*(52 - 6*eta) + 12*eta*u*uprm_z)/(eta*u**3*(52 - 6*eta) + 6*eta*u**2 + 1)
    omegatildeprm_z = 2*a*rprm_z
    logargprm_z = u*(u*(u*(u*(Delta5l*uprm_z + uprm_z*(Delta5 + Delta5l*np.log(u))) + uprm_z*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))) + uprm_z*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))) + uprm_z*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u)))))) + uprm_z*(Delta1 + u*(Delta2 + u*(Delta3 + u*(Delta4 + u*(Delta5 + Delta5l*np.log(u))))))
    Deltaucalibprm_z = eta*logargprm_z/(logarg + 1)
    Deltaucalibprimeprm_z = eta*logargprm_z*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**2*(u*(u*(u*(5*Delta5l*uprm_z + uprm_z*(5*Delta5 + 5*Delta5l*np.log(u))) + uprm_z*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u)))) + uprm_z*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))) + uprm_z*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1) - 2*eta*u*uprm_z*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)
    Deltaubarprm_z = 2*a**2*u*uprm_z + 2*uprm_z/etaKminus1
    Deltaubarprimeprm_z = -6*a**2*u**2*uprm_z - 4*u*uprm_z/etaKminus1
    Deltauprm_z = Deltaubar*Deltaucalibprm_z + Deltaubarprm_z*Deltaucalib
    Deltauprimeprm_z = Deltaubar*Deltaucalibprimeprm_z + Deltaubarprime*Deltaucalibprm_z + Deltaubarprimeprm_z*Deltaucalib + Deltaubarprm_z*Deltaucalibprime
    Deltatprimeprm_z = 2*Deltau*rprm_z + 2*Deltauprime*r*rprm_z + Deltauprimeprm_z*r**2 + 2*Deltauprm_z*r
    Deltatprm_z = 2*Deltau*r*rprm_z + Deltauprm_z*r**2
    Deltarprm_z = Deltat*Dinvprm_z + Deltatprm_z*Dinv
    Lambtprm_z = -Deltat*a**2*sin2thetaprm_z - Deltatprm_z*a**2*sin2theta + 2*w2*w2prm_z
    csiprm_z = -w2prm_z*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_z/2 + Deltarprm_z*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_z = csiprm_z*(1 - abs(1 - tortoise))
    csi2prm_z = csiprm_z*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_z = csi2*(n1prm_z*p1 + n2prm_z*p2 + n3prm_z*p3) + csi2prm_z*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_z = n3*prTprm_z*(1 - 1/csi1) + n3prm_z*prT*(1 - 1/csi1) + csi1prm_z*n3*prT/csi1**2
    phat2prm_z = n2*prTprm_z*(1 - 1/csi1) + n2prm_z*prT*(1 - 1/csi1) + csi1prm_z*n2*prT/csi1**2
    phat1prm_z = n1*prTprm_z*(1 - 1/csi1) + n1prm_z*prT*(1 - 1/csi1) + csi1prm_z*n1*prT/csi1**2
    pdotxirprm_z = r*(phat1*xi1prm_z + phat1prm_z*xi1 + phat2*xi2prm_z + phat2prm_z*xi2 + phat3*xi3prm_z + phat3prm_z*xi3) + rprm_z*(phat1*xi1 + phat2*xi2 + phat3*xi3)
    pdotnprm_z = n1*phat1prm_z + n1prm_z*phat1 + n2*phat2prm_z + n2prm_z*phat2 + n3*phat3prm_z + n3prm_z*phat3
    pdotvrprm_z = r*(phat1*v1prm_z + phat1prm_z*v1 + phat2*v2prm_z + phat2prm_z*v2 + phat3*v3prm_z + phat3prm_z*v3) + rprm_z*(phat1*v1 + phat2*v2 + phat3*v3)
    pphiprm_z = pdotxirprm_z
    Qcoeff2prm_z = -sin2thetaprm_z/(Sigma*sin2theta**2) - Sigmaprm_z/(Sigma**2*sin2theta)
    Qcoeff1prm_z = -Sigma*sin2thetaprm_z/(Lambt*sin2theta**2) + Sigmaprm_z/(Lambt*sin2theta) - Lambtprm_z*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_z = 2*Deltar*pdotn*pdotnprm_z/Sigma - Deltar*Sigmaprm_z*pdotn**2/Sigma**2 + Deltarprm_z*pdotn**2/Sigma
    Qprm_z = DrSipn2prm_z + 2*Qcoeff1*pdotxir*pdotxirprm_z + Qcoeff1prm_z*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_z + Qcoeff2prm_z*pdotvr**2
    Qminus1prm_z = Qprm_z
    Jtildeprm_z = Deltarprm_z/(2*np.sqrt(Deltar))
    exp2muprm_z = Sigmaprm_z
    expmuprm_z = exp2muprm_z/(2*np.sqrt(exp2mu))
    Brtildeprm_z = (np.sqrt(Deltar)*Deltatprimeprm_z - 2*Deltatprm_z + Deltarprm_z*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_z/2 - Deltarprm_z*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_z = Deltatprm_z/(2*np.sqrt(Deltat))
    exp2nuprm_z = Deltat*Sigmaprm_z/Lambt - Deltat*Lambtprm_z*Sigma/Lambt**2 + Deltatprm_z*Sigma/Lambt
    expnuprm_z = exp2nuprm_z/(2*np.sqrt(exp2nu))
    omegaprm_z = omegatildeprm_z/Lambt - Lambtprm_z*omegatilde/Lambt**2
    Lambtprimeprm_z = -2*Deltatprime*a**2*sin2thetaprm_z - 2*Deltatprimeprm_z*a**2*sin2theta + 8*r**2*rprm_z + rprm_z*(4*a**2 + 4*r**2)
    mucosthetaprm_z = a**2*costhetaprm_z/Sigma - Sigmaprm_z*a**2*costheta/Sigma**2
    nucosthetaprm_z = a**2*costheta*w2*(-Deltatprm_z + w2prm_z)/(Lambt*Sigma) + a**2*costheta*w2prm_z*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_z*w2*(-Deltat + w2)/(Lambt*Sigma) - Sigmaprm_z*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_z*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_z = -2*Deltat*a**2*costheta*omegatildeprm_z/Lambt**2 - 2*Deltat*a**2*costhetaprm_z*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_z*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_z*a**2*costheta*omegatilde/Lambt**2
    murprm_z = rprm_z/Sigma - Sigmaprm_z*r/Sigma**2 + Deltarprm_z/(2*Deltar**(3/2))
    nurprm_z = rprm_z/Sigma - Sigmaprm_z*r/Sigma**2 + w2*(-4*Deltat*rprm_z + Deltatprime*w2prm_z + Deltatprimeprm_z*w2 - 4*Deltatprm_z*r)/(2*Deltat*Lambt) + w2prm_z*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_z = (-Lambtprime*omegatildeprm_z - Lambtprimeprm_z*omegatilde + Lambtprm_z*omegatildeprime)/Lambt**2 + Lambtprm_z*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm3prm_z = 3*dSO*eta*u**2*uprm_z
    sigmacoeffTerm2prm_z = eta*(eta*(r*(-882*DrSipn2prm_z + 204*Qminus1prm_z + r*(1620*DrSipn2*DrSipn2prm_z - 234*DrSipn2*Qminus1prm_z - 234*DrSipn2prm_z*Qminus1) + rprm_z*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) + rprm_z*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1))) + r*(-96*DrSipn2prm_z - 436*Qminus1prm_z + r*(36*DrSipn2*Qminus1prm_z + 36*DrSipn2prm_z*Qminus1 - 90*Qminus1*Qminus1prm_z) + rprm_z*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) + rprm_z*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)))/(144*r**2) - eta*rprm_z*(eta*(r*(-882*DrSipn2 + 204*Qminus1 + r*(810*DrSipn2**2 - 234*DrSipn2*Qminus1)) - 336) + r*(-96*DrSipn2 - 436*Qminus1 + r*(36*DrSipn2*Qminus1 - 45*Qminus1**2)) - 896)/(72*r**3)
    sigmacoeffTerm1prm_z = eta*(-36*DrSipn2prm_z + 3*Qminus1prm_z + 8*rprm_z/r**2)/12
    sigmacoeffprm_z = sigmacoeffTerm1prm_z + sigmacoeffTerm2prm_z + sigmacoeffTerm3prm_z
    sigmastarcoeffTerm2prm_z = eta*(eta*(r*(-324*DrSipn2prm_z + 120*Qminus1prm_z + r*(720*DrSipn2*DrSipn2prm_z + Qminus1*(-126*DrSipn2prm_z - 3*Qminus1prm_z) + Qminus1prm_z*(-126*DrSipn2 - 3*Qminus1)) + rprm_z*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) + rprm_z*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1)))) + r*(282*DrSipn2prm_z + Qminus1*r*(96*DrSipn2prm_z - 23*Qminus1prm_z) + Qminus1*rprm_z*(96*DrSipn2 - 23*Qminus1) + Qminus1prm_z*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_z) + rprm_z*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1))/(72*r**2) - eta*rprm_z*(eta*(r*(-324*DrSipn2 + 120*Qminus1 + r*(360*DrSipn2**2 + Qminus1*(-126*DrSipn2 - 3*Qminus1))) - 54) + r*(282*DrSipn2 + Qminus1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1) + 706)/(36*r**3)
    sigmastarcoeffTerm1prm_z = eta*(-30*DrSipn2prm_z + 4*Qminus1prm_z - 14*rprm_z/r**2)/12
    sigmastarcoeffprm_z = sigmastarcoeffTerm1prm_z + sigmastarcoeffTerm2prm_z
    Deltasigmastar3prm_z = sigma3*sigmacoeffprm_z + sigmastar3*sigmastarcoeffprm_z
    Deltasigmastar2prm_z = sigma2*sigmacoeffprm_z + sigmastar2*sigmastarcoeffprm_z
    Deltasigmastar1prm_z = sigma1*sigmacoeffprm_z + sigmastar1*sigmastarcoeffprm_z
    Sstar3prm_z = Deltasigmastar3prm_z
    Sstar2prm_z = Deltasigmastar2prm_z
    Sstar1prm_z = Deltasigmastar1prm_z
    S3prm_z = Sstar3prm_z
    S2prm_z = Sstar2prm_z
    S1prm_z = Sstar1prm_z
    Sstardotnprm_z = Sstar1*n1prm_z + Sstar1prm_z*n1 + Sstar2*n2prm_z + Sstar2prm_z*n2 + Sstar3*n3prm_z + Sstar3prm_z*n3
    SdotSkerrhatprm_z = S1prm_z*Skerrhat1 + S2prm_z*Skerrhat2 + S3prm_z*Skerrhat3
    Sdotnprm_z = S1*n1prm_z + S1prm_z*n1 + S2*n2prm_z + S2prm_z*n2 + S3*n3prm_z + S3prm_z*n3
    Sdotvprm_z = S1*v1prm_z + S1prm_z*v1 + S2*v2prm_z + S2prm_z*v2 + S3*v3prm_z + S3prm_z*v3
    Sdotxiprm_z = S1*xi1prm_z + S1prm_z*xi1 + S2*xi2prm_z + S2prm_z*xi2 + S3*xi3prm_z + S3prm_z*xi3
    HdsumTerm2prm_z = 6*Sstardotn*Sstardotnprm_z
    HdsumTerm1prm_z = 2*Sstar1*Sstar1prm_z + 2*Sstar2*Sstar2prm_z + 2*Sstar3*Sstar3prm_z
    Hdsumprm_z = HdsumTerm1prm_z - HdsumTerm2prm_z
    Hdcoeffprm_z = -3*rprm_z/(2*r**4)
    Q4prm_z = 4*eta*prT**4*u*uprm_z*(4 - 3*eta) + 8*eta*prT**3*prTprm_z*u**2*(4 - 3*eta)
    gammappsumprm_z = 2*Deltar*pdotn*pdotnprm_z/Sigma - Deltar*Sigmaprm_z*pdotn**2/Sigma**2 + Deltarprm_z*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_z/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_z/(Sigma*sin2theta) - Sigmaprm_z*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_z/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_z/(Lambt*sin2theta) + Sigmaprm_z*pdotxir**2/(Lambt*sin2theta) - Lambtprm_z*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_z = Q4prm_z + gammappsumprm_z
    alphaprm_z = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_z/(2*Lambt) - Deltat*Lambtprm_z*Sigma/(2*Lambt**2) + Deltatprm_z*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_z = omegatilde*pphiprm_z/Lambt + omegatildeprm_z*pphi/Lambt - Lambtprm_z*omegatilde*pphi/Lambt**2
    HssTerm3prm_z = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_z - Qprm_z/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_z*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_z*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_z*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_z - Jtilde*Sdotvprm_z*pdotn - Jtildeprm_z*Sdotv*pdotn + Sdotn*pdotvrprm_z + Sdotnprm_z*pdotvr) + pdotvrprm_z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_z*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_z + Btilde*Jtilde*Sdotxiprm_z*pdotn + Btilde*Jtildeprm_z*Sdotxi*pdotn + Btildeprm_z*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_z - Sdotn*expmu*expnuprm_z*pdotxir - Sdotn*expmuprm_z*expnu*pdotxir - Sdotnprm_z*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_z*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_z*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_z*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_z = omegacostheta*(-Qprm_z - Qprm_z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_z/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_z*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_z*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_z*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_z*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_z = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_z - Jtilde*Sdotvprm_z*pdotn - Jtildeprm_z*Sdotv*pdotn + Sdotn*pdotvrprm_z + Sdotnprm_z*pdotvr) + Jtilde*pdotnprm_z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_z*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_z + Qprm_z/(2*np.sqrt(Q))) + Sdotv*exp2muprm_z*(np.sqrt(Q) + Q) + Sdotvprm_z*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_z*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_z*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_z - Btilde*Sdotxi*expnuprm_z*pdotvr - Btilde*Sdotxiprm_z*expnu*pdotvr - Btildeprm_z*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_z + Sdotv*exp2nu*expmuprm_z*pdotxir + Sdotv*exp2nuprm_z*expmu*pdotxir + Sdotvprm_z*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_z*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_z*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_z = Jtilde*omegar*(-Qprm_z - Qprm_z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_z/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_z/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_z*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_z*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_z*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_z*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_z*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_z = SdotSkerrhat*omegaprm_z + SdotSkerrhatprm_z*omega
    Hssprm_z = HssTerm1prm_z + HssTerm2*HssTerm2coeffprm_z + HssTerm2coeff*HssTerm2prm_z + HssTerm3*HssTerm3coeffprm_z + HssTerm3coeff*HssTerm3prm_z
    HsoTerm2cprm_z = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_z*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_z*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_z*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_z*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_z*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_z*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_z*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_z = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_z + Jtilde*Sdotvprm_z*nur + Jtildeprm_z*Sdotv*nur - Sdotn*nucostheta*xisqprm_z - Sdotn*nucosthetaprm_z*xisq - Sdotnprm_z*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_z*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_z*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_z*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_z*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_z*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_z = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_z + nurprm_z*pdotvr + pdotn*xisq*(mucosthetaprm_z - nucosthetaprm_z) + pdotn*xisqprm_z*(mucostheta - nucostheta) + pdotnprm_z*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_z - mucostheta*pdotnprm_z*xisq - mucosthetaprm_z*pdotn*xisq + mur*pdotvrprm_z*(np.sqrt(Q) + 1) + murprm_z*pdotvr*(np.sqrt(Q) + 1) + Qprm_z*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_z*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_z*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_z*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_z*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_z = HsoTerm2aprm_z + HsoTerm2bprm_z - HsoTerm2cprm_z
    HsoTerm2coeffprm_z = expnu*(-Qprm_z - Qprm_z/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_z/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_z/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_z*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_z*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_z = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_z + expmu*expnuprm_z + expmuprm_z*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_z*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_z*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_z*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_z*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_z*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_z = HsoTerm1prm_z + HsoTerm2*HsoTerm2coeffprm_z + HsoTerm2coeff*HsoTerm2prm_z
    Hdprm_z = Hdcoeff*Hdsumprm_z + Hdcoeffprm_z*Hdsum
    Hnsprm_z = np.sqrt(Hnsradicand)*alphaprm_z + betapsumprm_z + Hnsradicandprm_z*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_z = Hsoprm_z + Hssprm_z
    Heffprm_z = -Hdprm_z + Hnsprm_z + Hsprm_z + 4*dSS*eta*u**3*uprm_z*(S1x**2 + S1y**2 + S1z**2 + S2x**2 + S2y**2 + S2z**2)
    Hrealprm_z = Heffprm_z*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_z, csiprm_z])
def new_compute_dHdp1(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    prTprm_p1 = csi2*n1
    phat3prm_p1 = n3*prTprm_p1*(1 - 1/csi1)
    phat2prm_p1 = n2*prTprm_p1*(1 - 1/csi1)
    phat1prm_p1 = n1*prTprm_p1*(1 - 1/csi1) + 1
    pdotxirprm_p1 = r*(phat1prm_p1*xi1 + phat2prm_p1*xi2 + phat3prm_p1*xi3)
    pdotnprm_p1 = n1*phat1prm_p1 + n2*phat2prm_p1 + n3*phat3prm_p1
    pdotvrprm_p1 = r*(phat1prm_p1*v1 + phat2prm_p1*v2 + phat3prm_p1*v3)
    pphiprm_p1 = pdotxirprm_p1
    DrSipn2prm_p1 = 2*Deltar*pdotn*pdotnprm_p1/Sigma
    Qprm_p1 = DrSipn2prm_p1 + 2*Qcoeff1*pdotxir*pdotxirprm_p1 + 2*Qcoeff2*pdotvr*pdotvrprm_p1
    Qminus1prm_p1 = Qprm_p1
    sigmacoeffTerm2prm_p1 = eta*(eta*r*(-882*DrSipn2prm_p1 + 204*Qminus1prm_p1 + r*(1620*DrSipn2*DrSipn2prm_p1 - 234*DrSipn2*Qminus1prm_p1 - 234*DrSipn2prm_p1*Qminus1)) + r*(-96*DrSipn2prm_p1 - 436*Qminus1prm_p1 + r*(36*DrSipn2*Qminus1prm_p1 + 36*DrSipn2prm_p1*Qminus1 - 90*Qminus1*Qminus1prm_p1)))/(144*r**2)
    sigmacoeffTerm1prm_p1 = eta*(-36*DrSipn2prm_p1 + 3*Qminus1prm_p1)/12
    sigmacoeffprm_p1 = sigmacoeffTerm1prm_p1 + sigmacoeffTerm2prm_p1
    sigmastarcoeffTerm2prm_p1 = eta*(eta*r*(-324*DrSipn2prm_p1 + 120*Qminus1prm_p1 + r*(720*DrSipn2*DrSipn2prm_p1 + Qminus1*(-126*DrSipn2prm_p1 - 3*Qminus1prm_p1) + Qminus1prm_p1*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_p1 + Qminus1*r*(96*DrSipn2prm_p1 - 23*Qminus1prm_p1) + Qminus1prm_p1*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_p1))/(72*r**2)
    sigmastarcoeffTerm1prm_p1 = eta*(-30*DrSipn2prm_p1 + 4*Qminus1prm_p1)/12
    sigmastarcoeffprm_p1 = sigmastarcoeffTerm1prm_p1 + sigmastarcoeffTerm2prm_p1
    Deltasigmastar3prm_p1 = sigma3*sigmacoeffprm_p1 + sigmastar3*sigmastarcoeffprm_p1
    Deltasigmastar2prm_p1 = sigma2*sigmacoeffprm_p1 + sigmastar2*sigmastarcoeffprm_p1
    Deltasigmastar1prm_p1 = sigma1*sigmacoeffprm_p1 + sigmastar1*sigmastarcoeffprm_p1
    Sstar3prm_p1 = Deltasigmastar3prm_p1
    Sstar2prm_p1 = Deltasigmastar2prm_p1
    Sstar1prm_p1 = Deltasigmastar1prm_p1
    S3prm_p1 = Sstar3prm_p1
    S2prm_p1 = Sstar2prm_p1
    S1prm_p1 = Sstar1prm_p1
    Sstardotnprm_p1 = Sstar1prm_p1*n1 + Sstar2prm_p1*n2 + Sstar3prm_p1*n3
    SdotSkerrhatprm_p1 = S1prm_p1*Skerrhat1 + S2prm_p1*Skerrhat2 + S3prm_p1*Skerrhat3
    Sdotnprm_p1 = S1prm_p1*n1 + S2prm_p1*n2 + S3prm_p1*n3
    Sdotvprm_p1 = S1prm_p1*v1 + S2prm_p1*v2 + S3prm_p1*v3
    Sdotxiprm_p1 = S1prm_p1*xi1 + S2prm_p1*xi2 + S3prm_p1*xi3
    HdsumTerm2prm_p1 = 6*Sstardotn*Sstardotnprm_p1
    HdsumTerm1prm_p1 = 2*Sstar1*Sstar1prm_p1 + 2*Sstar2*Sstar2prm_p1 + 2*Sstar3*Sstar3prm_p1
    Hdsumprm_p1 = HdsumTerm1prm_p1 - HdsumTerm2prm_p1
    Q4prm_p1 = 8*eta*prT**3*prTprm_p1*u**2*(4 - 3*eta)
    gammappsumprm_p1 = 2*Deltar*pdotn*pdotnprm_p1/Sigma + 2*pdotvr*pdotvrprm_p1/(Sigma*sin2theta) + 2*Sigma*pdotxir*pdotxirprm_p1/(Lambt*sin2theta)
    Hnsradicandprm_p1 = Q4prm_p1 + gammappsumprm_p1
    betapsumprm_p1 = omegatilde*pphiprm_p1/Lambt
    HssTerm3prm_p1 = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_p1 - Qprm_p1/(2*np.sqrt(Q))) + Sdotnprm_p1*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_p1 - Jtilde*Sdotvprm_p1*pdotn + Sdotn*pdotvrprm_p1 + Sdotnprm_p1*pdotvr) + pdotvrprm_p1*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_p1 + Btilde*Jtilde*Sdotxiprm_p1*pdotn - Sdotn*expmu*expnu*pdotxirprm_p1 - Sdotnprm_p1*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_p1*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_p1 = omegacostheta*(-Qprm_p1 - Qprm_p1/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2)
    HssTerm2prm_p1 = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_p1 - Jtilde*Sdotvprm_p1*pdotn + Sdotn*pdotvrprm_p1 + Sdotnprm_p1*pdotvr) + Jtilde*pdotnprm_p1*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_p1 + Qprm_p1/(2*np.sqrt(Q))) + Sdotvprm_p1*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_p1 - Btilde*Sdotxiprm_p1*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_p1 + Sdotvprm_p1*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_p1*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_p1 = Jtilde*omegar*(-Qprm_p1 - Qprm_p1/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2)
    HssTerm1prm_p1 = SdotSkerrhatprm_p1*omega
    Hssprm_p1 = HssTerm1prm_p1 + HssTerm2*HssTerm2coeffprm_p1 + HssTerm2coeff*HssTerm2prm_p1 + HssTerm3*HssTerm3coeffprm_p1 + HssTerm3coeff*HssTerm3prm_p1
    HsoTerm2cprm_p1 = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_p1*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_p1*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_p1*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q))
    HsoTerm2bprm_p1 = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotvprm_p1*nur - Sdotnprm_p1*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_p1*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_p1*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q)
    HsoTerm2aprm_p1 = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_p1 + pdotnprm_p1*xisq*(mucostheta - nucostheta)) - mucostheta*pdotnprm_p1*xisq + mur*pdotvrprm_p1*(np.sqrt(Q) + 1) + Qprm_p1*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_p1*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_p1*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_p1 = HsoTerm2aprm_p1 + HsoTerm2bprm_p1 - HsoTerm2cprm_p1
    HsoTerm2coeffprm_p1 = expnu*(-Qprm_p1 - Qprm_p1/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2)
    HsoTerm1prm_p1 = SdotSkerrhat*exp2nu*pdotxirprm_p1*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_p1*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_p1*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq)
    Hsoprm_p1 = HsoTerm1prm_p1 + HsoTerm2*HsoTerm2coeffprm_p1 + HsoTerm2coeff*HsoTerm2prm_p1
    Hdprm_p1 = Hdcoeff*Hdsumprm_p1
    Hnsprm_p1 = betapsumprm_p1 + Hnsradicandprm_p1*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_p1 = Hsoprm_p1 + Hssprm_p1
    Heffprm_p1 = -Hdprm_p1 + Hnsprm_p1 + Hsprm_p1
    Hrealprm_p1 = Heffprm_p1*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_p1])
def new_compute_dHdp2(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    prTprm_p2 = csi2*n2
    phat3prm_p2 = n3*prTprm_p2*(1 - 1/csi1)
    phat2prm_p2 = n2*prTprm_p2*(1 - 1/csi1) + 1
    phat1prm_p2 = n1*prTprm_p2*(1 - 1/csi1)
    pdotxirprm_p2 = r*(phat1prm_p2*xi1 + phat2prm_p2*xi2 + phat3prm_p2*xi3)
    pdotnprm_p2 = n1*phat1prm_p2 + n2*phat2prm_p2 + n3*phat3prm_p2
    pdotvrprm_p2 = r*(phat1prm_p2*v1 + phat2prm_p2*v2 + phat3prm_p2*v3)
    pphiprm_p2 = pdotxirprm_p2
    DrSipn2prm_p2 = 2*Deltar*pdotn*pdotnprm_p2/Sigma
    Qprm_p2 = DrSipn2prm_p2 + 2*Qcoeff1*pdotxir*pdotxirprm_p2 + 2*Qcoeff2*pdotvr*pdotvrprm_p2
    Qminus1prm_p2 = Qprm_p2
    sigmacoeffTerm2prm_p2 = eta*(eta*r*(-882*DrSipn2prm_p2 + 204*Qminus1prm_p2 + r*(1620*DrSipn2*DrSipn2prm_p2 - 234*DrSipn2*Qminus1prm_p2 - 234*DrSipn2prm_p2*Qminus1)) + r*(-96*DrSipn2prm_p2 - 436*Qminus1prm_p2 + r*(36*DrSipn2*Qminus1prm_p2 + 36*DrSipn2prm_p2*Qminus1 - 90*Qminus1*Qminus1prm_p2)))/(144*r**2)
    sigmacoeffTerm1prm_p2 = eta*(-36*DrSipn2prm_p2 + 3*Qminus1prm_p2)/12
    sigmacoeffprm_p2 = sigmacoeffTerm1prm_p2 + sigmacoeffTerm2prm_p2
    sigmastarcoeffTerm2prm_p2 = eta*(eta*r*(-324*DrSipn2prm_p2 + 120*Qminus1prm_p2 + r*(720*DrSipn2*DrSipn2prm_p2 + Qminus1*(-126*DrSipn2prm_p2 - 3*Qminus1prm_p2) + Qminus1prm_p2*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_p2 + Qminus1*r*(96*DrSipn2prm_p2 - 23*Qminus1prm_p2) + Qminus1prm_p2*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_p2))/(72*r**2)
    sigmastarcoeffTerm1prm_p2 = eta*(-30*DrSipn2prm_p2 + 4*Qminus1prm_p2)/12
    sigmastarcoeffprm_p2 = sigmastarcoeffTerm1prm_p2 + sigmastarcoeffTerm2prm_p2
    Deltasigmastar3prm_p2 = sigma3*sigmacoeffprm_p2 + sigmastar3*sigmastarcoeffprm_p2
    Deltasigmastar2prm_p2 = sigma2*sigmacoeffprm_p2 + sigmastar2*sigmastarcoeffprm_p2
    Deltasigmastar1prm_p2 = sigma1*sigmacoeffprm_p2 + sigmastar1*sigmastarcoeffprm_p2
    Sstar3prm_p2 = Deltasigmastar3prm_p2
    Sstar2prm_p2 = Deltasigmastar2prm_p2
    Sstar1prm_p2 = Deltasigmastar1prm_p2
    S3prm_p2 = Sstar3prm_p2
    S2prm_p2 = Sstar2prm_p2
    S1prm_p2 = Sstar1prm_p2
    Sstardotnprm_p2 = Sstar1prm_p2*n1 + Sstar2prm_p2*n2 + Sstar3prm_p2*n3
    SdotSkerrhatprm_p2 = S1prm_p2*Skerrhat1 + S2prm_p2*Skerrhat2 + S3prm_p2*Skerrhat3
    Sdotnprm_p2 = S1prm_p2*n1 + S2prm_p2*n2 + S3prm_p2*n3
    Sdotvprm_p2 = S1prm_p2*v1 + S2prm_p2*v2 + S3prm_p2*v3
    Sdotxiprm_p2 = S1prm_p2*xi1 + S2prm_p2*xi2 + S3prm_p2*xi3
    HdsumTerm2prm_p2 = 6*Sstardotn*Sstardotnprm_p2
    HdsumTerm1prm_p2 = 2*Sstar1*Sstar1prm_p2 + 2*Sstar2*Sstar2prm_p2 + 2*Sstar3*Sstar3prm_p2
    Hdsumprm_p2 = HdsumTerm1prm_p2 - HdsumTerm2prm_p2
    Q4prm_p2 = 8*eta*prT**3*prTprm_p2*u**2*(4 - 3*eta)
    gammappsumprm_p2 = 2*Deltar*pdotn*pdotnprm_p2/Sigma + 2*pdotvr*pdotvrprm_p2/(Sigma*sin2theta) + 2*Sigma*pdotxir*pdotxirprm_p2/(Lambt*sin2theta)
    Hnsradicandprm_p2 = Q4prm_p2 + gammappsumprm_p2
    betapsumprm_p2 = omegatilde*pphiprm_p2/Lambt
    HssTerm3prm_p2 = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_p2 - Qprm_p2/(2*np.sqrt(Q))) + Sdotnprm_p2*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_p2 - Jtilde*Sdotvprm_p2*pdotn + Sdotn*pdotvrprm_p2 + Sdotnprm_p2*pdotvr) + pdotvrprm_p2*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_p2 + Btilde*Jtilde*Sdotxiprm_p2*pdotn - Sdotn*expmu*expnu*pdotxirprm_p2 - Sdotnprm_p2*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_p2*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_p2 = omegacostheta*(-Qprm_p2 - Qprm_p2/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2)
    HssTerm2prm_p2 = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_p2 - Jtilde*Sdotvprm_p2*pdotn + Sdotn*pdotvrprm_p2 + Sdotnprm_p2*pdotvr) + Jtilde*pdotnprm_p2*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_p2 + Qprm_p2/(2*np.sqrt(Q))) + Sdotvprm_p2*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_p2 - Btilde*Sdotxiprm_p2*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_p2 + Sdotvprm_p2*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_p2*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_p2 = Jtilde*omegar*(-Qprm_p2 - Qprm_p2/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2)
    HssTerm1prm_p2 = SdotSkerrhatprm_p2*omega
    Hssprm_p2 = HssTerm1prm_p2 + HssTerm2*HssTerm2coeffprm_p2 + HssTerm2coeff*HssTerm2prm_p2 + HssTerm3*HssTerm3coeffprm_p2 + HssTerm3coeff*HssTerm3prm_p2
    HsoTerm2cprm_p2 = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_p2*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_p2*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_p2*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q))
    HsoTerm2bprm_p2 = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotvprm_p2*nur - Sdotnprm_p2*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_p2*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_p2*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q)
    HsoTerm2aprm_p2 = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_p2 + pdotnprm_p2*xisq*(mucostheta - nucostheta)) - mucostheta*pdotnprm_p2*xisq + mur*pdotvrprm_p2*(np.sqrt(Q) + 1) + Qprm_p2*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_p2*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_p2*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_p2 = HsoTerm2aprm_p2 + HsoTerm2bprm_p2 - HsoTerm2cprm_p2
    HsoTerm2coeffprm_p2 = expnu*(-Qprm_p2 - Qprm_p2/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2)
    HsoTerm1prm_p2 = SdotSkerrhat*exp2nu*pdotxirprm_p2*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_p2*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_p2*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq)
    Hsoprm_p2 = HsoTerm1prm_p2 + HsoTerm2*HsoTerm2coeffprm_p2 + HsoTerm2coeff*HsoTerm2prm_p2
    Hdprm_p2 = Hdcoeff*Hdsumprm_p2
    Hnsprm_p2 = betapsumprm_p2 + Hnsradicandprm_p2*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_p2 = Hsoprm_p2 + Hssprm_p2
    Heffprm_p2 = -Hdprm_p2 + Hnsprm_p2 + Hsprm_p2
    Hrealprm_p2 = Heffprm_p2*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_p2])
def new_compute_dHdp3(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    prTprm_p3 = csi2*n3
    phat3prm_p3 = n3*prTprm_p3*(1 - 1/csi1) + 1
    phat2prm_p3 = n2*prTprm_p3*(1 - 1/csi1)
    phat1prm_p3 = n1*prTprm_p3*(1 - 1/csi1)
    pdotxirprm_p3 = r*(phat1prm_p3*xi1 + phat2prm_p3*xi2 + phat3prm_p3*xi3)
    pdotnprm_p3 = n1*phat1prm_p3 + n2*phat2prm_p3 + n3*phat3prm_p3
    pdotvrprm_p3 = r*(phat1prm_p3*v1 + phat2prm_p3*v2 + phat3prm_p3*v3)
    pphiprm_p3 = pdotxirprm_p3
    DrSipn2prm_p3 = 2*Deltar*pdotn*pdotnprm_p3/Sigma
    Qprm_p3 = DrSipn2prm_p3 + 2*Qcoeff1*pdotxir*pdotxirprm_p3 + 2*Qcoeff2*pdotvr*pdotvrprm_p3
    Qminus1prm_p3 = Qprm_p3
    sigmacoeffTerm2prm_p3 = eta*(eta*r*(-882*DrSipn2prm_p3 + 204*Qminus1prm_p3 + r*(1620*DrSipn2*DrSipn2prm_p3 - 234*DrSipn2*Qminus1prm_p3 - 234*DrSipn2prm_p3*Qminus1)) + r*(-96*DrSipn2prm_p3 - 436*Qminus1prm_p3 + r*(36*DrSipn2*Qminus1prm_p3 + 36*DrSipn2prm_p3*Qminus1 - 90*Qminus1*Qminus1prm_p3)))/(144*r**2)
    sigmacoeffTerm1prm_p3 = eta*(-36*DrSipn2prm_p3 + 3*Qminus1prm_p3)/12
    sigmacoeffprm_p3 = sigmacoeffTerm1prm_p3 + sigmacoeffTerm2prm_p3
    sigmastarcoeffTerm2prm_p3 = eta*(eta*r*(-324*DrSipn2prm_p3 + 120*Qminus1prm_p3 + r*(720*DrSipn2*DrSipn2prm_p3 + Qminus1*(-126*DrSipn2prm_p3 - 3*Qminus1prm_p3) + Qminus1prm_p3*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_p3 + Qminus1*r*(96*DrSipn2prm_p3 - 23*Qminus1prm_p3) + Qminus1prm_p3*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_p3))/(72*r**2)
    sigmastarcoeffTerm1prm_p3 = eta*(-30*DrSipn2prm_p3 + 4*Qminus1prm_p3)/12
    sigmastarcoeffprm_p3 = sigmastarcoeffTerm1prm_p3 + sigmastarcoeffTerm2prm_p3
    Deltasigmastar3prm_p3 = sigma3*sigmacoeffprm_p3 + sigmastar3*sigmastarcoeffprm_p3
    Deltasigmastar2prm_p3 = sigma2*sigmacoeffprm_p3 + sigmastar2*sigmastarcoeffprm_p3
    Deltasigmastar1prm_p3 = sigma1*sigmacoeffprm_p3 + sigmastar1*sigmastarcoeffprm_p3
    Sstar3prm_p3 = Deltasigmastar3prm_p3
    Sstar2prm_p3 = Deltasigmastar2prm_p3
    Sstar1prm_p3 = Deltasigmastar1prm_p3
    S3prm_p3 = Sstar3prm_p3
    S2prm_p3 = Sstar2prm_p3
    S1prm_p3 = Sstar1prm_p3
    Sstardotnprm_p3 = Sstar1prm_p3*n1 + Sstar2prm_p3*n2 + Sstar3prm_p3*n3
    SdotSkerrhatprm_p3 = S1prm_p3*Skerrhat1 + S2prm_p3*Skerrhat2 + S3prm_p3*Skerrhat3
    Sdotnprm_p3 = S1prm_p3*n1 + S2prm_p3*n2 + S3prm_p3*n3
    Sdotvprm_p3 = S1prm_p3*v1 + S2prm_p3*v2 + S3prm_p3*v3
    Sdotxiprm_p3 = S1prm_p3*xi1 + S2prm_p3*xi2 + S3prm_p3*xi3
    HdsumTerm2prm_p3 = 6*Sstardotn*Sstardotnprm_p3
    HdsumTerm1prm_p3 = 2*Sstar1*Sstar1prm_p3 + 2*Sstar2*Sstar2prm_p3 + 2*Sstar3*Sstar3prm_p3
    Hdsumprm_p3 = HdsumTerm1prm_p3 - HdsumTerm2prm_p3
    Q4prm_p3 = 8*eta*prT**3*prTprm_p3*u**2*(4 - 3*eta)
    gammappsumprm_p3 = 2*Deltar*pdotn*pdotnprm_p3/Sigma + 2*pdotvr*pdotvrprm_p3/(Sigma*sin2theta) + 2*Sigma*pdotxir*pdotxirprm_p3/(Lambt*sin2theta)
    Hnsradicandprm_p3 = Q4prm_p3 + gammappsumprm_p3
    betapsumprm_p3 = omegatilde*pphiprm_p3/Lambt
    HssTerm3prm_p3 = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_p3 - Qprm_p3/(2*np.sqrt(Q))) + Sdotnprm_p3*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_p3 - Jtilde*Sdotvprm_p3*pdotn + Sdotn*pdotvrprm_p3 + Sdotnprm_p3*pdotvr) + pdotvrprm_p3*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_p3 + Btilde*Jtilde*Sdotxiprm_p3*pdotn - Sdotn*expmu*expnu*pdotxirprm_p3 - Sdotnprm_p3*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_p3*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_p3 = omegacostheta*(-Qprm_p3 - Qprm_p3/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2)
    HssTerm2prm_p3 = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_p3 - Jtilde*Sdotvprm_p3*pdotn + Sdotn*pdotvrprm_p3 + Sdotnprm_p3*pdotvr) + Jtilde*pdotnprm_p3*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_p3 + Qprm_p3/(2*np.sqrt(Q))) + Sdotvprm_p3*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_p3 - Btilde*Sdotxiprm_p3*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_p3 + Sdotvprm_p3*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_p3*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_p3 = Jtilde*omegar*(-Qprm_p3 - Qprm_p3/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2)
    HssTerm1prm_p3 = SdotSkerrhatprm_p3*omega
    Hssprm_p3 = HssTerm1prm_p3 + HssTerm2*HssTerm2coeffprm_p3 + HssTerm2coeff*HssTerm2prm_p3 + HssTerm3*HssTerm3coeffprm_p3 + HssTerm3coeff*HssTerm3prm_p3
    HsoTerm2cprm_p3 = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_p3*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_p3*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_p3*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q))
    HsoTerm2bprm_p3 = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotvprm_p3*nur - Sdotnprm_p3*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_p3*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_p3*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q)
    HsoTerm2aprm_p3 = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_p3 + pdotnprm_p3*xisq*(mucostheta - nucostheta)) - mucostheta*pdotnprm_p3*xisq + mur*pdotvrprm_p3*(np.sqrt(Q) + 1) + Qprm_p3*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_p3*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_p3*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_p3 = HsoTerm2aprm_p3 + HsoTerm2bprm_p3 - HsoTerm2cprm_p3
    HsoTerm2coeffprm_p3 = expnu*(-Qprm_p3 - Qprm_p3/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2)
    HsoTerm1prm_p3 = SdotSkerrhat*exp2nu*pdotxirprm_p3*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_p3*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_p3*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq)
    Hsoprm_p3 = HsoTerm1prm_p3 + HsoTerm2*HsoTerm2coeffprm_p3 + HsoTerm2coeff*HsoTerm2prm_p3
    Hdprm_p3 = Hdcoeff*Hdsumprm_p3
    Hnsprm_p3 = betapsumprm_p3 + Hnsradicandprm_p3*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_p3 = Hsoprm_p3 + Hssprm_p3
    Heffprm_p3 = -Hdprm_p3 + Hnsprm_p3 + Hsprm_p3
    Hrealprm_p3 = Heffprm_p3*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_p3])
def new_compute_dHdS1x(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar1prm_S1x = m2/m1
    sigma1prm_S1x = 1
    Skerr1prm_S1x = sigma1prm_S1x
    Skerrmagprm_S1x = Skerr1*Skerr1prm_S1x/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S1x = -Skerr3*Skerrmagprm_S1x/Skerrmag**2
    Skerrhat2prm_S1x = -Skerr2*Skerrmagprm_S1x/Skerrmag**2
    Skerrhat1prm_S1x = -Skerr1*Skerrmagprm_S1x/Skerrmag**2 + Skerr1prm_S1x/Skerrmag
    aprm_S1x = Skerrmagprm_S1x
    e33prm_S1x = Skerrhat3prm_S1x
    e32prm_S1x = Skerrhat2prm_S1x
    e31prm_S1x = Skerrhat1prm_S1x
    xi3prm_S1x = e31prm_S1x*n2 - e32prm_S1x*n1
    xi2prm_S1x = -e31prm_S1x*n3 + e33prm_S1x*n1
    xi1prm_S1x = e32prm_S1x*n3 - e33prm_S1x*n2
    v3prm_S1x = n1*xi2prm_S1x - n2*xi1prm_S1x
    v2prm_S1x = -n1*xi3prm_S1x + n3*xi1prm_S1x
    v1prm_S1x = n2*xi3prm_S1x - n3*xi2prm_S1x
    costhetaprm_S1x = e31prm_S1x*n1 + e32prm_S1x*n2 + e33prm_S1x*n3
    sin2thetaprm_S1x = -2*costheta*costhetaprm_S1x
    xisqprm_S1x = sin2thetaprm_S1x
    w2prm_S1x = 2*a*aprm_S1x
    Sigmaprm_S1x = 2*a**2*costheta*costhetaprm_S1x + 2*a*aprm_S1x*costheta**2
    omegatildeprm_S1x = 2*aprm_S1x*r
    Delta2prm_S1x = -2*Delta0*a*aprm_S1x*etaKminus1**2
    Delta3prm_S1x = Delta1*Delta2prm_S1x - 2*Delta1*a*aprm_S1x*etaKminus1**2 - 2*Delta2prm_S1x*etaKminus1
    Delta4prm_S1x = -Delta1**2*Delta2prm_S1x + Delta1*(2*Delta2prm_S1x*etaKminus1 + Delta3prm_S1x) + Delta2*Delta2prm_S1x - Delta2prm_S1x*a**2*etaKminus1**2 - 2*Delta3prm_S1x*etaKminus1 + a*aprm_S1x*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S1x = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S1x + 3*Delta3prm_S1x)/3 + a*aprm_S1x*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S1x + 4*Delta1*Delta3prm_S1x + 4*Delta2*Delta2prm_S1x - 4*Delta4prm_S1x)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S1x + 5*Delta1**2*Delta3prm_S1x + 10*Delta1*Delta2*Delta2prm_S1x - 5*Delta1*Delta4prm_S1x - 5*Delta2*Delta3prm_S1x - 5*Delta2prm_S1x*Delta3)/(5*etaKminus1**2))
    logargprm_S1x = u**2*(Delta2prm_S1x + u*(Delta3prm_S1x + u*(Delta4prm_S1x + Delta5prm_S1x*u)))
    Deltaucalibprm_S1x = eta*logargprm_S1x/(logarg + 1)
    Deltaucalibprimeprm_S1x = eta*logargprm_S1x*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S1x + u*(3*Delta3prm_S1x + u*(4*Delta4prm_S1x + 5*Delta5prm_S1x*u)))/(logarg + 1)
    Deltaubarprm_S1x = 2*a*aprm_S1x*u**2
    Deltaubarprimeprm_S1x = -4*a*aprm_S1x*u**3
    Deltauprm_S1x = Deltaubar*Deltaucalibprm_S1x + Deltaubarprm_S1x*Deltaucalib
    Deltauprimeprm_S1x = Deltaubar*Deltaucalibprimeprm_S1x + Deltaubarprime*Deltaucalibprm_S1x + Deltaubarprimeprm_S1x*Deltaucalib + Deltaubarprm_S1x*Deltaucalibprime
    Deltatprimeprm_S1x = Deltauprimeprm_S1x*r**2 + 2*Deltauprm_S1x*r
    Deltatprm_S1x = Deltauprm_S1x*r**2
    Deltarprm_S1x = Deltatprm_S1x*Dinv
    Lambtprm_S1x = -Deltat*a**2*sin2thetaprm_S1x - 2*Deltat*a*aprm_S1x*sin2theta - Deltatprm_S1x*a**2*sin2theta + 2*w2*w2prm_S1x
    csiprm_S1x = -w2prm_S1x*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S1x/2 + Deltarprm_S1x*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S1x = csiprm_S1x*(1 - abs(1 - tortoise))
    csi2prm_S1x = csiprm_S1x*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S1x = csi2prm_S1x*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S1x = n3*prTprm_S1x*(1 - 1/csi1) + csi1prm_S1x*n3*prT/csi1**2
    phat2prm_S1x = n2*prTprm_S1x*(1 - 1/csi1) + csi1prm_S1x*n2*prT/csi1**2
    phat1prm_S1x = n1*prTprm_S1x*(1 - 1/csi1) + csi1prm_S1x*n1*prT/csi1**2
    pdotxirprm_S1x = r*(phat1*xi1prm_S1x + phat1prm_S1x*xi1 + phat2*xi2prm_S1x + phat2prm_S1x*xi2 + phat3*xi3prm_S1x + phat3prm_S1x*xi3)
    pdotnprm_S1x = n1*phat1prm_S1x + n2*phat2prm_S1x + n3*phat3prm_S1x
    pdotvrprm_S1x = r*(phat1*v1prm_S1x + phat1prm_S1x*v1 + phat2*v2prm_S1x + phat2prm_S1x*v2 + phat3*v3prm_S1x + phat3prm_S1x*v3)
    pphiprm_S1x = pdotxirprm_S1x
    Qcoeff2prm_S1x = -sin2thetaprm_S1x/(Sigma*sin2theta**2) - Sigmaprm_S1x/(Sigma**2*sin2theta)
    Qcoeff1prm_S1x = -Sigma*sin2thetaprm_S1x/(Lambt*sin2theta**2) + Sigmaprm_S1x/(Lambt*sin2theta) - Lambtprm_S1x*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S1x = 2*Deltar*pdotn*pdotnprm_S1x/Sigma - Deltar*Sigmaprm_S1x*pdotn**2/Sigma**2 + Deltarprm_S1x*pdotn**2/Sigma
    Qprm_S1x = DrSipn2prm_S1x + 2*Qcoeff1*pdotxir*pdotxirprm_S1x + Qcoeff1prm_S1x*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S1x + Qcoeff2prm_S1x*pdotvr**2
    Qminus1prm_S1x = Qprm_S1x
    Jtildeprm_S1x = Deltarprm_S1x/(2*np.sqrt(Deltar))
    exp2muprm_S1x = Sigmaprm_S1x
    expmuprm_S1x = exp2muprm_S1x/(2*np.sqrt(exp2mu))
    Brtildeprm_S1x = (np.sqrt(Deltar)*Deltatprimeprm_S1x - 2*Deltatprm_S1x + Deltarprm_S1x*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S1x/2 - Deltarprm_S1x*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S1x = Deltatprm_S1x/(2*np.sqrt(Deltat))
    exp2nuprm_S1x = Deltat*Sigmaprm_S1x/Lambt - Deltat*Lambtprm_S1x*Sigma/Lambt**2 + Deltatprm_S1x*Sigma/Lambt
    expnuprm_S1x = exp2nuprm_S1x/(2*np.sqrt(exp2nu))
    omegaprm_S1x = omegatildeprm_S1x/Lambt - Lambtprm_S1x*omegatilde/Lambt**2
    omegatildeprimeprm_S1x = 2*aprm_S1x
    Lambtprimeprm_S1x = -2*Deltatprime*a**2*sin2thetaprm_S1x - 4*Deltatprime*a*aprm_S1x*sin2theta - 2*Deltatprimeprm_S1x*a**2*sin2theta + 8*a*aprm_S1x*r
    mucosthetaprm_S1x = a**2*costhetaprm_S1x/Sigma + 2*a*aprm_S1x*costheta/Sigma - Sigmaprm_S1x*a**2*costheta/Sigma**2
    nucosthetaprm_S1x = a**2*costheta*w2*(-Deltatprm_S1x + w2prm_S1x)/(Lambt*Sigma) + a**2*costheta*w2prm_S1x*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S1x*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S1x*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S1x*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S1x*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S1x = -2*Deltat*a**2*costheta*omegatildeprm_S1x/Lambt**2 - 2*Deltat*a**2*costhetaprm_S1x*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S1x*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S1x*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S1x*a**2*costheta*omegatilde/Lambt**2
    murprm_S1x = -Sigmaprm_S1x*r/Sigma**2 + Deltarprm_S1x/(2*Deltar**(3/2))
    nurprm_S1x = -Sigmaprm_S1x*r/Sigma**2 + w2*(Deltatprime*w2prm_S1x + Deltatprimeprm_S1x*w2 - 4*Deltatprm_S1x*r)/(2*Deltat*Lambt) + w2prm_S1x*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S1x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S1x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S1x = (Lambt*omegatildeprimeprm_S1x - Lambtprime*omegatildeprm_S1x - Lambtprimeprm_S1x*omegatilde + Lambtprm_S1x*omegatildeprime)/Lambt**2 + Lambtprm_S1x*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S1x = eta*(eta*r*(-882*DrSipn2prm_S1x + 204*Qminus1prm_S1x + r*(1620*DrSipn2*DrSipn2prm_S1x - 234*DrSipn2*Qminus1prm_S1x - 234*DrSipn2prm_S1x*Qminus1)) + r*(-96*DrSipn2prm_S1x - 436*Qminus1prm_S1x + r*(36*DrSipn2*Qminus1prm_S1x + 36*DrSipn2prm_S1x*Qminus1 - 90*Qminus1*Qminus1prm_S1x)))/(144*r**2)
    sigmacoeffTerm1prm_S1x = eta*(-36*DrSipn2prm_S1x + 3*Qminus1prm_S1x)/12
    sigmacoeffprm_S1x = sigmacoeffTerm1prm_S1x + sigmacoeffTerm2prm_S1x
    sigmastarcoeffTerm2prm_S1x = eta*(eta*r*(-324*DrSipn2prm_S1x + 120*Qminus1prm_S1x + r*(720*DrSipn2*DrSipn2prm_S1x + Qminus1*(-126*DrSipn2prm_S1x - 3*Qminus1prm_S1x) + Qminus1prm_S1x*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S1x + Qminus1*r*(96*DrSipn2prm_S1x - 23*Qminus1prm_S1x) + Qminus1prm_S1x*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S1x))/(72*r**2)
    sigmastarcoeffTerm1prm_S1x = eta*(-30*DrSipn2prm_S1x + 4*Qminus1prm_S1x)/12
    sigmastarcoeffprm_S1x = sigmastarcoeffTerm1prm_S1x + sigmastarcoeffTerm2prm_S1x
    Deltasigmastar3prm_S1x = sigma3*sigmacoeffprm_S1x + sigmastar3*sigmastarcoeffprm_S1x
    Deltasigmastar2prm_S1x = sigma2*sigmacoeffprm_S1x + sigmastar2*sigmastarcoeffprm_S1x
    Deltasigmastar1prm_S1x = sigma1*sigmacoeffprm_S1x + sigma1prm_S1x*sigmacoeff + sigmastar1*sigmastarcoeffprm_S1x + sigmastar1prm_S1x*sigmastarcoeff
    Sstar3prm_S1x = Deltasigmastar3prm_S1x
    Sstar2prm_S1x = Deltasigmastar2prm_S1x
    Sstar1prm_S1x = Deltasigmastar1prm_S1x + sigmastar1prm_S1x
    S3prm_S1x = Sstar3prm_S1x
    S2prm_S1x = Sstar2prm_S1x
    S1prm_S1x = Sstar1prm_S1x
    Sstardotnprm_S1x = Sstar1prm_S1x*n1 + Sstar2prm_S1x*n2 + Sstar3prm_S1x*n3
    SdotSkerrhatprm_S1x = S1*Skerrhat1prm_S1x + S1prm_S1x*Skerrhat1 + S2*Skerrhat2prm_S1x + S2prm_S1x*Skerrhat2 + S3*Skerrhat3prm_S1x + S3prm_S1x*Skerrhat3
    Sdotnprm_S1x = S1prm_S1x*n1 + S2prm_S1x*n2 + S3prm_S1x*n3
    Sdotvprm_S1x = S1*v1prm_S1x + S1prm_S1x*v1 + S2*v2prm_S1x + S2prm_S1x*v2 + S3*v3prm_S1x + S3prm_S1x*v3
    Sdotxiprm_S1x = S1*xi1prm_S1x + S1prm_S1x*xi1 + S2*xi2prm_S1x + S2prm_S1x*xi2 + S3*xi3prm_S1x + S3prm_S1x*xi3
    HdsumTerm2prm_S1x = 6*Sstardotn*Sstardotnprm_S1x
    HdsumTerm1prm_S1x = 2*Sstar1*Sstar1prm_S1x + 2*Sstar2*Sstar2prm_S1x + 2*Sstar3*Sstar3prm_S1x
    Hdsumprm_S1x = HdsumTerm1prm_S1x - HdsumTerm2prm_S1x
    Q4prm_S1x = 8*eta*prT**3*prTprm_S1x*u**2*(4 - 3*eta)
    gammappsumprm_S1x = 2*Deltar*pdotn*pdotnprm_S1x/Sigma - Deltar*Sigmaprm_S1x*pdotn**2/Sigma**2 + Deltarprm_S1x*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S1x/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S1x/(Sigma*sin2theta) - Sigmaprm_S1x*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S1x/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S1x/(Lambt*sin2theta) + Sigmaprm_S1x*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S1x*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S1x = Q4prm_S1x + gammappsumprm_S1x
    alphaprm_S1x = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S1x/(2*Lambt) - Deltat*Lambtprm_S1x*Sigma/(2*Lambt**2) + Deltatprm_S1x*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S1x = omegatilde*pphiprm_S1x/Lambt + omegatildeprm_S1x*pphi/Lambt - Lambtprm_S1x*omegatilde*pphi/Lambt**2
    HssTerm3prm_S1x = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S1x - Qprm_S1x/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S1x*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S1x*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S1x*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S1x - Jtilde*Sdotvprm_S1x*pdotn - Jtildeprm_S1x*Sdotv*pdotn + Sdotn*pdotvrprm_S1x + Sdotnprm_S1x*pdotvr) + pdotvrprm_S1x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S1x*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S1x + Btilde*Jtilde*Sdotxiprm_S1x*pdotn + Btilde*Jtildeprm_S1x*Sdotxi*pdotn + Btildeprm_S1x*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S1x - Sdotn*expmu*expnuprm_S1x*pdotxir - Sdotn*expmuprm_S1x*expnu*pdotxir - Sdotnprm_S1x*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S1x*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S1x*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S1x*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S1x = omegacostheta*(-Qprm_S1x - Qprm_S1x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S1x/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S1x*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S1x*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S1x*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1x*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S1x = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S1x - Jtilde*Sdotvprm_S1x*pdotn - Jtildeprm_S1x*Sdotv*pdotn + Sdotn*pdotvrprm_S1x + Sdotnprm_S1x*pdotvr) + Jtilde*pdotnprm_S1x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S1x*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S1x + Qprm_S1x/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S1x*(np.sqrt(Q) + Q) + Sdotvprm_S1x*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S1x*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S1x*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S1x - Btilde*Sdotxi*expnuprm_S1x*pdotvr - Btilde*Sdotxiprm_S1x*expnu*pdotvr - Btildeprm_S1x*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S1x + Sdotv*exp2nu*expmuprm_S1x*pdotxir + Sdotv*exp2nuprm_S1x*expmu*pdotxir + Sdotvprm_S1x*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S1x*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S1x*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S1x = Jtilde*omegar*(-Qprm_S1x - Qprm_S1x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S1x/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S1x/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S1x*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S1x*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S1x*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S1x*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1x*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S1x = SdotSkerrhat*omegaprm_S1x + SdotSkerrhatprm_S1x*omega
    Hssprm_S1x = HssTerm1prm_S1x + HssTerm2*HssTerm2coeffprm_S1x + HssTerm2coeff*HssTerm2prm_S1x + HssTerm3*HssTerm3coeffprm_S1x + HssTerm3coeff*HssTerm3prm_S1x
    HsoTerm2cprm_S1x = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S1x*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S1x*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S1x*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S1x*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S1x*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S1x*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S1x*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S1x = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S1x + Jtilde*Sdotvprm_S1x*nur + Jtildeprm_S1x*Sdotv*nur - Sdotn*nucostheta*xisqprm_S1x - Sdotn*nucosthetaprm_S1x*xisq - Sdotnprm_S1x*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S1x*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S1x*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S1x*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S1x*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S1x*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S1x = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S1x + nurprm_S1x*pdotvr + pdotn*xisq*(mucosthetaprm_S1x - nucosthetaprm_S1x) + pdotn*xisqprm_S1x*(mucostheta - nucostheta) + pdotnprm_S1x*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S1x - mucostheta*pdotnprm_S1x*xisq - mucosthetaprm_S1x*pdotn*xisq + mur*pdotvrprm_S1x*(np.sqrt(Q) + 1) + murprm_S1x*pdotvr*(np.sqrt(Q) + 1) + Qprm_S1x*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S1x*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S1x*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S1x*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S1x*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S1x = HsoTerm2aprm_S1x + HsoTerm2bprm_S1x - HsoTerm2cprm_S1x
    HsoTerm2coeffprm_S1x = expnu*(-Qprm_S1x - Qprm_S1x/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S1x/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S1x/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S1x*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S1x*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S1x = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S1x + expmu*expnuprm_S1x + expmuprm_S1x*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S1x*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S1x*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S1x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S1x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S1x*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S1x*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S1x*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S1x = HsoTerm1prm_S1x + HsoTerm2*HsoTerm2coeffprm_S1x + HsoTerm2coeff*HsoTerm2prm_S1x
    Hdprm_S1x = Hdcoeff*Hdsumprm_S1x
    Hnsprm_S1x = np.sqrt(Hnsradicand)*alphaprm_S1x + betapsumprm_S1x + Hnsradicandprm_S1x*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S1x = Hsoprm_S1x + Hssprm_S1x
    Heffprm_S1x = -Hdprm_S1x + Hnsprm_S1x + Hsprm_S1x + 2*S1x*dSS*eta*u**4
    Hrealprm_S1x = Heffprm_S1x*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S1x])
def new_compute_dHdS1y(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar2prm_S1y = m2/m1
    sigma2prm_S1y = 1
    Skerr2prm_S1y = sigma2prm_S1y
    Skerrmagprm_S1y = Skerr2*Skerr2prm_S1y/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S1y = -Skerr3*Skerrmagprm_S1y/Skerrmag**2
    Skerrhat2prm_S1y = -Skerr2*Skerrmagprm_S1y/Skerrmag**2 + Skerr2prm_S1y/Skerrmag
    Skerrhat1prm_S1y = -Skerr1*Skerrmagprm_S1y/Skerrmag**2
    aprm_S1y = Skerrmagprm_S1y
    e33prm_S1y = Skerrhat3prm_S1y
    e32prm_S1y = Skerrhat2prm_S1y
    e31prm_S1y = Skerrhat1prm_S1y
    xi3prm_S1y = e31prm_S1y*n2 - e32prm_S1y*n1
    xi2prm_S1y = -e31prm_S1y*n3 + e33prm_S1y*n1
    xi1prm_S1y = e32prm_S1y*n3 - e33prm_S1y*n2
    v3prm_S1y = n1*xi2prm_S1y - n2*xi1prm_S1y
    v2prm_S1y = -n1*xi3prm_S1y + n3*xi1prm_S1y
    v1prm_S1y = n2*xi3prm_S1y - n3*xi2prm_S1y
    costhetaprm_S1y = e31prm_S1y*n1 + e32prm_S1y*n2 + e33prm_S1y*n3
    sin2thetaprm_S1y = -2*costheta*costhetaprm_S1y
    xisqprm_S1y = sin2thetaprm_S1y
    w2prm_S1y = 2*a*aprm_S1y
    Sigmaprm_S1y = 2*a**2*costheta*costhetaprm_S1y + 2*a*aprm_S1y*costheta**2
    omegatildeprm_S1y = 2*aprm_S1y*r
    Delta2prm_S1y = -2*Delta0*a*aprm_S1y*etaKminus1**2
    Delta3prm_S1y = Delta1*Delta2prm_S1y - 2*Delta1*a*aprm_S1y*etaKminus1**2 - 2*Delta2prm_S1y*etaKminus1
    Delta4prm_S1y = -Delta1**2*Delta2prm_S1y + Delta1*(2*Delta2prm_S1y*etaKminus1 + Delta3prm_S1y) + Delta2*Delta2prm_S1y - Delta2prm_S1y*a**2*etaKminus1**2 - 2*Delta3prm_S1y*etaKminus1 + a*aprm_S1y*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S1y = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S1y + 3*Delta3prm_S1y)/3 + a*aprm_S1y*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S1y + 4*Delta1*Delta3prm_S1y + 4*Delta2*Delta2prm_S1y - 4*Delta4prm_S1y)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S1y + 5*Delta1**2*Delta3prm_S1y + 10*Delta1*Delta2*Delta2prm_S1y - 5*Delta1*Delta4prm_S1y - 5*Delta2*Delta3prm_S1y - 5*Delta2prm_S1y*Delta3)/(5*etaKminus1**2))
    logargprm_S1y = u**2*(Delta2prm_S1y + u*(Delta3prm_S1y + u*(Delta4prm_S1y + Delta5prm_S1y*u)))
    Deltaucalibprm_S1y = eta*logargprm_S1y/(logarg + 1)
    Deltaucalibprimeprm_S1y = eta*logargprm_S1y*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S1y + u*(3*Delta3prm_S1y + u*(4*Delta4prm_S1y + 5*Delta5prm_S1y*u)))/(logarg + 1)
    Deltaubarprm_S1y = 2*a*aprm_S1y*u**2
    Deltaubarprimeprm_S1y = -4*a*aprm_S1y*u**3
    Deltauprm_S1y = Deltaubar*Deltaucalibprm_S1y + Deltaubarprm_S1y*Deltaucalib
    Deltauprimeprm_S1y = Deltaubar*Deltaucalibprimeprm_S1y + Deltaubarprime*Deltaucalibprm_S1y + Deltaubarprimeprm_S1y*Deltaucalib + Deltaubarprm_S1y*Deltaucalibprime
    Deltatprimeprm_S1y = Deltauprimeprm_S1y*r**2 + 2*Deltauprm_S1y*r
    Deltatprm_S1y = Deltauprm_S1y*r**2
    Deltarprm_S1y = Deltatprm_S1y*Dinv
    Lambtprm_S1y = -Deltat*a**2*sin2thetaprm_S1y - 2*Deltat*a*aprm_S1y*sin2theta - Deltatprm_S1y*a**2*sin2theta + 2*w2*w2prm_S1y
    csiprm_S1y = -w2prm_S1y*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S1y/2 + Deltarprm_S1y*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S1y = csiprm_S1y*(1 - abs(1 - tortoise))
    csi2prm_S1y = csiprm_S1y*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S1y = csi2prm_S1y*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S1y = n3*prTprm_S1y*(1 - 1/csi1) + csi1prm_S1y*n3*prT/csi1**2
    phat2prm_S1y = n2*prTprm_S1y*(1 - 1/csi1) + csi1prm_S1y*n2*prT/csi1**2
    phat1prm_S1y = n1*prTprm_S1y*(1 - 1/csi1) + csi1prm_S1y*n1*prT/csi1**2
    pdotxirprm_S1y = r*(phat1*xi1prm_S1y + phat1prm_S1y*xi1 + phat2*xi2prm_S1y + phat2prm_S1y*xi2 + phat3*xi3prm_S1y + phat3prm_S1y*xi3)
    pdotnprm_S1y = n1*phat1prm_S1y + n2*phat2prm_S1y + n3*phat3prm_S1y
    pdotvrprm_S1y = r*(phat1*v1prm_S1y + phat1prm_S1y*v1 + phat2*v2prm_S1y + phat2prm_S1y*v2 + phat3*v3prm_S1y + phat3prm_S1y*v3)
    pphiprm_S1y = pdotxirprm_S1y
    Qcoeff2prm_S1y = -sin2thetaprm_S1y/(Sigma*sin2theta**2) - Sigmaprm_S1y/(Sigma**2*sin2theta)
    Qcoeff1prm_S1y = -Sigma*sin2thetaprm_S1y/(Lambt*sin2theta**2) + Sigmaprm_S1y/(Lambt*sin2theta) - Lambtprm_S1y*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S1y = 2*Deltar*pdotn*pdotnprm_S1y/Sigma - Deltar*Sigmaprm_S1y*pdotn**2/Sigma**2 + Deltarprm_S1y*pdotn**2/Sigma
    Qprm_S1y = DrSipn2prm_S1y + 2*Qcoeff1*pdotxir*pdotxirprm_S1y + Qcoeff1prm_S1y*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S1y + Qcoeff2prm_S1y*pdotvr**2
    Qminus1prm_S1y = Qprm_S1y
    Jtildeprm_S1y = Deltarprm_S1y/(2*np.sqrt(Deltar))
    exp2muprm_S1y = Sigmaprm_S1y
    expmuprm_S1y = exp2muprm_S1y/(2*np.sqrt(exp2mu))
    Brtildeprm_S1y = (np.sqrt(Deltar)*Deltatprimeprm_S1y - 2*Deltatprm_S1y + Deltarprm_S1y*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S1y/2 - Deltarprm_S1y*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S1y = Deltatprm_S1y/(2*np.sqrt(Deltat))
    exp2nuprm_S1y = Deltat*Sigmaprm_S1y/Lambt - Deltat*Lambtprm_S1y*Sigma/Lambt**2 + Deltatprm_S1y*Sigma/Lambt
    expnuprm_S1y = exp2nuprm_S1y/(2*np.sqrt(exp2nu))
    omegaprm_S1y = omegatildeprm_S1y/Lambt - Lambtprm_S1y*omegatilde/Lambt**2
    omegatildeprimeprm_S1y = 2*aprm_S1y
    Lambtprimeprm_S1y = -2*Deltatprime*a**2*sin2thetaprm_S1y - 4*Deltatprime*a*aprm_S1y*sin2theta - 2*Deltatprimeprm_S1y*a**2*sin2theta + 8*a*aprm_S1y*r
    mucosthetaprm_S1y = a**2*costhetaprm_S1y/Sigma + 2*a*aprm_S1y*costheta/Sigma - Sigmaprm_S1y*a**2*costheta/Sigma**2
    nucosthetaprm_S1y = a**2*costheta*w2*(-Deltatprm_S1y + w2prm_S1y)/(Lambt*Sigma) + a**2*costheta*w2prm_S1y*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S1y*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S1y*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S1y*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S1y*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S1y = -2*Deltat*a**2*costheta*omegatildeprm_S1y/Lambt**2 - 2*Deltat*a**2*costhetaprm_S1y*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S1y*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S1y*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S1y*a**2*costheta*omegatilde/Lambt**2
    murprm_S1y = -Sigmaprm_S1y*r/Sigma**2 + Deltarprm_S1y/(2*Deltar**(3/2))
    nurprm_S1y = -Sigmaprm_S1y*r/Sigma**2 + w2*(Deltatprime*w2prm_S1y + Deltatprimeprm_S1y*w2 - 4*Deltatprm_S1y*r)/(2*Deltat*Lambt) + w2prm_S1y*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S1y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S1y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S1y = (Lambt*omegatildeprimeprm_S1y - Lambtprime*omegatildeprm_S1y - Lambtprimeprm_S1y*omegatilde + Lambtprm_S1y*omegatildeprime)/Lambt**2 + Lambtprm_S1y*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S1y = eta*(eta*r*(-882*DrSipn2prm_S1y + 204*Qminus1prm_S1y + r*(1620*DrSipn2*DrSipn2prm_S1y - 234*DrSipn2*Qminus1prm_S1y - 234*DrSipn2prm_S1y*Qminus1)) + r*(-96*DrSipn2prm_S1y - 436*Qminus1prm_S1y + r*(36*DrSipn2*Qminus1prm_S1y + 36*DrSipn2prm_S1y*Qminus1 - 90*Qminus1*Qminus1prm_S1y)))/(144*r**2)
    sigmacoeffTerm1prm_S1y = eta*(-36*DrSipn2prm_S1y + 3*Qminus1prm_S1y)/12
    sigmacoeffprm_S1y = sigmacoeffTerm1prm_S1y + sigmacoeffTerm2prm_S1y
    sigmastarcoeffTerm2prm_S1y = eta*(eta*r*(-324*DrSipn2prm_S1y + 120*Qminus1prm_S1y + r*(720*DrSipn2*DrSipn2prm_S1y + Qminus1*(-126*DrSipn2prm_S1y - 3*Qminus1prm_S1y) + Qminus1prm_S1y*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S1y + Qminus1*r*(96*DrSipn2prm_S1y - 23*Qminus1prm_S1y) + Qminus1prm_S1y*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S1y))/(72*r**2)
    sigmastarcoeffTerm1prm_S1y = eta*(-30*DrSipn2prm_S1y + 4*Qminus1prm_S1y)/12
    sigmastarcoeffprm_S1y = sigmastarcoeffTerm1prm_S1y + sigmastarcoeffTerm2prm_S1y
    Deltasigmastar3prm_S1y = sigma3*sigmacoeffprm_S1y + sigmastar3*sigmastarcoeffprm_S1y
    Deltasigmastar2prm_S1y = sigma2*sigmacoeffprm_S1y + sigma2prm_S1y*sigmacoeff + sigmastar2*sigmastarcoeffprm_S1y + sigmastar2prm_S1y*sigmastarcoeff
    Deltasigmastar1prm_S1y = sigma1*sigmacoeffprm_S1y + sigmastar1*sigmastarcoeffprm_S1y
    Sstar3prm_S1y = Deltasigmastar3prm_S1y
    Sstar2prm_S1y = Deltasigmastar2prm_S1y + sigmastar2prm_S1y
    Sstar1prm_S1y = Deltasigmastar1prm_S1y
    S3prm_S1y = Sstar3prm_S1y
    S2prm_S1y = Sstar2prm_S1y
    S1prm_S1y = Sstar1prm_S1y
    Sstardotnprm_S1y = Sstar1prm_S1y*n1 + Sstar2prm_S1y*n2 + Sstar3prm_S1y*n3
    SdotSkerrhatprm_S1y = S1*Skerrhat1prm_S1y + S1prm_S1y*Skerrhat1 + S2*Skerrhat2prm_S1y + S2prm_S1y*Skerrhat2 + S3*Skerrhat3prm_S1y + S3prm_S1y*Skerrhat3
    Sdotnprm_S1y = S1prm_S1y*n1 + S2prm_S1y*n2 + S3prm_S1y*n3
    Sdotvprm_S1y = S1*v1prm_S1y + S1prm_S1y*v1 + S2*v2prm_S1y + S2prm_S1y*v2 + S3*v3prm_S1y + S3prm_S1y*v3
    Sdotxiprm_S1y = S1*xi1prm_S1y + S1prm_S1y*xi1 + S2*xi2prm_S1y + S2prm_S1y*xi2 + S3*xi3prm_S1y + S3prm_S1y*xi3
    HdsumTerm2prm_S1y = 6*Sstardotn*Sstardotnprm_S1y
    HdsumTerm1prm_S1y = 2*Sstar1*Sstar1prm_S1y + 2*Sstar2*Sstar2prm_S1y + 2*Sstar3*Sstar3prm_S1y
    Hdsumprm_S1y = HdsumTerm1prm_S1y - HdsumTerm2prm_S1y
    Q4prm_S1y = 8*eta*prT**3*prTprm_S1y*u**2*(4 - 3*eta)
    gammappsumprm_S1y = 2*Deltar*pdotn*pdotnprm_S1y/Sigma - Deltar*Sigmaprm_S1y*pdotn**2/Sigma**2 + Deltarprm_S1y*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S1y/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S1y/(Sigma*sin2theta) - Sigmaprm_S1y*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S1y/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S1y/(Lambt*sin2theta) + Sigmaprm_S1y*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S1y*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S1y = Q4prm_S1y + gammappsumprm_S1y
    alphaprm_S1y = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S1y/(2*Lambt) - Deltat*Lambtprm_S1y*Sigma/(2*Lambt**2) + Deltatprm_S1y*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S1y = omegatilde*pphiprm_S1y/Lambt + omegatildeprm_S1y*pphi/Lambt - Lambtprm_S1y*omegatilde*pphi/Lambt**2
    HssTerm3prm_S1y = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S1y - Qprm_S1y/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S1y*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S1y*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S1y*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S1y - Jtilde*Sdotvprm_S1y*pdotn - Jtildeprm_S1y*Sdotv*pdotn + Sdotn*pdotvrprm_S1y + Sdotnprm_S1y*pdotvr) + pdotvrprm_S1y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S1y*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S1y + Btilde*Jtilde*Sdotxiprm_S1y*pdotn + Btilde*Jtildeprm_S1y*Sdotxi*pdotn + Btildeprm_S1y*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S1y - Sdotn*expmu*expnuprm_S1y*pdotxir - Sdotn*expmuprm_S1y*expnu*pdotxir - Sdotnprm_S1y*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S1y*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S1y*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S1y*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S1y = omegacostheta*(-Qprm_S1y - Qprm_S1y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S1y/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S1y*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S1y*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S1y*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1y*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S1y = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S1y - Jtilde*Sdotvprm_S1y*pdotn - Jtildeprm_S1y*Sdotv*pdotn + Sdotn*pdotvrprm_S1y + Sdotnprm_S1y*pdotvr) + Jtilde*pdotnprm_S1y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S1y*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S1y + Qprm_S1y/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S1y*(np.sqrt(Q) + Q) + Sdotvprm_S1y*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S1y*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S1y*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S1y - Btilde*Sdotxi*expnuprm_S1y*pdotvr - Btilde*Sdotxiprm_S1y*expnu*pdotvr - Btildeprm_S1y*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S1y + Sdotv*exp2nu*expmuprm_S1y*pdotxir + Sdotv*exp2nuprm_S1y*expmu*pdotxir + Sdotvprm_S1y*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S1y*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S1y*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S1y = Jtilde*omegar*(-Qprm_S1y - Qprm_S1y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S1y/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S1y/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S1y*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S1y*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S1y*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S1y*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1y*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S1y = SdotSkerrhat*omegaprm_S1y + SdotSkerrhatprm_S1y*omega
    Hssprm_S1y = HssTerm1prm_S1y + HssTerm2*HssTerm2coeffprm_S1y + HssTerm2coeff*HssTerm2prm_S1y + HssTerm3*HssTerm3coeffprm_S1y + HssTerm3coeff*HssTerm3prm_S1y
    HsoTerm2cprm_S1y = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S1y*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S1y*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S1y*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S1y*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S1y*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S1y*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S1y*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S1y = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S1y + Jtilde*Sdotvprm_S1y*nur + Jtildeprm_S1y*Sdotv*nur - Sdotn*nucostheta*xisqprm_S1y - Sdotn*nucosthetaprm_S1y*xisq - Sdotnprm_S1y*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S1y*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S1y*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S1y*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S1y*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S1y*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S1y = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S1y + nurprm_S1y*pdotvr + pdotn*xisq*(mucosthetaprm_S1y - nucosthetaprm_S1y) + pdotn*xisqprm_S1y*(mucostheta - nucostheta) + pdotnprm_S1y*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S1y - mucostheta*pdotnprm_S1y*xisq - mucosthetaprm_S1y*pdotn*xisq + mur*pdotvrprm_S1y*(np.sqrt(Q) + 1) + murprm_S1y*pdotvr*(np.sqrt(Q) + 1) + Qprm_S1y*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S1y*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S1y*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S1y*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S1y*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S1y = HsoTerm2aprm_S1y + HsoTerm2bprm_S1y - HsoTerm2cprm_S1y
    HsoTerm2coeffprm_S1y = expnu*(-Qprm_S1y - Qprm_S1y/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S1y/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S1y/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S1y*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S1y*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S1y = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S1y + expmu*expnuprm_S1y + expmuprm_S1y*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S1y*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S1y*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S1y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S1y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S1y*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S1y*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S1y*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S1y = HsoTerm1prm_S1y + HsoTerm2*HsoTerm2coeffprm_S1y + HsoTerm2coeff*HsoTerm2prm_S1y
    Hdprm_S1y = Hdcoeff*Hdsumprm_S1y
    Hnsprm_S1y = np.sqrt(Hnsradicand)*alphaprm_S1y + betapsumprm_S1y + Hnsradicandprm_S1y*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S1y = Hsoprm_S1y + Hssprm_S1y
    Heffprm_S1y = -Hdprm_S1y + Hnsprm_S1y + Hsprm_S1y + 2*S1y*dSS*eta*u**4
    Hrealprm_S1y = Heffprm_S1y*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S1y])
def new_compute_dHdS1z(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar3prm_S1z = m2/m1
    sigma3prm_S1z = 1
    Skerr3prm_S1z = sigma3prm_S1z
    Skerrmagprm_S1z = Skerr3*Skerr3prm_S1z/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S1z = -Skerr3*Skerrmagprm_S1z/Skerrmag**2 + Skerr3prm_S1z/Skerrmag
    Skerrhat2prm_S1z = -Skerr2*Skerrmagprm_S1z/Skerrmag**2
    Skerrhat1prm_S1z = -Skerr1*Skerrmagprm_S1z/Skerrmag**2
    aprm_S1z = Skerrmagprm_S1z
    e33prm_S1z = Skerrhat3prm_S1z
    e32prm_S1z = Skerrhat2prm_S1z
    e31prm_S1z = Skerrhat1prm_S1z
    xi3prm_S1z = e31prm_S1z*n2 - e32prm_S1z*n1
    xi2prm_S1z = -e31prm_S1z*n3 + e33prm_S1z*n1
    xi1prm_S1z = e32prm_S1z*n3 - e33prm_S1z*n2
    v3prm_S1z = n1*xi2prm_S1z - n2*xi1prm_S1z
    v2prm_S1z = -n1*xi3prm_S1z + n3*xi1prm_S1z
    v1prm_S1z = n2*xi3prm_S1z - n3*xi2prm_S1z
    costhetaprm_S1z = e31prm_S1z*n1 + e32prm_S1z*n2 + e33prm_S1z*n3
    sin2thetaprm_S1z = -2*costheta*costhetaprm_S1z
    xisqprm_S1z = sin2thetaprm_S1z
    w2prm_S1z = 2*a*aprm_S1z
    Sigmaprm_S1z = 2*a**2*costheta*costhetaprm_S1z + 2*a*aprm_S1z*costheta**2
    omegatildeprm_S1z = 2*aprm_S1z*r
    Delta2prm_S1z = -2*Delta0*a*aprm_S1z*etaKminus1**2
    Delta3prm_S1z = Delta1*Delta2prm_S1z - 2*Delta1*a*aprm_S1z*etaKminus1**2 - 2*Delta2prm_S1z*etaKminus1
    Delta4prm_S1z = -Delta1**2*Delta2prm_S1z + Delta1*(2*Delta2prm_S1z*etaKminus1 + Delta3prm_S1z) + Delta2*Delta2prm_S1z - Delta2prm_S1z*a**2*etaKminus1**2 - 2*Delta3prm_S1z*etaKminus1 + a*aprm_S1z*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S1z = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S1z + 3*Delta3prm_S1z)/3 + a*aprm_S1z*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S1z + 4*Delta1*Delta3prm_S1z + 4*Delta2*Delta2prm_S1z - 4*Delta4prm_S1z)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S1z + 5*Delta1**2*Delta3prm_S1z + 10*Delta1*Delta2*Delta2prm_S1z - 5*Delta1*Delta4prm_S1z - 5*Delta2*Delta3prm_S1z - 5*Delta2prm_S1z*Delta3)/(5*etaKminus1**2))
    logargprm_S1z = u**2*(Delta2prm_S1z + u*(Delta3prm_S1z + u*(Delta4prm_S1z + Delta5prm_S1z*u)))
    Deltaucalibprm_S1z = eta*logargprm_S1z/(logarg + 1)
    Deltaucalibprimeprm_S1z = eta*logargprm_S1z*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S1z + u*(3*Delta3prm_S1z + u*(4*Delta4prm_S1z + 5*Delta5prm_S1z*u)))/(logarg + 1)
    Deltaubarprm_S1z = 2*a*aprm_S1z*u**2
    Deltaubarprimeprm_S1z = -4*a*aprm_S1z*u**3
    Deltauprm_S1z = Deltaubar*Deltaucalibprm_S1z + Deltaubarprm_S1z*Deltaucalib
    Deltauprimeprm_S1z = Deltaubar*Deltaucalibprimeprm_S1z + Deltaubarprime*Deltaucalibprm_S1z + Deltaubarprimeprm_S1z*Deltaucalib + Deltaubarprm_S1z*Deltaucalibprime
    Deltatprimeprm_S1z = Deltauprimeprm_S1z*r**2 + 2*Deltauprm_S1z*r
    Deltatprm_S1z = Deltauprm_S1z*r**2
    Deltarprm_S1z = Deltatprm_S1z*Dinv
    Lambtprm_S1z = -Deltat*a**2*sin2thetaprm_S1z - 2*Deltat*a*aprm_S1z*sin2theta - Deltatprm_S1z*a**2*sin2theta + 2*w2*w2prm_S1z
    csiprm_S1z = -w2prm_S1z*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S1z/2 + Deltarprm_S1z*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S1z = csiprm_S1z*(1 - abs(1 - tortoise))
    csi2prm_S1z = csiprm_S1z*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S1z = csi2prm_S1z*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S1z = n3*prTprm_S1z*(1 - 1/csi1) + csi1prm_S1z*n3*prT/csi1**2
    phat2prm_S1z = n2*prTprm_S1z*(1 - 1/csi1) + csi1prm_S1z*n2*prT/csi1**2
    phat1prm_S1z = n1*prTprm_S1z*(1 - 1/csi1) + csi1prm_S1z*n1*prT/csi1**2
    pdotxirprm_S1z = r*(phat1*xi1prm_S1z + phat1prm_S1z*xi1 + phat2*xi2prm_S1z + phat2prm_S1z*xi2 + phat3*xi3prm_S1z + phat3prm_S1z*xi3)
    pdotnprm_S1z = n1*phat1prm_S1z + n2*phat2prm_S1z + n3*phat3prm_S1z
    pdotvrprm_S1z = r*(phat1*v1prm_S1z + phat1prm_S1z*v1 + phat2*v2prm_S1z + phat2prm_S1z*v2 + phat3*v3prm_S1z + phat3prm_S1z*v3)
    pphiprm_S1z = pdotxirprm_S1z
    Qcoeff2prm_S1z = -sin2thetaprm_S1z/(Sigma*sin2theta**2) - Sigmaprm_S1z/(Sigma**2*sin2theta)
    Qcoeff1prm_S1z = -Sigma*sin2thetaprm_S1z/(Lambt*sin2theta**2) + Sigmaprm_S1z/(Lambt*sin2theta) - Lambtprm_S1z*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S1z = 2*Deltar*pdotn*pdotnprm_S1z/Sigma - Deltar*Sigmaprm_S1z*pdotn**2/Sigma**2 + Deltarprm_S1z*pdotn**2/Sigma
    Qprm_S1z = DrSipn2prm_S1z + 2*Qcoeff1*pdotxir*pdotxirprm_S1z + Qcoeff1prm_S1z*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S1z + Qcoeff2prm_S1z*pdotvr**2
    Qminus1prm_S1z = Qprm_S1z
    Jtildeprm_S1z = Deltarprm_S1z/(2*np.sqrt(Deltar))
    exp2muprm_S1z = Sigmaprm_S1z
    expmuprm_S1z = exp2muprm_S1z/(2*np.sqrt(exp2mu))
    Brtildeprm_S1z = (np.sqrt(Deltar)*Deltatprimeprm_S1z - 2*Deltatprm_S1z + Deltarprm_S1z*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S1z/2 - Deltarprm_S1z*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S1z = Deltatprm_S1z/(2*np.sqrt(Deltat))
    exp2nuprm_S1z = Deltat*Sigmaprm_S1z/Lambt - Deltat*Lambtprm_S1z*Sigma/Lambt**2 + Deltatprm_S1z*Sigma/Lambt
    expnuprm_S1z = exp2nuprm_S1z/(2*np.sqrt(exp2nu))
    omegaprm_S1z = omegatildeprm_S1z/Lambt - Lambtprm_S1z*omegatilde/Lambt**2
    omegatildeprimeprm_S1z = 2*aprm_S1z
    Lambtprimeprm_S1z = -2*Deltatprime*a**2*sin2thetaprm_S1z - 4*Deltatprime*a*aprm_S1z*sin2theta - 2*Deltatprimeprm_S1z*a**2*sin2theta + 8*a*aprm_S1z*r
    mucosthetaprm_S1z = a**2*costhetaprm_S1z/Sigma + 2*a*aprm_S1z*costheta/Sigma - Sigmaprm_S1z*a**2*costheta/Sigma**2
    nucosthetaprm_S1z = a**2*costheta*w2*(-Deltatprm_S1z + w2prm_S1z)/(Lambt*Sigma) + a**2*costheta*w2prm_S1z*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S1z*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S1z*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S1z*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S1z*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S1z = -2*Deltat*a**2*costheta*omegatildeprm_S1z/Lambt**2 - 2*Deltat*a**2*costhetaprm_S1z*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S1z*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S1z*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S1z*a**2*costheta*omegatilde/Lambt**2
    murprm_S1z = -Sigmaprm_S1z*r/Sigma**2 + Deltarprm_S1z/(2*Deltar**(3/2))
    nurprm_S1z = -Sigmaprm_S1z*r/Sigma**2 + w2*(Deltatprime*w2prm_S1z + Deltatprimeprm_S1z*w2 - 4*Deltatprm_S1z*r)/(2*Deltat*Lambt) + w2prm_S1z*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S1z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S1z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S1z = (Lambt*omegatildeprimeprm_S1z - Lambtprime*omegatildeprm_S1z - Lambtprimeprm_S1z*omegatilde + Lambtprm_S1z*omegatildeprime)/Lambt**2 + Lambtprm_S1z*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S1z = eta*(eta*r*(-882*DrSipn2prm_S1z + 204*Qminus1prm_S1z + r*(1620*DrSipn2*DrSipn2prm_S1z - 234*DrSipn2*Qminus1prm_S1z - 234*DrSipn2prm_S1z*Qminus1)) + r*(-96*DrSipn2prm_S1z - 436*Qminus1prm_S1z + r*(36*DrSipn2*Qminus1prm_S1z + 36*DrSipn2prm_S1z*Qminus1 - 90*Qminus1*Qminus1prm_S1z)))/(144*r**2)
    sigmacoeffTerm1prm_S1z = eta*(-36*DrSipn2prm_S1z + 3*Qminus1prm_S1z)/12
    sigmacoeffprm_S1z = sigmacoeffTerm1prm_S1z + sigmacoeffTerm2prm_S1z
    sigmastarcoeffTerm2prm_S1z = eta*(eta*r*(-324*DrSipn2prm_S1z + 120*Qminus1prm_S1z + r*(720*DrSipn2*DrSipn2prm_S1z + Qminus1*(-126*DrSipn2prm_S1z - 3*Qminus1prm_S1z) + Qminus1prm_S1z*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S1z + Qminus1*r*(96*DrSipn2prm_S1z - 23*Qminus1prm_S1z) + Qminus1prm_S1z*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S1z))/(72*r**2)
    sigmastarcoeffTerm1prm_S1z = eta*(-30*DrSipn2prm_S1z + 4*Qminus1prm_S1z)/12
    sigmastarcoeffprm_S1z = sigmastarcoeffTerm1prm_S1z + sigmastarcoeffTerm2prm_S1z
    Deltasigmastar3prm_S1z = sigma3*sigmacoeffprm_S1z + sigma3prm_S1z*sigmacoeff + sigmastar3*sigmastarcoeffprm_S1z + sigmastar3prm_S1z*sigmastarcoeff
    Deltasigmastar2prm_S1z = sigma2*sigmacoeffprm_S1z + sigmastar2*sigmastarcoeffprm_S1z
    Deltasigmastar1prm_S1z = sigma1*sigmacoeffprm_S1z + sigmastar1*sigmastarcoeffprm_S1z
    Sstar3prm_S1z = Deltasigmastar3prm_S1z + sigmastar3prm_S1z
    Sstar2prm_S1z = Deltasigmastar2prm_S1z
    Sstar1prm_S1z = Deltasigmastar1prm_S1z
    S3prm_S1z = Sstar3prm_S1z
    S2prm_S1z = Sstar2prm_S1z
    S1prm_S1z = Sstar1prm_S1z
    Sstardotnprm_S1z = Sstar1prm_S1z*n1 + Sstar2prm_S1z*n2 + Sstar3prm_S1z*n3
    SdotSkerrhatprm_S1z = S1*Skerrhat1prm_S1z + S1prm_S1z*Skerrhat1 + S2*Skerrhat2prm_S1z + S2prm_S1z*Skerrhat2 + S3*Skerrhat3prm_S1z + S3prm_S1z*Skerrhat3
    Sdotnprm_S1z = S1prm_S1z*n1 + S2prm_S1z*n2 + S3prm_S1z*n3
    Sdotvprm_S1z = S1*v1prm_S1z + S1prm_S1z*v1 + S2*v2prm_S1z + S2prm_S1z*v2 + S3*v3prm_S1z + S3prm_S1z*v3
    Sdotxiprm_S1z = S1*xi1prm_S1z + S1prm_S1z*xi1 + S2*xi2prm_S1z + S2prm_S1z*xi2 + S3*xi3prm_S1z + S3prm_S1z*xi3
    HdsumTerm2prm_S1z = 6*Sstardotn*Sstardotnprm_S1z
    HdsumTerm1prm_S1z = 2*Sstar1*Sstar1prm_S1z + 2*Sstar2*Sstar2prm_S1z + 2*Sstar3*Sstar3prm_S1z
    Hdsumprm_S1z = HdsumTerm1prm_S1z - HdsumTerm2prm_S1z
    Q4prm_S1z = 8*eta*prT**3*prTprm_S1z*u**2*(4 - 3*eta)
    gammappsumprm_S1z = 2*Deltar*pdotn*pdotnprm_S1z/Sigma - Deltar*Sigmaprm_S1z*pdotn**2/Sigma**2 + Deltarprm_S1z*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S1z/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S1z/(Sigma*sin2theta) - Sigmaprm_S1z*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S1z/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S1z/(Lambt*sin2theta) + Sigmaprm_S1z*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S1z*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S1z = Q4prm_S1z + gammappsumprm_S1z
    alphaprm_S1z = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S1z/(2*Lambt) - Deltat*Lambtprm_S1z*Sigma/(2*Lambt**2) + Deltatprm_S1z*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S1z = omegatilde*pphiprm_S1z/Lambt + omegatildeprm_S1z*pphi/Lambt - Lambtprm_S1z*omegatilde*pphi/Lambt**2
    HssTerm3prm_S1z = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S1z - Qprm_S1z/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S1z*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S1z*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S1z*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S1z - Jtilde*Sdotvprm_S1z*pdotn - Jtildeprm_S1z*Sdotv*pdotn + Sdotn*pdotvrprm_S1z + Sdotnprm_S1z*pdotvr) + pdotvrprm_S1z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S1z*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S1z + Btilde*Jtilde*Sdotxiprm_S1z*pdotn + Btilde*Jtildeprm_S1z*Sdotxi*pdotn + Btildeprm_S1z*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S1z - Sdotn*expmu*expnuprm_S1z*pdotxir - Sdotn*expmuprm_S1z*expnu*pdotxir - Sdotnprm_S1z*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S1z*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S1z*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S1z*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S1z = omegacostheta*(-Qprm_S1z - Qprm_S1z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S1z/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S1z*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S1z*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S1z*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1z*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S1z = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S1z - Jtilde*Sdotvprm_S1z*pdotn - Jtildeprm_S1z*Sdotv*pdotn + Sdotn*pdotvrprm_S1z + Sdotnprm_S1z*pdotvr) + Jtilde*pdotnprm_S1z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S1z*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S1z + Qprm_S1z/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S1z*(np.sqrt(Q) + Q) + Sdotvprm_S1z*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S1z*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S1z*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S1z - Btilde*Sdotxi*expnuprm_S1z*pdotvr - Btilde*Sdotxiprm_S1z*expnu*pdotvr - Btildeprm_S1z*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S1z + Sdotv*exp2nu*expmuprm_S1z*pdotxir + Sdotv*exp2nuprm_S1z*expmu*pdotxir + Sdotvprm_S1z*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S1z*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S1z*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S1z = Jtilde*omegar*(-Qprm_S1z - Qprm_S1z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S1z/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S1z/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S1z*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S1z*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S1z*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S1z*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S1z*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S1z = SdotSkerrhat*omegaprm_S1z + SdotSkerrhatprm_S1z*omega
    Hssprm_S1z = HssTerm1prm_S1z + HssTerm2*HssTerm2coeffprm_S1z + HssTerm2coeff*HssTerm2prm_S1z + HssTerm3*HssTerm3coeffprm_S1z + HssTerm3coeff*HssTerm3prm_S1z
    HsoTerm2cprm_S1z = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S1z*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S1z*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S1z*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S1z*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S1z*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S1z*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S1z*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S1z = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S1z + Jtilde*Sdotvprm_S1z*nur + Jtildeprm_S1z*Sdotv*nur - Sdotn*nucostheta*xisqprm_S1z - Sdotn*nucosthetaprm_S1z*xisq - Sdotnprm_S1z*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S1z*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S1z*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S1z*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S1z*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S1z*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S1z = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S1z + nurprm_S1z*pdotvr + pdotn*xisq*(mucosthetaprm_S1z - nucosthetaprm_S1z) + pdotn*xisqprm_S1z*(mucostheta - nucostheta) + pdotnprm_S1z*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S1z - mucostheta*pdotnprm_S1z*xisq - mucosthetaprm_S1z*pdotn*xisq + mur*pdotvrprm_S1z*(np.sqrt(Q) + 1) + murprm_S1z*pdotvr*(np.sqrt(Q) + 1) + Qprm_S1z*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S1z*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S1z*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S1z*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S1z*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S1z = HsoTerm2aprm_S1z + HsoTerm2bprm_S1z - HsoTerm2cprm_S1z
    HsoTerm2coeffprm_S1z = expnu*(-Qprm_S1z - Qprm_S1z/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S1z/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S1z/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S1z*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S1z*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S1z = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S1z + expmu*expnuprm_S1z + expmuprm_S1z*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S1z*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S1z*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S1z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S1z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S1z*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S1z*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S1z*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S1z = HsoTerm1prm_S1z + HsoTerm2*HsoTerm2coeffprm_S1z + HsoTerm2coeff*HsoTerm2prm_S1z
    Hdprm_S1z = Hdcoeff*Hdsumprm_S1z
    Hnsprm_S1z = np.sqrt(Hnsradicand)*alphaprm_S1z + betapsumprm_S1z + Hnsradicandprm_S1z*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S1z = Hsoprm_S1z + Hssprm_S1z
    Heffprm_S1z = -Hdprm_S1z + Hnsprm_S1z + Hsprm_S1z + 2*S1z*dSS*eta*u**4
    Hrealprm_S1z = Heffprm_S1z*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S1z])
def new_compute_dHdS2x(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar1prm_S2x = m1/m2
    sigma1prm_S2x = 1
    Skerr1prm_S2x = sigma1prm_S2x
    Skerrmagprm_S2x = Skerr1*Skerr1prm_S2x/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S2x = -Skerr3*Skerrmagprm_S2x/Skerrmag**2
    Skerrhat2prm_S2x = -Skerr2*Skerrmagprm_S2x/Skerrmag**2
    Skerrhat1prm_S2x = -Skerr1*Skerrmagprm_S2x/Skerrmag**2 + Skerr1prm_S2x/Skerrmag
    aprm_S2x = Skerrmagprm_S2x
    e33prm_S2x = Skerrhat3prm_S2x
    e32prm_S2x = Skerrhat2prm_S2x
    e31prm_S2x = Skerrhat1prm_S2x
    xi3prm_S2x = e31prm_S2x*n2 - e32prm_S2x*n1
    xi2prm_S2x = -e31prm_S2x*n3 + e33prm_S2x*n1
    xi1prm_S2x = e32prm_S2x*n3 - e33prm_S2x*n2
    v3prm_S2x = n1*xi2prm_S2x - n2*xi1prm_S2x
    v2prm_S2x = -n1*xi3prm_S2x + n3*xi1prm_S2x
    v1prm_S2x = n2*xi3prm_S2x - n3*xi2prm_S2x
    costhetaprm_S2x = e31prm_S2x*n1 + e32prm_S2x*n2 + e33prm_S2x*n3
    sin2thetaprm_S2x = -2*costheta*costhetaprm_S2x
    xisqprm_S2x = sin2thetaprm_S2x
    w2prm_S2x = 2*a*aprm_S2x
    Sigmaprm_S2x = 2*a**2*costheta*costhetaprm_S2x + 2*a*aprm_S2x*costheta**2
    omegatildeprm_S2x = 2*aprm_S2x*r
    Delta2prm_S2x = -2*Delta0*a*aprm_S2x*etaKminus1**2
    Delta3prm_S2x = Delta1*Delta2prm_S2x - 2*Delta1*a*aprm_S2x*etaKminus1**2 - 2*Delta2prm_S2x*etaKminus1
    Delta4prm_S2x = -Delta1**2*Delta2prm_S2x + Delta1*(2*Delta2prm_S2x*etaKminus1 + Delta3prm_S2x) + Delta2*Delta2prm_S2x - Delta2prm_S2x*a**2*etaKminus1**2 - 2*Delta3prm_S2x*etaKminus1 + a*aprm_S2x*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S2x = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S2x + 3*Delta3prm_S2x)/3 + a*aprm_S2x*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S2x + 4*Delta1*Delta3prm_S2x + 4*Delta2*Delta2prm_S2x - 4*Delta4prm_S2x)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S2x + 5*Delta1**2*Delta3prm_S2x + 10*Delta1*Delta2*Delta2prm_S2x - 5*Delta1*Delta4prm_S2x - 5*Delta2*Delta3prm_S2x - 5*Delta2prm_S2x*Delta3)/(5*etaKminus1**2))
    logargprm_S2x = u**2*(Delta2prm_S2x + u*(Delta3prm_S2x + u*(Delta4prm_S2x + Delta5prm_S2x*u)))
    Deltaucalibprm_S2x = eta*logargprm_S2x/(logarg + 1)
    Deltaucalibprimeprm_S2x = eta*logargprm_S2x*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S2x + u*(3*Delta3prm_S2x + u*(4*Delta4prm_S2x + 5*Delta5prm_S2x*u)))/(logarg + 1)
    Deltaubarprm_S2x = 2*a*aprm_S2x*u**2
    Deltaubarprimeprm_S2x = -4*a*aprm_S2x*u**3
    Deltauprm_S2x = Deltaubar*Deltaucalibprm_S2x + Deltaubarprm_S2x*Deltaucalib
    Deltauprimeprm_S2x = Deltaubar*Deltaucalibprimeprm_S2x + Deltaubarprime*Deltaucalibprm_S2x + Deltaubarprimeprm_S2x*Deltaucalib + Deltaubarprm_S2x*Deltaucalibprime
    Deltatprimeprm_S2x = Deltauprimeprm_S2x*r**2 + 2*Deltauprm_S2x*r
    Deltatprm_S2x = Deltauprm_S2x*r**2
    Deltarprm_S2x = Deltatprm_S2x*Dinv
    Lambtprm_S2x = -Deltat*a**2*sin2thetaprm_S2x - 2*Deltat*a*aprm_S2x*sin2theta - Deltatprm_S2x*a**2*sin2theta + 2*w2*w2prm_S2x
    csiprm_S2x = -w2prm_S2x*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S2x/2 + Deltarprm_S2x*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S2x = csiprm_S2x*(1 - abs(1 - tortoise))
    csi2prm_S2x = csiprm_S2x*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S2x = csi2prm_S2x*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S2x = n3*prTprm_S2x*(1 - 1/csi1) + csi1prm_S2x*n3*prT/csi1**2
    phat2prm_S2x = n2*prTprm_S2x*(1 - 1/csi1) + csi1prm_S2x*n2*prT/csi1**2
    phat1prm_S2x = n1*prTprm_S2x*(1 - 1/csi1) + csi1prm_S2x*n1*prT/csi1**2
    pdotxirprm_S2x = r*(phat1*xi1prm_S2x + phat1prm_S2x*xi1 + phat2*xi2prm_S2x + phat2prm_S2x*xi2 + phat3*xi3prm_S2x + phat3prm_S2x*xi3)
    pdotnprm_S2x = n1*phat1prm_S2x + n2*phat2prm_S2x + n3*phat3prm_S2x
    pdotvrprm_S2x = r*(phat1*v1prm_S2x + phat1prm_S2x*v1 + phat2*v2prm_S2x + phat2prm_S2x*v2 + phat3*v3prm_S2x + phat3prm_S2x*v3)
    pphiprm_S2x = pdotxirprm_S2x
    Qcoeff2prm_S2x = -sin2thetaprm_S2x/(Sigma*sin2theta**2) - Sigmaprm_S2x/(Sigma**2*sin2theta)
    Qcoeff1prm_S2x = -Sigma*sin2thetaprm_S2x/(Lambt*sin2theta**2) + Sigmaprm_S2x/(Lambt*sin2theta) - Lambtprm_S2x*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S2x = 2*Deltar*pdotn*pdotnprm_S2x/Sigma - Deltar*Sigmaprm_S2x*pdotn**2/Sigma**2 + Deltarprm_S2x*pdotn**2/Sigma
    Qprm_S2x = DrSipn2prm_S2x + 2*Qcoeff1*pdotxir*pdotxirprm_S2x + Qcoeff1prm_S2x*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S2x + Qcoeff2prm_S2x*pdotvr**2
    Qminus1prm_S2x = Qprm_S2x
    Jtildeprm_S2x = Deltarprm_S2x/(2*np.sqrt(Deltar))
    exp2muprm_S2x = Sigmaprm_S2x
    expmuprm_S2x = exp2muprm_S2x/(2*np.sqrt(exp2mu))
    Brtildeprm_S2x = (np.sqrt(Deltar)*Deltatprimeprm_S2x - 2*Deltatprm_S2x + Deltarprm_S2x*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S2x/2 - Deltarprm_S2x*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S2x = Deltatprm_S2x/(2*np.sqrt(Deltat))
    exp2nuprm_S2x = Deltat*Sigmaprm_S2x/Lambt - Deltat*Lambtprm_S2x*Sigma/Lambt**2 + Deltatprm_S2x*Sigma/Lambt
    expnuprm_S2x = exp2nuprm_S2x/(2*np.sqrt(exp2nu))
    omegaprm_S2x = omegatildeprm_S2x/Lambt - Lambtprm_S2x*omegatilde/Lambt**2
    omegatildeprimeprm_S2x = 2*aprm_S2x
    Lambtprimeprm_S2x = -2*Deltatprime*a**2*sin2thetaprm_S2x - 4*Deltatprime*a*aprm_S2x*sin2theta - 2*Deltatprimeprm_S2x*a**2*sin2theta + 8*a*aprm_S2x*r
    mucosthetaprm_S2x = a**2*costhetaprm_S2x/Sigma + 2*a*aprm_S2x*costheta/Sigma - Sigmaprm_S2x*a**2*costheta/Sigma**2
    nucosthetaprm_S2x = a**2*costheta*w2*(-Deltatprm_S2x + w2prm_S2x)/(Lambt*Sigma) + a**2*costheta*w2prm_S2x*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S2x*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S2x*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S2x*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S2x*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S2x = -2*Deltat*a**2*costheta*omegatildeprm_S2x/Lambt**2 - 2*Deltat*a**2*costhetaprm_S2x*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S2x*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S2x*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S2x*a**2*costheta*omegatilde/Lambt**2
    murprm_S2x = -Sigmaprm_S2x*r/Sigma**2 + Deltarprm_S2x/(2*Deltar**(3/2))
    nurprm_S2x = -Sigmaprm_S2x*r/Sigma**2 + w2*(Deltatprime*w2prm_S2x + Deltatprimeprm_S2x*w2 - 4*Deltatprm_S2x*r)/(2*Deltat*Lambt) + w2prm_S2x*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S2x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S2x*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S2x = (Lambt*omegatildeprimeprm_S2x - Lambtprime*omegatildeprm_S2x - Lambtprimeprm_S2x*omegatilde + Lambtprm_S2x*omegatildeprime)/Lambt**2 + Lambtprm_S2x*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S2x = eta*(eta*r*(-882*DrSipn2prm_S2x + 204*Qminus1prm_S2x + r*(1620*DrSipn2*DrSipn2prm_S2x - 234*DrSipn2*Qminus1prm_S2x - 234*DrSipn2prm_S2x*Qminus1)) + r*(-96*DrSipn2prm_S2x - 436*Qminus1prm_S2x + r*(36*DrSipn2*Qminus1prm_S2x + 36*DrSipn2prm_S2x*Qminus1 - 90*Qminus1*Qminus1prm_S2x)))/(144*r**2)
    sigmacoeffTerm1prm_S2x = eta*(-36*DrSipn2prm_S2x + 3*Qminus1prm_S2x)/12
    sigmacoeffprm_S2x = sigmacoeffTerm1prm_S2x + sigmacoeffTerm2prm_S2x
    sigmastarcoeffTerm2prm_S2x = eta*(eta*r*(-324*DrSipn2prm_S2x + 120*Qminus1prm_S2x + r*(720*DrSipn2*DrSipn2prm_S2x + Qminus1*(-126*DrSipn2prm_S2x - 3*Qminus1prm_S2x) + Qminus1prm_S2x*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S2x + Qminus1*r*(96*DrSipn2prm_S2x - 23*Qminus1prm_S2x) + Qminus1prm_S2x*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S2x))/(72*r**2)
    sigmastarcoeffTerm1prm_S2x = eta*(-30*DrSipn2prm_S2x + 4*Qminus1prm_S2x)/12
    sigmastarcoeffprm_S2x = sigmastarcoeffTerm1prm_S2x + sigmastarcoeffTerm2prm_S2x
    Deltasigmastar3prm_S2x = sigma3*sigmacoeffprm_S2x + sigmastar3*sigmastarcoeffprm_S2x
    Deltasigmastar2prm_S2x = sigma2*sigmacoeffprm_S2x + sigmastar2*sigmastarcoeffprm_S2x
    Deltasigmastar1prm_S2x = sigma1*sigmacoeffprm_S2x + sigma1prm_S2x*sigmacoeff + sigmastar1*sigmastarcoeffprm_S2x + sigmastar1prm_S2x*sigmastarcoeff
    Sstar3prm_S2x = Deltasigmastar3prm_S2x
    Sstar2prm_S2x = Deltasigmastar2prm_S2x
    Sstar1prm_S2x = Deltasigmastar1prm_S2x + sigmastar1prm_S2x
    S3prm_S2x = Sstar3prm_S2x
    S2prm_S2x = Sstar2prm_S2x
    S1prm_S2x = Sstar1prm_S2x
    Sstardotnprm_S2x = Sstar1prm_S2x*n1 + Sstar2prm_S2x*n2 + Sstar3prm_S2x*n3
    SdotSkerrhatprm_S2x = S1*Skerrhat1prm_S2x + S1prm_S2x*Skerrhat1 + S2*Skerrhat2prm_S2x + S2prm_S2x*Skerrhat2 + S3*Skerrhat3prm_S2x + S3prm_S2x*Skerrhat3
    Sdotnprm_S2x = S1prm_S2x*n1 + S2prm_S2x*n2 + S3prm_S2x*n3
    Sdotvprm_S2x = S1*v1prm_S2x + S1prm_S2x*v1 + S2*v2prm_S2x + S2prm_S2x*v2 + S3*v3prm_S2x + S3prm_S2x*v3
    Sdotxiprm_S2x = S1*xi1prm_S2x + S1prm_S2x*xi1 + S2*xi2prm_S2x + S2prm_S2x*xi2 + S3*xi3prm_S2x + S3prm_S2x*xi3
    HdsumTerm2prm_S2x = 6*Sstardotn*Sstardotnprm_S2x
    HdsumTerm1prm_S2x = 2*Sstar1*Sstar1prm_S2x + 2*Sstar2*Sstar2prm_S2x + 2*Sstar3*Sstar3prm_S2x
    Hdsumprm_S2x = HdsumTerm1prm_S2x - HdsumTerm2prm_S2x
    Q4prm_S2x = 8*eta*prT**3*prTprm_S2x*u**2*(4 - 3*eta)
    gammappsumprm_S2x = 2*Deltar*pdotn*pdotnprm_S2x/Sigma - Deltar*Sigmaprm_S2x*pdotn**2/Sigma**2 + Deltarprm_S2x*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S2x/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S2x/(Sigma*sin2theta) - Sigmaprm_S2x*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S2x/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S2x/(Lambt*sin2theta) + Sigmaprm_S2x*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S2x*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S2x = Q4prm_S2x + gammappsumprm_S2x
    alphaprm_S2x = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S2x/(2*Lambt) - Deltat*Lambtprm_S2x*Sigma/(2*Lambt**2) + Deltatprm_S2x*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S2x = omegatilde*pphiprm_S2x/Lambt + omegatildeprm_S2x*pphi/Lambt - Lambtprm_S2x*omegatilde*pphi/Lambt**2
    HssTerm3prm_S2x = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S2x - Qprm_S2x/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S2x*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S2x*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S2x*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S2x - Jtilde*Sdotvprm_S2x*pdotn - Jtildeprm_S2x*Sdotv*pdotn + Sdotn*pdotvrprm_S2x + Sdotnprm_S2x*pdotvr) + pdotvrprm_S2x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S2x*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S2x + Btilde*Jtilde*Sdotxiprm_S2x*pdotn + Btilde*Jtildeprm_S2x*Sdotxi*pdotn + Btildeprm_S2x*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S2x - Sdotn*expmu*expnuprm_S2x*pdotxir - Sdotn*expmuprm_S2x*expnu*pdotxir - Sdotnprm_S2x*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S2x*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S2x*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S2x*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S2x = omegacostheta*(-Qprm_S2x - Qprm_S2x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S2x/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S2x*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S2x*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S2x*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2x*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S2x = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S2x - Jtilde*Sdotvprm_S2x*pdotn - Jtildeprm_S2x*Sdotv*pdotn + Sdotn*pdotvrprm_S2x + Sdotnprm_S2x*pdotvr) + Jtilde*pdotnprm_S2x*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S2x*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S2x + Qprm_S2x/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S2x*(np.sqrt(Q) + Q) + Sdotvprm_S2x*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S2x*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S2x*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S2x - Btilde*Sdotxi*expnuprm_S2x*pdotvr - Btilde*Sdotxiprm_S2x*expnu*pdotvr - Btildeprm_S2x*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S2x + Sdotv*exp2nu*expmuprm_S2x*pdotxir + Sdotv*exp2nuprm_S2x*expmu*pdotxir + Sdotvprm_S2x*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S2x*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S2x*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S2x = Jtilde*omegar*(-Qprm_S2x - Qprm_S2x/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S2x/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S2x/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S2x*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S2x*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S2x*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S2x*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2x*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S2x = SdotSkerrhat*omegaprm_S2x + SdotSkerrhatprm_S2x*omega
    Hssprm_S2x = HssTerm1prm_S2x + HssTerm2*HssTerm2coeffprm_S2x + HssTerm2coeff*HssTerm2prm_S2x + HssTerm3*HssTerm3coeffprm_S2x + HssTerm3coeff*HssTerm3prm_S2x
    HsoTerm2cprm_S2x = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S2x*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S2x*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S2x*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S2x*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S2x*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S2x*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S2x*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S2x = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S2x + Jtilde*Sdotvprm_S2x*nur + Jtildeprm_S2x*Sdotv*nur - Sdotn*nucostheta*xisqprm_S2x - Sdotn*nucosthetaprm_S2x*xisq - Sdotnprm_S2x*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S2x*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S2x*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S2x*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S2x*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S2x*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S2x = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S2x + nurprm_S2x*pdotvr + pdotn*xisq*(mucosthetaprm_S2x - nucosthetaprm_S2x) + pdotn*xisqprm_S2x*(mucostheta - nucostheta) + pdotnprm_S2x*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S2x - mucostheta*pdotnprm_S2x*xisq - mucosthetaprm_S2x*pdotn*xisq + mur*pdotvrprm_S2x*(np.sqrt(Q) + 1) + murprm_S2x*pdotvr*(np.sqrt(Q) + 1) + Qprm_S2x*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S2x*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S2x*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S2x*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S2x*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S2x = HsoTerm2aprm_S2x + HsoTerm2bprm_S2x - HsoTerm2cprm_S2x
    HsoTerm2coeffprm_S2x = expnu*(-Qprm_S2x - Qprm_S2x/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S2x/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S2x/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S2x*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S2x*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S2x = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S2x + expmu*expnuprm_S2x + expmuprm_S2x*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S2x*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S2x*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S2x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S2x*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S2x*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S2x*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S2x*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S2x = HsoTerm1prm_S2x + HsoTerm2*HsoTerm2coeffprm_S2x + HsoTerm2coeff*HsoTerm2prm_S2x
    Hdprm_S2x = Hdcoeff*Hdsumprm_S2x
    Hnsprm_S2x = np.sqrt(Hnsradicand)*alphaprm_S2x + betapsumprm_S2x + Hnsradicandprm_S2x*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S2x = Hsoprm_S2x + Hssprm_S2x
    Heffprm_S2x = -Hdprm_S2x + Hnsprm_S2x + Hsprm_S2x + 2*S2x*dSS*eta*u**4
    Hrealprm_S2x = Heffprm_S2x*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S2x])
def new_compute_dHdS2y(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar2prm_S2y = m1/m2
    sigma2prm_S2y = 1
    Skerr2prm_S2y = sigma2prm_S2y
    Skerrmagprm_S2y = Skerr2*Skerr2prm_S2y/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S2y = -Skerr3*Skerrmagprm_S2y/Skerrmag**2
    Skerrhat2prm_S2y = -Skerr2*Skerrmagprm_S2y/Skerrmag**2 + Skerr2prm_S2y/Skerrmag
    Skerrhat1prm_S2y = -Skerr1*Skerrmagprm_S2y/Skerrmag**2
    aprm_S2y = Skerrmagprm_S2y
    e33prm_S2y = Skerrhat3prm_S2y
    e32prm_S2y = Skerrhat2prm_S2y
    e31prm_S2y = Skerrhat1prm_S2y
    xi3prm_S2y = e31prm_S2y*n2 - e32prm_S2y*n1
    xi2prm_S2y = -e31prm_S2y*n3 + e33prm_S2y*n1
    xi1prm_S2y = e32prm_S2y*n3 - e33prm_S2y*n2
    v3prm_S2y = n1*xi2prm_S2y - n2*xi1prm_S2y
    v2prm_S2y = -n1*xi3prm_S2y + n3*xi1prm_S2y
    v1prm_S2y = n2*xi3prm_S2y - n3*xi2prm_S2y
    costhetaprm_S2y = e31prm_S2y*n1 + e32prm_S2y*n2 + e33prm_S2y*n3
    sin2thetaprm_S2y = -2*costheta*costhetaprm_S2y
    xisqprm_S2y = sin2thetaprm_S2y
    w2prm_S2y = 2*a*aprm_S2y
    Sigmaprm_S2y = 2*a**2*costheta*costhetaprm_S2y + 2*a*aprm_S2y*costheta**2
    omegatildeprm_S2y = 2*aprm_S2y*r
    Delta2prm_S2y = -2*Delta0*a*aprm_S2y*etaKminus1**2
    Delta3prm_S2y = Delta1*Delta2prm_S2y - 2*Delta1*a*aprm_S2y*etaKminus1**2 - 2*Delta2prm_S2y*etaKminus1
    Delta4prm_S2y = -Delta1**2*Delta2prm_S2y + Delta1*(2*Delta2prm_S2y*etaKminus1 + Delta3prm_S2y) + Delta2*Delta2prm_S2y - Delta2prm_S2y*a**2*etaKminus1**2 - 2*Delta3prm_S2y*etaKminus1 + a*aprm_S2y*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S2y = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S2y + 3*Delta3prm_S2y)/3 + a*aprm_S2y*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S2y + 4*Delta1*Delta3prm_S2y + 4*Delta2*Delta2prm_S2y - 4*Delta4prm_S2y)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S2y + 5*Delta1**2*Delta3prm_S2y + 10*Delta1*Delta2*Delta2prm_S2y - 5*Delta1*Delta4prm_S2y - 5*Delta2*Delta3prm_S2y - 5*Delta2prm_S2y*Delta3)/(5*etaKminus1**2))
    logargprm_S2y = u**2*(Delta2prm_S2y + u*(Delta3prm_S2y + u*(Delta4prm_S2y + Delta5prm_S2y*u)))
    Deltaucalibprm_S2y = eta*logargprm_S2y/(logarg + 1)
    Deltaucalibprimeprm_S2y = eta*logargprm_S2y*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S2y + u*(3*Delta3prm_S2y + u*(4*Delta4prm_S2y + 5*Delta5prm_S2y*u)))/(logarg + 1)
    Deltaubarprm_S2y = 2*a*aprm_S2y*u**2
    Deltaubarprimeprm_S2y = -4*a*aprm_S2y*u**3
    Deltauprm_S2y = Deltaubar*Deltaucalibprm_S2y + Deltaubarprm_S2y*Deltaucalib
    Deltauprimeprm_S2y = Deltaubar*Deltaucalibprimeprm_S2y + Deltaubarprime*Deltaucalibprm_S2y + Deltaubarprimeprm_S2y*Deltaucalib + Deltaubarprm_S2y*Deltaucalibprime
    Deltatprimeprm_S2y = Deltauprimeprm_S2y*r**2 + 2*Deltauprm_S2y*r
    Deltatprm_S2y = Deltauprm_S2y*r**2
    Deltarprm_S2y = Deltatprm_S2y*Dinv
    Lambtprm_S2y = -Deltat*a**2*sin2thetaprm_S2y - 2*Deltat*a*aprm_S2y*sin2theta - Deltatprm_S2y*a**2*sin2theta + 2*w2*w2prm_S2y
    csiprm_S2y = -w2prm_S2y*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S2y/2 + Deltarprm_S2y*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S2y = csiprm_S2y*(1 - abs(1 - tortoise))
    csi2prm_S2y = csiprm_S2y*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S2y = csi2prm_S2y*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S2y = n3*prTprm_S2y*(1 - 1/csi1) + csi1prm_S2y*n3*prT/csi1**2
    phat2prm_S2y = n2*prTprm_S2y*(1 - 1/csi1) + csi1prm_S2y*n2*prT/csi1**2
    phat1prm_S2y = n1*prTprm_S2y*(1 - 1/csi1) + csi1prm_S2y*n1*prT/csi1**2
    pdotxirprm_S2y = r*(phat1*xi1prm_S2y + phat1prm_S2y*xi1 + phat2*xi2prm_S2y + phat2prm_S2y*xi2 + phat3*xi3prm_S2y + phat3prm_S2y*xi3)
    pdotnprm_S2y = n1*phat1prm_S2y + n2*phat2prm_S2y + n3*phat3prm_S2y
    pdotvrprm_S2y = r*(phat1*v1prm_S2y + phat1prm_S2y*v1 + phat2*v2prm_S2y + phat2prm_S2y*v2 + phat3*v3prm_S2y + phat3prm_S2y*v3)
    pphiprm_S2y = pdotxirprm_S2y
    Qcoeff2prm_S2y = -sin2thetaprm_S2y/(Sigma*sin2theta**2) - Sigmaprm_S2y/(Sigma**2*sin2theta)
    Qcoeff1prm_S2y = -Sigma*sin2thetaprm_S2y/(Lambt*sin2theta**2) + Sigmaprm_S2y/(Lambt*sin2theta) - Lambtprm_S2y*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S2y = 2*Deltar*pdotn*pdotnprm_S2y/Sigma - Deltar*Sigmaprm_S2y*pdotn**2/Sigma**2 + Deltarprm_S2y*pdotn**2/Sigma
    Qprm_S2y = DrSipn2prm_S2y + 2*Qcoeff1*pdotxir*pdotxirprm_S2y + Qcoeff1prm_S2y*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S2y + Qcoeff2prm_S2y*pdotvr**2
    Qminus1prm_S2y = Qprm_S2y
    Jtildeprm_S2y = Deltarprm_S2y/(2*np.sqrt(Deltar))
    exp2muprm_S2y = Sigmaprm_S2y
    expmuprm_S2y = exp2muprm_S2y/(2*np.sqrt(exp2mu))
    Brtildeprm_S2y = (np.sqrt(Deltar)*Deltatprimeprm_S2y - 2*Deltatprm_S2y + Deltarprm_S2y*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S2y/2 - Deltarprm_S2y*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S2y = Deltatprm_S2y/(2*np.sqrt(Deltat))
    exp2nuprm_S2y = Deltat*Sigmaprm_S2y/Lambt - Deltat*Lambtprm_S2y*Sigma/Lambt**2 + Deltatprm_S2y*Sigma/Lambt
    expnuprm_S2y = exp2nuprm_S2y/(2*np.sqrt(exp2nu))
    omegaprm_S2y = omegatildeprm_S2y/Lambt - Lambtprm_S2y*omegatilde/Lambt**2
    omegatildeprimeprm_S2y = 2*aprm_S2y
    Lambtprimeprm_S2y = -2*Deltatprime*a**2*sin2thetaprm_S2y - 4*Deltatprime*a*aprm_S2y*sin2theta - 2*Deltatprimeprm_S2y*a**2*sin2theta + 8*a*aprm_S2y*r
    mucosthetaprm_S2y = a**2*costhetaprm_S2y/Sigma + 2*a*aprm_S2y*costheta/Sigma - Sigmaprm_S2y*a**2*costheta/Sigma**2
    nucosthetaprm_S2y = a**2*costheta*w2*(-Deltatprm_S2y + w2prm_S2y)/(Lambt*Sigma) + a**2*costheta*w2prm_S2y*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S2y*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S2y*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S2y*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S2y*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S2y = -2*Deltat*a**2*costheta*omegatildeprm_S2y/Lambt**2 - 2*Deltat*a**2*costhetaprm_S2y*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S2y*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S2y*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S2y*a**2*costheta*omegatilde/Lambt**2
    murprm_S2y = -Sigmaprm_S2y*r/Sigma**2 + Deltarprm_S2y/(2*Deltar**(3/2))
    nurprm_S2y = -Sigmaprm_S2y*r/Sigma**2 + w2*(Deltatprime*w2prm_S2y + Deltatprimeprm_S2y*w2 - 4*Deltatprm_S2y*r)/(2*Deltat*Lambt) + w2prm_S2y*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S2y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S2y*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S2y = (Lambt*omegatildeprimeprm_S2y - Lambtprime*omegatildeprm_S2y - Lambtprimeprm_S2y*omegatilde + Lambtprm_S2y*omegatildeprime)/Lambt**2 + Lambtprm_S2y*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S2y = eta*(eta*r*(-882*DrSipn2prm_S2y + 204*Qminus1prm_S2y + r*(1620*DrSipn2*DrSipn2prm_S2y - 234*DrSipn2*Qminus1prm_S2y - 234*DrSipn2prm_S2y*Qminus1)) + r*(-96*DrSipn2prm_S2y - 436*Qminus1prm_S2y + r*(36*DrSipn2*Qminus1prm_S2y + 36*DrSipn2prm_S2y*Qminus1 - 90*Qminus1*Qminus1prm_S2y)))/(144*r**2)
    sigmacoeffTerm1prm_S2y = eta*(-36*DrSipn2prm_S2y + 3*Qminus1prm_S2y)/12
    sigmacoeffprm_S2y = sigmacoeffTerm1prm_S2y + sigmacoeffTerm2prm_S2y
    sigmastarcoeffTerm2prm_S2y = eta*(eta*r*(-324*DrSipn2prm_S2y + 120*Qminus1prm_S2y + r*(720*DrSipn2*DrSipn2prm_S2y + Qminus1*(-126*DrSipn2prm_S2y - 3*Qminus1prm_S2y) + Qminus1prm_S2y*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S2y + Qminus1*r*(96*DrSipn2prm_S2y - 23*Qminus1prm_S2y) + Qminus1prm_S2y*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S2y))/(72*r**2)
    sigmastarcoeffTerm1prm_S2y = eta*(-30*DrSipn2prm_S2y + 4*Qminus1prm_S2y)/12
    sigmastarcoeffprm_S2y = sigmastarcoeffTerm1prm_S2y + sigmastarcoeffTerm2prm_S2y
    Deltasigmastar3prm_S2y = sigma3*sigmacoeffprm_S2y + sigmastar3*sigmastarcoeffprm_S2y
    Deltasigmastar2prm_S2y = sigma2*sigmacoeffprm_S2y + sigma2prm_S2y*sigmacoeff + sigmastar2*sigmastarcoeffprm_S2y + sigmastar2prm_S2y*sigmastarcoeff
    Deltasigmastar1prm_S2y = sigma1*sigmacoeffprm_S2y + sigmastar1*sigmastarcoeffprm_S2y
    Sstar3prm_S2y = Deltasigmastar3prm_S2y
    Sstar2prm_S2y = Deltasigmastar2prm_S2y + sigmastar2prm_S2y
    Sstar1prm_S2y = Deltasigmastar1prm_S2y
    S3prm_S2y = Sstar3prm_S2y
    S2prm_S2y = Sstar2prm_S2y
    S1prm_S2y = Sstar1prm_S2y
    Sstardotnprm_S2y = Sstar1prm_S2y*n1 + Sstar2prm_S2y*n2 + Sstar3prm_S2y*n3
    SdotSkerrhatprm_S2y = S1*Skerrhat1prm_S2y + S1prm_S2y*Skerrhat1 + S2*Skerrhat2prm_S2y + S2prm_S2y*Skerrhat2 + S3*Skerrhat3prm_S2y + S3prm_S2y*Skerrhat3
    Sdotnprm_S2y = S1prm_S2y*n1 + S2prm_S2y*n2 + S3prm_S2y*n3
    Sdotvprm_S2y = S1*v1prm_S2y + S1prm_S2y*v1 + S2*v2prm_S2y + S2prm_S2y*v2 + S3*v3prm_S2y + S3prm_S2y*v3
    Sdotxiprm_S2y = S1*xi1prm_S2y + S1prm_S2y*xi1 + S2*xi2prm_S2y + S2prm_S2y*xi2 + S3*xi3prm_S2y + S3prm_S2y*xi3
    HdsumTerm2prm_S2y = 6*Sstardotn*Sstardotnprm_S2y
    HdsumTerm1prm_S2y = 2*Sstar1*Sstar1prm_S2y + 2*Sstar2*Sstar2prm_S2y + 2*Sstar3*Sstar3prm_S2y
    Hdsumprm_S2y = HdsumTerm1prm_S2y - HdsumTerm2prm_S2y
    Q4prm_S2y = 8*eta*prT**3*prTprm_S2y*u**2*(4 - 3*eta)
    gammappsumprm_S2y = 2*Deltar*pdotn*pdotnprm_S2y/Sigma - Deltar*Sigmaprm_S2y*pdotn**2/Sigma**2 + Deltarprm_S2y*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S2y/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S2y/(Sigma*sin2theta) - Sigmaprm_S2y*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S2y/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S2y/(Lambt*sin2theta) + Sigmaprm_S2y*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S2y*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S2y = Q4prm_S2y + gammappsumprm_S2y
    alphaprm_S2y = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S2y/(2*Lambt) - Deltat*Lambtprm_S2y*Sigma/(2*Lambt**2) + Deltatprm_S2y*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S2y = omegatilde*pphiprm_S2y/Lambt + omegatildeprm_S2y*pphi/Lambt - Lambtprm_S2y*omegatilde*pphi/Lambt**2
    HssTerm3prm_S2y = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S2y - Qprm_S2y/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S2y*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S2y*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S2y*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S2y - Jtilde*Sdotvprm_S2y*pdotn - Jtildeprm_S2y*Sdotv*pdotn + Sdotn*pdotvrprm_S2y + Sdotnprm_S2y*pdotvr) + pdotvrprm_S2y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S2y*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S2y + Btilde*Jtilde*Sdotxiprm_S2y*pdotn + Btilde*Jtildeprm_S2y*Sdotxi*pdotn + Btildeprm_S2y*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S2y - Sdotn*expmu*expnuprm_S2y*pdotxir - Sdotn*expmuprm_S2y*expnu*pdotxir - Sdotnprm_S2y*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S2y*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S2y*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S2y*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S2y = omegacostheta*(-Qprm_S2y - Qprm_S2y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S2y/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S2y*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S2y*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S2y*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2y*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S2y = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S2y - Jtilde*Sdotvprm_S2y*pdotn - Jtildeprm_S2y*Sdotv*pdotn + Sdotn*pdotvrprm_S2y + Sdotnprm_S2y*pdotvr) + Jtilde*pdotnprm_S2y*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S2y*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S2y + Qprm_S2y/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S2y*(np.sqrt(Q) + Q) + Sdotvprm_S2y*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S2y*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S2y*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S2y - Btilde*Sdotxi*expnuprm_S2y*pdotvr - Btilde*Sdotxiprm_S2y*expnu*pdotvr - Btildeprm_S2y*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S2y + Sdotv*exp2nu*expmuprm_S2y*pdotxir + Sdotv*exp2nuprm_S2y*expmu*pdotxir + Sdotvprm_S2y*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S2y*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S2y*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S2y = Jtilde*omegar*(-Qprm_S2y - Qprm_S2y/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S2y/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S2y/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S2y*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S2y*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S2y*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S2y*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2y*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S2y = SdotSkerrhat*omegaprm_S2y + SdotSkerrhatprm_S2y*omega
    Hssprm_S2y = HssTerm1prm_S2y + HssTerm2*HssTerm2coeffprm_S2y + HssTerm2coeff*HssTerm2prm_S2y + HssTerm3*HssTerm3coeffprm_S2y + HssTerm3coeff*HssTerm3prm_S2y
    HsoTerm2cprm_S2y = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S2y*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S2y*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S2y*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S2y*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S2y*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S2y*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S2y*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S2y = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S2y + Jtilde*Sdotvprm_S2y*nur + Jtildeprm_S2y*Sdotv*nur - Sdotn*nucostheta*xisqprm_S2y - Sdotn*nucosthetaprm_S2y*xisq - Sdotnprm_S2y*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S2y*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S2y*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S2y*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S2y*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S2y*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S2y = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S2y + nurprm_S2y*pdotvr + pdotn*xisq*(mucosthetaprm_S2y - nucosthetaprm_S2y) + pdotn*xisqprm_S2y*(mucostheta - nucostheta) + pdotnprm_S2y*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S2y - mucostheta*pdotnprm_S2y*xisq - mucosthetaprm_S2y*pdotn*xisq + mur*pdotvrprm_S2y*(np.sqrt(Q) + 1) + murprm_S2y*pdotvr*(np.sqrt(Q) + 1) + Qprm_S2y*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S2y*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S2y*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S2y*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S2y*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S2y = HsoTerm2aprm_S2y + HsoTerm2bprm_S2y - HsoTerm2cprm_S2y
    HsoTerm2coeffprm_S2y = expnu*(-Qprm_S2y - Qprm_S2y/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S2y/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S2y/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S2y*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S2y*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S2y = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S2y + expmu*expnuprm_S2y + expmuprm_S2y*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S2y*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S2y*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S2y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S2y*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S2y*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S2y*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S2y*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S2y = HsoTerm1prm_S2y + HsoTerm2*HsoTerm2coeffprm_S2y + HsoTerm2coeff*HsoTerm2prm_S2y
    Hdprm_S2y = Hdcoeff*Hdsumprm_S2y
    Hnsprm_S2y = np.sqrt(Hnsradicand)*alphaprm_S2y + betapsumprm_S2y + Hnsradicandprm_S2y*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S2y = Hsoprm_S2y + Hssprm_S2y
    Heffprm_S2y = -Hdprm_S2y + Hnsprm_S2y + Hsprm_S2y + 2*S2y*dSS*eta*u**4
    Hrealprm_S2y = Heffprm_S2y*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S2y])
def new_compute_dHdS2z(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    M = m1+m2
    mu = m1*m2/M
    eta = mu/M
    r = np.sqrt(x*x+y*y+z*z)
    u = 1/r
    sigmastar3 = m2/m1*S1z+m1/m2*S2z
    sigmastar2 = m2/m1*S1y+m1/m2*S2y
    sigmastar1 = m2/m1*S1x+m1/m2*S2x
    sigma3 = S1z+S2z
    sigma2 = S1y+S2y
    sigma1 = S1x+S2x
    Skerr3 = sigma3
    Skerr2 = sigma2
    Skerr1 = sigma1
    Skerrmag = np.sqrt(Skerr1*Skerr1+Skerr2*Skerr2+Skerr3*Skerr3)
    Skerrhat3 = Skerr3/Skerrmag
    Skerrhat2 = Skerr2/Skerrmag
    Skerrhat1 = Skerr1/Skerrmag
    a = Skerrmag
    n3 = z/r
    n2 = y/r
    n1 = x/r
    e33 = Skerrhat3
    e32 = Skerrhat2
    e31 = Skerrhat1
    xi3 = e31*n2-e32*n1
    xi2 = -e31*n3+e33*n1
    xi1 = e32*n3-e33*n2
    v3 = n1*xi2-n2*xi1
    v2 = n3*xi1-n1*xi3
    v1 = n2*xi3-n3*xi2
    costheta = e31*n1+e32*n2+e33*n3
    sin2theta = 1-costheta*costheta
    xisq = sin2theta
    w2 = a*a+r*r
    Sigma = r*r+a*a*costheta*costheta
    Dinv = 1+np.log(1+6*eta*u*u+2*(26-3*eta)*eta*u*u*u)
    omegatilde = 2*a*r
    K = 1.712-1.803949138004582*eta-39.77229225266885*eta*eta+103.16588921239249*eta*eta*eta
    etaKminus1 = eta*K-1
    Delta0 = K*(eta*K-2)
    Delta1 = -2*etaKminus1*(K+Delta0)
    Delta2 = np.true_divide(1,2)*Delta1*(Delta1-4*etaKminus1)-a*a*etaKminus1*etaKminus1*Delta0
    Delta3 = -np.true_divide(1,3)*Delta1*Delta1*Delta1+etaKminus1*Delta1*Delta1+Delta2*Delta1-2*etaKminus1*(Delta2-etaKminus1)-a*a*etaKminus1*etaKminus1*Delta1
    Delta4 = np.true_divide(1,12)*(6*a*a*(Delta1*Delta1-2*Delta2)*etaKminus1*etaKminus1+3*Delta1*Delta1*Delta1*Delta1-8*etaKminus1*Delta1*Delta1*Delta1-12*Delta2*Delta1*Delta1+12*(2*etaKminus1*Delta2+Delta3)*Delta1+12*(np.true_divide(94,3)-np.true_divide(41,32)*np.pi*np.pi)*etaKminus1*etaKminus1+6*(Delta2*Delta2-4*Delta3*etaKminus1))
    Delta5 = etaKminus1*etaKminus1*((np.true_divide(-4237,60)+np.true_divide(128,5)*EMgamma+np.true_divide(2275,512)*np.pi*np.pi-np.true_divide(1,3)*a*a*(Delta1*Delta1*Delta1-3*Delta1*Delta2+3*Delta3)-(Delta1*Delta1*Delta1*Delta1*Delta1-5*Delta1*Delta1*Delta1*Delta2+5*Delta1*Delta2*Delta2+5*Delta1*Delta1*Delta3-5*Delta2*Delta3-5*Delta1*Delta4)/(5*etaKminus1*etaKminus1)+(Delta1*Delta1*Delta1*Delta1-4*Delta1*Delta1*Delta2+2*Delta2*Delta2+4*Delta1*Delta3-4*Delta4)/(2*etaKminus1)+np.true_divide(256,5)*np.log(2)))
    Delta5l = etaKminus1*etaKminus1*np.true_divide(64,5)
    logarg = u*(Delta1+u*(Delta2+u*(Delta3+u*(Delta4+u*(Delta5+Delta5l*np.log(u))))))
    Deltaucalib = 1+eta*(Delta0+np.log(1+logarg))
    Deltaucalibprime = -eta*u*u*(Delta1+u*(2*Delta2+u*(3*Delta3+u*(4*Delta4+u*(5*(Delta5+Delta5l*np.log(u)))))))/(1+logarg)
    Deltaubar = a*a*u*u+(2*u+1/etaKminus1)/etaKminus1
    Deltaubarprime = -2*a*a*u*u*u-2*u*u/(etaKminus1)
    Deltau = Deltaubar*Deltaucalib
    Deltauprime = Deltaubarprime*Deltaucalib+Deltaubar*Deltaucalibprime
    Deltatprime = 2*r*Deltau+r*r*Deltauprime
    Deltat = r*r*Deltau
    Deltar = Deltat*Dinv
    Lambt = w2*w2-a*a*Deltat*sin2theta
    csi = np.sqrt(Deltar*Deltat)/w2
    csi1 = 1+(1-abs(1-tortoise))*(csi-1)
    csi2 = 1+(np.true_divide(1,2)-np.true_divide(1,2)*np.sign(np.true_divide(3,2)-tortoise))*(csi-1)
    prT = csi2*(p1*n1+p2*n2+p3*n3)
    phat3 = p3+prT*(1-1/csi1)*n3
    phat2 = p2+prT*(1-1/csi1)*n2
    phat1 = p1+prT*(1-1/csi1)*n1
    pdotxir = (phat1*xi1+phat2*xi2+phat3*xi3)*r
    pdotn = phat1*n1+phat2*n2+phat3*n3
    pdotvr = (phat1*v1+phat2*v2+phat3*v3)*r
    pphi = pdotxir
    Qcoeff2 = 1/(Sigma*sin2theta)
    Qcoeff1 = Sigma/(Lambt*sin2theta)
    DrSipn2 = Deltar*pdotn*pdotn/Sigma
    Q = 1+DrSipn2+Qcoeff1*pdotxir*pdotxir+Qcoeff2*pdotvr*pdotvr
    Qminus1 = Q-1
    Jtilde = np.sqrt(Deltar)
    exp2mu = Sigma
    expmu = np.sqrt(exp2mu)
    Brtilde = (np.sqrt(Deltar)*Deltatprime-2*Deltat)/(2*np.sqrt(Deltar*Deltat))
    Btilde = np.sqrt(Deltat)
    exp2nu = Deltat*Sigma/Lambt
    expnu = np.sqrt(exp2nu)
    omega = omegatilde/Lambt
    omegatildeprime = 2*a
    Lambtprime = 4*(a*a+r*r)*r-2*a*a*Deltatprime*sin2theta
    mucostheta = a*a*costheta/Sigma
    nucostheta = a*a*w2*costheta*(w2-Deltat)/(Lambt*Sigma)
    omegacostheta = -2*a*a*costheta*Deltat*omegatilde/(Lambt*Lambt)
    mur = r/Sigma-1/np.sqrt(Deltar)
    nur = r/Sigma+w2*(w2*Deltatprime-4*r*Deltat)/(2*Lambt*Deltat)
    omegar = (Lambt*omegatildeprime-Lambtprime*omegatilde)/(Lambt*Lambt)
    dSO = -74.71-156.*eta+627.5*eta*eta
    sigmacoeffTerm3 = eta*dSO*u*u*u
    sigmacoeffTerm2 = eta/(144*r*r)*(-896+r*(-436*Qminus1-96*DrSipn2+r*(-45*Qminus1*Qminus1+36*Qminus1*DrSipn2))+eta*(-336+r*(204*Qminus1-882*DrSipn2+r*(810*DrSipn2*DrSipn2-234*Qminus1*DrSipn2))))
    sigmacoeffTerm1 = eta/12*(-8/r+3*Qminus1-36*DrSipn2)
    sigmacoeff = sigmacoeffTerm1+sigmacoeffTerm2+sigmacoeffTerm3
    sigmastarcoeffTerm2 = eta/(72*r*r)*(706+r*(-206*Qminus1+282*DrSipn2+r*Qminus1*(96*DrSipn2-23*Qminus1))+eta*(-54+r*(120*Qminus1-324*DrSipn2+r*(360*DrSipn2*DrSipn2+Qminus1*(-126*DrSipn2-3*Qminus1)))))
    sigmastarcoeffTerm1 = eta/12*(14/r+4*Qminus1-30*DrSipn2)
    sigmastarcoeff = sigmastarcoeffTerm1+sigmastarcoeffTerm2
    Deltasigmastar3 = sigmastar3*sigmastarcoeff+sigma3*sigmacoeff
    Deltasigmastar2 = sigmastar2*sigmastarcoeff+sigma2*sigmacoeff
    Deltasigmastar1 = sigmastar1*sigmastarcoeff+sigma1*sigmacoeff
    Sstar3 = sigmastar3+Deltasigmastar3
    Sstar2 = sigmastar2+Deltasigmastar2
    Sstar1 = sigmastar1+Deltasigmastar1
    S3 = Sstar3
    S2 = Sstar2
    S1 = Sstar1
    Sstardotn = Sstar1*n1+Sstar2*n2+Sstar3*n3
    SdotSkerrhat = S1*Skerrhat1+S2*Skerrhat2+S3*Skerrhat3
    Sdotn = S1*n1+S2*n2+S3*n3
    Sdotv = S1*v1+S2*v2+S3*v3
    Sdotxi = S1*xi1+S2*xi2+S3*xi3
    HdsumTerm2 = 3*Sstardotn*Sstardotn
    HdsumTerm1 = Sstar1*Sstar1+Sstar2*Sstar2+Sstar3*Sstar3
    Hdsum = HdsumTerm1-HdsumTerm2
    Hdcoeff = np.true_divide(1,2)/(r*r*r)
    Q4 = 2*prT*prT*prT*prT*u*u*(4-3*eta)*eta
    gammappsum = Deltar/Sigma*pdotn*pdotn+1/Sigma*pdotvr*pdotvr/sin2theta+Sigma/Lambt/sin2theta*pdotxir*pdotxir
    Hnsradicand = 1+gammappsum+Q4
    alpha = np.sqrt(Deltat*Sigma/Lambt)
    betapsum = omegatilde*pphi/Lambt
    HssTerm3 = expmu*expnu*pdotxir*(Jtilde*pdotn*Sdotxi*Btilde-expmu*expnu*pdotxir*Sdotn)+(pdotvr*(Sdotn*pdotvr-Jtilde*pdotn*Sdotv)-exp2mu*(np.sqrt(Q)+Q)*Sdotn*xisq)*Btilde*Btilde
    HssTerm3coeff = omegacostheta/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q)))
    HssTerm2 = expmu*pdotxir*(expmu*exp2nu*pdotxir*Sdotv-expnu*pdotvr*Sdotxi*Btilde)+xisq*Btilde*Btilde*(exp2mu*(np.sqrt(Q)+Q)*Sdotv+Jtilde*pdotn*(pdotvr*Sdotn-Jtilde*pdotn*Sdotv))
    HssTerm2coeff = Jtilde*omegar/(2*exp2mu*expmu*expnu*Btilde*(Q+np.sqrt(Q))*xisq)
    HssTerm1 = omega*SdotSkerrhat
    Hss = HssTerm1+HssTerm2coeff*HssTerm2+HssTerm3coeff*HssTerm3
    HsoTerm2c = Jtilde*Brtilde*expmu*expnu*pdotxir*(np.sqrt(Q)+1)*Sdotv
    HsoTerm2b = expmu*expnu*pdotxir*(2*np.sqrt(Q)+1)*(Jtilde*nur*Sdotv-nucostheta*Sdotn*xisq)*Btilde
    HsoTerm2a = Sdotxi*Jtilde*(mur*pdotvr*(np.sqrt(Q)+1)-mucostheta*pdotn*xisq-np.sqrt(Q)*(nur*pdotvr+(mucostheta-nucostheta)*pdotn*xisq))*Btilde*Btilde
    HsoTerm2 = HsoTerm2a+HsoTerm2b-HsoTerm2c
    HsoTerm2coeff = expnu/(exp2mu*Btilde*Btilde*(Q+np.sqrt(Q))*xisq)
    HsoTerm1 = exp2nu*(expmu*expnu-Btilde)*pdotxir*SdotSkerrhat/(expmu*Btilde*Btilde*np.sqrt(Q)*xisq)
    Hso = HsoTerm1+HsoTerm2coeff*HsoTerm2
    Hd = Hdcoeff*Hdsum
    Hns = betapsum+alpha*np.sqrt(Hnsradicand)
    Hs = Hso+Hss
    dSS = 8.127-154.2*eta+830.8*eta*eta
    Heff = Hs+Hns-Hd+dSS*eta*u*u*u*u*(S1x*S1x+S1y*S1y+S1z*S1z+S2x*S2x+S2y*S2y+S2z*S2z)
    sigmastar3prm_S2z = m1/m2
    sigma3prm_S2z = 1
    Skerr3prm_S2z = sigma3prm_S2z
    Skerrmagprm_S2z = Skerr3*Skerr3prm_S2z/np.sqrt(Skerr1**2 + Skerr2**2 + Skerr3**2)
    Skerrhat3prm_S2z = -Skerr3*Skerrmagprm_S2z/Skerrmag**2 + Skerr3prm_S2z/Skerrmag
    Skerrhat2prm_S2z = -Skerr2*Skerrmagprm_S2z/Skerrmag**2
    Skerrhat1prm_S2z = -Skerr1*Skerrmagprm_S2z/Skerrmag**2
    aprm_S2z = Skerrmagprm_S2z
    e33prm_S2z = Skerrhat3prm_S2z
    e32prm_S2z = Skerrhat2prm_S2z
    e31prm_S2z = Skerrhat1prm_S2z
    xi3prm_S2z = e31prm_S2z*n2 - e32prm_S2z*n1
    xi2prm_S2z = -e31prm_S2z*n3 + e33prm_S2z*n1
    xi1prm_S2z = e32prm_S2z*n3 - e33prm_S2z*n2
    v3prm_S2z = n1*xi2prm_S2z - n2*xi1prm_S2z
    v2prm_S2z = -n1*xi3prm_S2z + n3*xi1prm_S2z
    v1prm_S2z = n2*xi3prm_S2z - n3*xi2prm_S2z
    costhetaprm_S2z = e31prm_S2z*n1 + e32prm_S2z*n2 + e33prm_S2z*n3
    sin2thetaprm_S2z = -2*costheta*costhetaprm_S2z
    xisqprm_S2z = sin2thetaprm_S2z
    w2prm_S2z = 2*a*aprm_S2z
    Sigmaprm_S2z = 2*a**2*costheta*costhetaprm_S2z + 2*a*aprm_S2z*costheta**2
    omegatildeprm_S2z = 2*aprm_S2z*r
    Delta2prm_S2z = -2*Delta0*a*aprm_S2z*etaKminus1**2
    Delta3prm_S2z = Delta1*Delta2prm_S2z - 2*Delta1*a*aprm_S2z*etaKminus1**2 - 2*Delta2prm_S2z*etaKminus1
    Delta4prm_S2z = -Delta1**2*Delta2prm_S2z + Delta1*(2*Delta2prm_S2z*etaKminus1 + Delta3prm_S2z) + Delta2*Delta2prm_S2z - Delta2prm_S2z*a**2*etaKminus1**2 - 2*Delta3prm_S2z*etaKminus1 + a*aprm_S2z*etaKminus1**2*(Delta1**2 - 2*Delta2)
    Delta5prm_S2z = etaKminus1**2*(-a**2*(-3*Delta1*Delta2prm_S2z + 3*Delta3prm_S2z)/3 + a*aprm_S2z*(-2*Delta1**3 + 6*Delta1*Delta2 - 6*Delta3)/3 + (-4*Delta1**2*Delta2prm_S2z + 4*Delta1*Delta3prm_S2z + 4*Delta2*Delta2prm_S2z - 4*Delta4prm_S2z)/(2*etaKminus1) - (-5*Delta1**3*Delta2prm_S2z + 5*Delta1**2*Delta3prm_S2z + 10*Delta1*Delta2*Delta2prm_S2z - 5*Delta1*Delta4prm_S2z - 5*Delta2*Delta3prm_S2z - 5*Delta2prm_S2z*Delta3)/(5*etaKminus1**2))
    logargprm_S2z = u**2*(Delta2prm_S2z + u*(Delta3prm_S2z + u*(Delta4prm_S2z + Delta5prm_S2z*u)))
    Deltaucalibprm_S2z = eta*logargprm_S2z/(logarg + 1)
    Deltaucalibprimeprm_S2z = eta*logargprm_S2z*u**2*(Delta1 + u*(2*Delta2 + u*(3*Delta3 + u*(4*Delta4 + u*(5*Delta5 + 5*Delta5l*np.log(u))))))/(logarg + 1)**2 - eta*u**3*(2*Delta2prm_S2z + u*(3*Delta3prm_S2z + u*(4*Delta4prm_S2z + 5*Delta5prm_S2z*u)))/(logarg + 1)
    Deltaubarprm_S2z = 2*a*aprm_S2z*u**2
    Deltaubarprimeprm_S2z = -4*a*aprm_S2z*u**3
    Deltauprm_S2z = Deltaubar*Deltaucalibprm_S2z + Deltaubarprm_S2z*Deltaucalib
    Deltauprimeprm_S2z = Deltaubar*Deltaucalibprimeprm_S2z + Deltaubarprime*Deltaucalibprm_S2z + Deltaubarprimeprm_S2z*Deltaucalib + Deltaubarprm_S2z*Deltaucalibprime
    Deltatprimeprm_S2z = Deltauprimeprm_S2z*r**2 + 2*Deltauprm_S2z*r
    Deltatprm_S2z = Deltauprm_S2z*r**2
    Deltarprm_S2z = Deltatprm_S2z*Dinv
    Lambtprm_S2z = -Deltat*a**2*sin2thetaprm_S2z - 2*Deltat*a*aprm_S2z*sin2theta - Deltatprm_S2z*a**2*sin2theta + 2*w2*w2prm_S2z
    csiprm_S2z = -w2prm_S2z*np.sqrt(Deltar*Deltat)/w2**2 + np.sqrt(Deltar*Deltat)*(Deltar*Deltatprm_S2z/2 + Deltarprm_S2z*Deltat/2)/(Deltar*Deltat*w2)
    csi1prm_S2z = csiprm_S2z*(1 - abs(1 - tortoise))
    csi2prm_S2z = csiprm_S2z*(1/2 - np.sign(3/2 - tortoise)/2)
    prTprm_S2z = csi2prm_S2z*(n1*p1 + n2*p2 + n3*p3)
    phat3prm_S2z = n3*prTprm_S2z*(1 - 1/csi1) + csi1prm_S2z*n3*prT/csi1**2
    phat2prm_S2z = n2*prTprm_S2z*(1 - 1/csi1) + csi1prm_S2z*n2*prT/csi1**2
    phat1prm_S2z = n1*prTprm_S2z*(1 - 1/csi1) + csi1prm_S2z*n1*prT/csi1**2
    pdotxirprm_S2z = r*(phat1*xi1prm_S2z + phat1prm_S2z*xi1 + phat2*xi2prm_S2z + phat2prm_S2z*xi2 + phat3*xi3prm_S2z + phat3prm_S2z*xi3)
    pdotnprm_S2z = n1*phat1prm_S2z + n2*phat2prm_S2z + n3*phat3prm_S2z
    pdotvrprm_S2z = r*(phat1*v1prm_S2z + phat1prm_S2z*v1 + phat2*v2prm_S2z + phat2prm_S2z*v2 + phat3*v3prm_S2z + phat3prm_S2z*v3)
    pphiprm_S2z = pdotxirprm_S2z
    Qcoeff2prm_S2z = -sin2thetaprm_S2z/(Sigma*sin2theta**2) - Sigmaprm_S2z/(Sigma**2*sin2theta)
    Qcoeff1prm_S2z = -Sigma*sin2thetaprm_S2z/(Lambt*sin2theta**2) + Sigmaprm_S2z/(Lambt*sin2theta) - Lambtprm_S2z*Sigma/(Lambt**2*sin2theta)
    DrSipn2prm_S2z = 2*Deltar*pdotn*pdotnprm_S2z/Sigma - Deltar*Sigmaprm_S2z*pdotn**2/Sigma**2 + Deltarprm_S2z*pdotn**2/Sigma
    Qprm_S2z = DrSipn2prm_S2z + 2*Qcoeff1*pdotxir*pdotxirprm_S2z + Qcoeff1prm_S2z*pdotxir**2 + 2*Qcoeff2*pdotvr*pdotvrprm_S2z + Qcoeff2prm_S2z*pdotvr**2
    Qminus1prm_S2z = Qprm_S2z
    Jtildeprm_S2z = Deltarprm_S2z/(2*np.sqrt(Deltar))
    exp2muprm_S2z = Sigmaprm_S2z
    expmuprm_S2z = exp2muprm_S2z/(2*np.sqrt(exp2mu))
    Brtildeprm_S2z = (np.sqrt(Deltar)*Deltatprimeprm_S2z - 2*Deltatprm_S2z + Deltarprm_S2z*Deltatprime/(2*np.sqrt(Deltar)))/(2*np.sqrt(Deltar*Deltat)) + (np.sqrt(Deltar)*Deltatprime - 2*Deltat)*(-Deltar*Deltatprm_S2z/2 - Deltarprm_S2z*Deltat/2)/(2*Deltar*Deltat*np.sqrt(Deltar*Deltat))
    Btildeprm_S2z = Deltatprm_S2z/(2*np.sqrt(Deltat))
    exp2nuprm_S2z = Deltat*Sigmaprm_S2z/Lambt - Deltat*Lambtprm_S2z*Sigma/Lambt**2 + Deltatprm_S2z*Sigma/Lambt
    expnuprm_S2z = exp2nuprm_S2z/(2*np.sqrt(exp2nu))
    omegaprm_S2z = omegatildeprm_S2z/Lambt - Lambtprm_S2z*omegatilde/Lambt**2
    omegatildeprimeprm_S2z = 2*aprm_S2z
    Lambtprimeprm_S2z = -2*Deltatprime*a**2*sin2thetaprm_S2z - 4*Deltatprime*a*aprm_S2z*sin2theta - 2*Deltatprimeprm_S2z*a**2*sin2theta + 8*a*aprm_S2z*r
    mucosthetaprm_S2z = a**2*costhetaprm_S2z/Sigma + 2*a*aprm_S2z*costheta/Sigma - Sigmaprm_S2z*a**2*costheta/Sigma**2
    nucosthetaprm_S2z = a**2*costheta*w2*(-Deltatprm_S2z + w2prm_S2z)/(Lambt*Sigma) + a**2*costheta*w2prm_S2z*(-Deltat + w2)/(Lambt*Sigma) + a**2*costhetaprm_S2z*w2*(-Deltat + w2)/(Lambt*Sigma) + a*aprm_S2z*costheta*w2*(-2*Deltat + 2*w2)/(Lambt*Sigma) - Sigmaprm_S2z*a**2*costheta*w2*(-Deltat + w2)/(Lambt*Sigma**2) - Lambtprm_S2z*a**2*costheta*w2*(-Deltat + w2)/(Lambt**2*Sigma)
    omegacosthetaprm_S2z = -2*Deltat*a**2*costheta*omegatildeprm_S2z/Lambt**2 - 2*Deltat*a**2*costhetaprm_S2z*omegatilde/Lambt**2 - 4*Deltat*a*aprm_S2z*costheta*omegatilde/Lambt**2 + 4*Deltat*Lambtprm_S2z*a**2*costheta*omegatilde/Lambt**3 - 2*Deltatprm_S2z*a**2*costheta*omegatilde/Lambt**2
    murprm_S2z = -Sigmaprm_S2z*r/Sigma**2 + Deltarprm_S2z/(2*Deltar**(3/2))
    nurprm_S2z = -Sigmaprm_S2z*r/Sigma**2 + w2*(Deltatprime*w2prm_S2z + Deltatprimeprm_S2z*w2 - 4*Deltatprm_S2z*r)/(2*Deltat*Lambt) + w2prm_S2z*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt) - Lambtprm_S2z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat*Lambt**2) - Deltatprm_S2z*w2*(-4*Deltat*r + Deltatprime*w2)/(2*Deltat**2*Lambt)
    omegarprm_S2z = (Lambt*omegatildeprimeprm_S2z - Lambtprime*omegatildeprm_S2z - Lambtprimeprm_S2z*omegatilde + Lambtprm_S2z*omegatildeprime)/Lambt**2 + Lambtprm_S2z*(-2*Lambt*omegatildeprime + 2*Lambtprime*omegatilde)/Lambt**3
    sigmacoeffTerm2prm_S2z = eta*(eta*r*(-882*DrSipn2prm_S2z + 204*Qminus1prm_S2z + r*(1620*DrSipn2*DrSipn2prm_S2z - 234*DrSipn2*Qminus1prm_S2z - 234*DrSipn2prm_S2z*Qminus1)) + r*(-96*DrSipn2prm_S2z - 436*Qminus1prm_S2z + r*(36*DrSipn2*Qminus1prm_S2z + 36*DrSipn2prm_S2z*Qminus1 - 90*Qminus1*Qminus1prm_S2z)))/(144*r**2)
    sigmacoeffTerm1prm_S2z = eta*(-36*DrSipn2prm_S2z + 3*Qminus1prm_S2z)/12
    sigmacoeffprm_S2z = sigmacoeffTerm1prm_S2z + sigmacoeffTerm2prm_S2z
    sigmastarcoeffTerm2prm_S2z = eta*(eta*r*(-324*DrSipn2prm_S2z + 120*Qminus1prm_S2z + r*(720*DrSipn2*DrSipn2prm_S2z + Qminus1*(-126*DrSipn2prm_S2z - 3*Qminus1prm_S2z) + Qminus1prm_S2z*(-126*DrSipn2 - 3*Qminus1))) + r*(282*DrSipn2prm_S2z + Qminus1*r*(96*DrSipn2prm_S2z - 23*Qminus1prm_S2z) + Qminus1prm_S2z*r*(96*DrSipn2 - 23*Qminus1) - 206*Qminus1prm_S2z))/(72*r**2)
    sigmastarcoeffTerm1prm_S2z = eta*(-30*DrSipn2prm_S2z + 4*Qminus1prm_S2z)/12
    sigmastarcoeffprm_S2z = sigmastarcoeffTerm1prm_S2z + sigmastarcoeffTerm2prm_S2z
    Deltasigmastar3prm_S2z = sigma3*sigmacoeffprm_S2z + sigma3prm_S2z*sigmacoeff + sigmastar3*sigmastarcoeffprm_S2z + sigmastar3prm_S2z*sigmastarcoeff
    Deltasigmastar2prm_S2z = sigma2*sigmacoeffprm_S2z + sigmastar2*sigmastarcoeffprm_S2z
    Deltasigmastar1prm_S2z = sigma1*sigmacoeffprm_S2z + sigmastar1*sigmastarcoeffprm_S2z
    Sstar3prm_S2z = Deltasigmastar3prm_S2z + sigmastar3prm_S2z
    Sstar2prm_S2z = Deltasigmastar2prm_S2z
    Sstar1prm_S2z = Deltasigmastar1prm_S2z
    S3prm_S2z = Sstar3prm_S2z
    S2prm_S2z = Sstar2prm_S2z
    S1prm_S2z = Sstar1prm_S2z
    Sstardotnprm_S2z = Sstar1prm_S2z*n1 + Sstar2prm_S2z*n2 + Sstar3prm_S2z*n3
    SdotSkerrhatprm_S2z = S1*Skerrhat1prm_S2z + S1prm_S2z*Skerrhat1 + S2*Skerrhat2prm_S2z + S2prm_S2z*Skerrhat2 + S3*Skerrhat3prm_S2z + S3prm_S2z*Skerrhat3
    Sdotnprm_S2z = S1prm_S2z*n1 + S2prm_S2z*n2 + S3prm_S2z*n3
    Sdotvprm_S2z = S1*v1prm_S2z + S1prm_S2z*v1 + S2*v2prm_S2z + S2prm_S2z*v2 + S3*v3prm_S2z + S3prm_S2z*v3
    Sdotxiprm_S2z = S1*xi1prm_S2z + S1prm_S2z*xi1 + S2*xi2prm_S2z + S2prm_S2z*xi2 + S3*xi3prm_S2z + S3prm_S2z*xi3
    HdsumTerm2prm_S2z = 6*Sstardotn*Sstardotnprm_S2z
    HdsumTerm1prm_S2z = 2*Sstar1*Sstar1prm_S2z + 2*Sstar2*Sstar2prm_S2z + 2*Sstar3*Sstar3prm_S2z
    Hdsumprm_S2z = HdsumTerm1prm_S2z - HdsumTerm2prm_S2z
    Q4prm_S2z = 8*eta*prT**3*prTprm_S2z*u**2*(4 - 3*eta)
    gammappsumprm_S2z = 2*Deltar*pdotn*pdotnprm_S2z/Sigma - Deltar*Sigmaprm_S2z*pdotn**2/Sigma**2 + Deltarprm_S2z*pdotn**2/Sigma - pdotvr**2*sin2thetaprm_S2z/(Sigma*sin2theta**2) + 2*pdotvr*pdotvrprm_S2z/(Sigma*sin2theta) - Sigmaprm_S2z*pdotvr**2/(Sigma**2*sin2theta) - Sigma*pdotxir**2*sin2thetaprm_S2z/(Lambt*sin2theta**2) + 2*Sigma*pdotxir*pdotxirprm_S2z/(Lambt*sin2theta) + Sigmaprm_S2z*pdotxir**2/(Lambt*sin2theta) - Lambtprm_S2z*Sigma*pdotxir**2/(Lambt**2*sin2theta)
    Hnsradicandprm_S2z = Q4prm_S2z + gammappsumprm_S2z
    alphaprm_S2z = Lambt*np.sqrt(Deltat*Sigma/Lambt)*(Deltat*Sigmaprm_S2z/(2*Lambt) - Deltat*Lambtprm_S2z*Sigma/(2*Lambt**2) + Deltatprm_S2z*Sigma/(2*Lambt))/(Deltat*Sigma)
    betapsumprm_S2z = omegatilde*pphiprm_S2z/Lambt + omegatildeprm_S2z*pphi/Lambt - Lambtprm_S2z*omegatilde*pphi/Lambt**2
    HssTerm3prm_S2z = Btilde**2*(Sdotn*exp2mu*xisq*(-Qprm_S2z - Qprm_S2z/(2*np.sqrt(Q))) + Sdotn*exp2mu*xisqprm_S2z*(-np.sqrt(Q) - Q) + Sdotn*exp2muprm_S2z*xisq*(-np.sqrt(Q) - Q) + Sdotnprm_S2z*exp2mu*xisq*(-np.sqrt(Q) - Q) + pdotvr*(-Jtilde*Sdotv*pdotnprm_S2z - Jtilde*Sdotvprm_S2z*pdotn - Jtildeprm_S2z*Sdotv*pdotn + Sdotn*pdotvrprm_S2z + Sdotnprm_S2z*pdotvr) + pdotvrprm_S2z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + Btilde*Btildeprm_S2z*(-2*Sdotn*exp2mu*xisq*(np.sqrt(Q) + Q) + 2*pdotvr*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr)) + expmu*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotnprm_S2z + Btilde*Jtilde*Sdotxiprm_S2z*pdotn + Btilde*Jtildeprm_S2z*Sdotxi*pdotn + Btildeprm_S2z*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxirprm_S2z - Sdotn*expmu*expnuprm_S2z*pdotxir - Sdotn*expmuprm_S2z*expnu*pdotxir - Sdotnprm_S2z*expmu*expnu*pdotxir) + expmu*expnu*pdotxirprm_S2z*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmu*expnuprm_S2z*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir) + expmuprm_S2z*expnu*pdotxir*(Btilde*Jtilde*Sdotxi*pdotn - Sdotn*expmu*expnu*pdotxir)
    HssTerm3coeffprm_S2z = omegacostheta*(-Qprm_S2z - Qprm_S2z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*(np.sqrt(Q) + Q)**2) + omegacosthetaprm_S2z/(Btilde*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - expnuprm_S2z*omegacostheta/(Btilde*exp2mu*expmu*expnu**2*(2*np.sqrt(Q) + 2*Q)) - expmuprm_S2z*omegacostheta/(Btilde*exp2mu*expmu**2*expnu*(2*np.sqrt(Q) + 2*Q)) - exp2muprm_S2z*omegacostheta/(Btilde*exp2mu**2*expmu*expnu*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2z*omegacostheta/(Btilde**2*exp2mu*expmu*expnu*(2*np.sqrt(Q) + 2*Q))
    HssTerm2prm_S2z = Btilde**2*xisq*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotnprm_S2z - Jtilde*Sdotvprm_S2z*pdotn - Jtildeprm_S2z*Sdotv*pdotn + Sdotn*pdotvrprm_S2z + Sdotnprm_S2z*pdotvr) + Jtilde*pdotnprm_S2z*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Jtildeprm_S2z*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(Qprm_S2z + Qprm_S2z/(2*np.sqrt(Q))) + Sdotv*exp2muprm_S2z*(np.sqrt(Q) + Q) + Sdotvprm_S2z*exp2mu*(np.sqrt(Q) + Q)) + Btilde**2*xisqprm_S2z*(Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + Sdotv*exp2mu*(np.sqrt(Q) + Q)) + Btilde*Btildeprm_S2z*xisq*(2*Jtilde*pdotn*(-Jtilde*Sdotv*pdotn + Sdotn*pdotvr) + 2*Sdotv*exp2mu*(np.sqrt(Q) + Q)) + expmu*pdotxir*(-Btilde*Sdotxi*expnu*pdotvrprm_S2z - Btilde*Sdotxi*expnuprm_S2z*pdotvr - Btilde*Sdotxiprm_S2z*expnu*pdotvr - Btildeprm_S2z*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxirprm_S2z + Sdotv*exp2nu*expmuprm_S2z*pdotxir + Sdotv*exp2nuprm_S2z*expmu*pdotxir + Sdotvprm_S2z*exp2nu*expmu*pdotxir) + expmu*pdotxirprm_S2z*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir) + expmuprm_S2z*pdotxir*(-Btilde*Sdotxi*expnu*pdotvr + Sdotv*exp2nu*expmu*pdotxir)
    HssTerm2coeffprm_S2z = Jtilde*omegar*(-Qprm_S2z - Qprm_S2z/(2*np.sqrt(Q)))/(2*Btilde*exp2mu*expmu*expnu*xisq*(np.sqrt(Q) + Q)**2) - Jtilde*omegar*xisqprm_S2z/(Btilde*exp2mu*expmu*expnu*xisq**2*(2*np.sqrt(Q) + 2*Q)) + Jtilde*omegarprm_S2z/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expnuprm_S2z*omegar/(Btilde*exp2mu*expmu*expnu**2*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*expmuprm_S2z*omegar/(Btilde*exp2mu*expmu**2*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Jtilde*exp2muprm_S2z*omegar/(Btilde*exp2mu**2*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) + Jtildeprm_S2z*omegar/(Btilde*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q)) - Btildeprm_S2z*Jtilde*omegar/(Btilde**2*exp2mu*expmu*expnu*xisq*(2*np.sqrt(Q) + 2*Q))
    HssTerm1prm_S2z = SdotSkerrhat*omegaprm_S2z + SdotSkerrhatprm_S2z*omega
    Hssprm_S2z = HssTerm1prm_S2z + HssTerm2*HssTerm2coeffprm_S2z + HssTerm2coeff*HssTerm2prm_S2z + HssTerm3*HssTerm3coeffprm_S2z + HssTerm3coeff*HssTerm3prm_S2z
    HsoTerm2cprm_S2z = Brtilde*Jtilde*Sdotv*expmu*expnu*pdotxirprm_S2z*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmu*expnuprm_S2z*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotv*expmuprm_S2z*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Sdotvprm_S2z*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtilde*Jtilde*Qprm_S2z*Sdotv*expmu*expnu*pdotxir/(2*np.sqrt(Q)) + Brtilde*Jtildeprm_S2z*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1) + Brtildeprm_S2z*Jtilde*Sdotv*expmu*expnu*pdotxir*(np.sqrt(Q) + 1)
    HsoTerm2bprm_S2z = Btilde*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nurprm_S2z + Jtilde*Sdotvprm_S2z*nur + Jtildeprm_S2z*Sdotv*nur - Sdotn*nucostheta*xisqprm_S2z - Sdotn*nucosthetaprm_S2z*xisq - Sdotnprm_S2z*nucostheta*xisq) + Btilde*expmu*expnu*pdotxirprm_S2z*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmu*expnuprm_S2z*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*expmuprm_S2z*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq) + Btilde*Qprm_S2z*expmu*expnu*pdotxir*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)/np.sqrt(Q) + Btildeprm_S2z*expmu*expnu*pdotxir*(2*np.sqrt(Q) + 1)*(Jtilde*Sdotv*nur - Sdotn*nucostheta*xisq)
    HsoTerm2aprm_S2z = Btilde**2*Jtilde*Sdotxi*(-np.sqrt(Q)*(nur*pdotvrprm_S2z + nurprm_S2z*pdotvr + pdotn*xisq*(mucosthetaprm_S2z - nucosthetaprm_S2z) + pdotn*xisqprm_S2z*(mucostheta - nucostheta) + pdotnprm_S2z*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisqprm_S2z - mucostheta*pdotnprm_S2z*xisq - mucosthetaprm_S2z*pdotn*xisq + mur*pdotvrprm_S2z*(np.sqrt(Q) + 1) + murprm_S2z*pdotvr*(np.sqrt(Q) + 1) + Qprm_S2z*mur*pdotvr/(2*np.sqrt(Q)) + Qprm_S2z*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta))/(2*np.sqrt(Q))) + Btilde**2*Jtilde*Sdotxiprm_S2z*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde**2*Jtildeprm_S2z*Sdotxi*(np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - mucostheta*pdotn*xisq + mur*pdotvr*(np.sqrt(Q) + 1)) + Btilde*Btildeprm_S2z*Jtilde*Sdotxi*(2*np.sqrt(Q)*(-nur*pdotvr - pdotn*xisq*(mucostheta - nucostheta)) - 2*mucostheta*pdotn*xisq + 2*mur*pdotvr*(np.sqrt(Q) + 1))
    HsoTerm2prm_S2z = HsoTerm2aprm_S2z + HsoTerm2bprm_S2z - HsoTerm2cprm_S2z
    HsoTerm2coeffprm_S2z = expnu*(-Qprm_S2z - Qprm_S2z/(2*np.sqrt(Q)))/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)**2) - expnu*xisqprm_S2z/(Btilde**2*exp2mu*xisq**2*(np.sqrt(Q) + Q)) + expnuprm_S2z/(Btilde**2*exp2mu*xisq*(np.sqrt(Q) + Q)) - exp2muprm_S2z*expnu/(Btilde**2*exp2mu**2*xisq*(np.sqrt(Q) + Q)) - 2*Btildeprm_S2z*expnu/(Btilde**3*exp2mu*xisq*(np.sqrt(Q) + Q))
    HsoTerm1prm_S2z = SdotSkerrhat*exp2nu*pdotxir*(-Btildeprm_S2z + expmu*expnuprm_S2z + expmuprm_S2z*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhat*exp2nu*pdotxir*xisqprm_S2z*(Btilde - expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq**2) + SdotSkerrhat*exp2nu*pdotxirprm_S2z*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - SdotSkerrhat*exp2nu*expmuprm_S2z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu**2*xisq) + SdotSkerrhat*exp2nuprm_S2z*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) + SdotSkerrhatprm_S2z*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(Btilde**2*np.sqrt(Q)*expmu*xisq) - Qprm_S2z*SdotSkerrhat*exp2nu*pdotxir*(-Btilde + expmu*expnu)/(2*Btilde**2*Q**(3/2)*expmu*xisq) - Btildeprm_S2z*SdotSkerrhat*exp2nu*pdotxir*(-2*Btilde + 2*expmu*expnu)/(Btilde**3*np.sqrt(Q)*expmu*xisq)
    Hsoprm_S2z = HsoTerm1prm_S2z + HsoTerm2*HsoTerm2coeffprm_S2z + HsoTerm2coeff*HsoTerm2prm_S2z
    Hdprm_S2z = Hdcoeff*Hdsumprm_S2z
    Hnsprm_S2z = np.sqrt(Hnsradicand)*alphaprm_S2z + betapsumprm_S2z + Hnsradicandprm_S2z*alpha/(2*np.sqrt(Hnsradicand))
    Hsprm_S2z = Hsoprm_S2z + Hssprm_S2z
    Heffprm_S2z = -Hdprm_S2z + Hnsprm_S2z + Hsprm_S2z + 2*S2z*dSS*eta*u**4
    Hrealprm_S2z = Heffprm_S2z*eta/np.sqrt(2*eta*(Heff - 1) + 1)
    return np.array([Hrealprm_S2z])
def compute_Hreal_and_csi_derivatives(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z):
    dHdx = new_compute_dHdx(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdy = new_compute_dHdy(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdz = new_compute_dHdz(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdpx = new_compute_dHdp1(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdpy = new_compute_dHdp2(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdpz = new_compute_dHdp3(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS1x = new_compute_dHdS1x(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS1y = new_compute_dHdS1y(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS1z = new_compute_dHdS1z(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS2x = new_compute_dHdS2x(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS2y = new_compute_dHdS2y(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    dHdS2z = new_compute_dHdS2z(m1, m2, EMgamma, tortoise, x, y, z, p1, p2, p3, S1x, S1y, S1z, S2x, S2y, S2z)
    return np.array([dHdx[0],dHdy[0],dHdz[0],dHdpx[0],dHdpy[0],dHdpz[0],dHdS1x[0],dHdS1y[0],dHdS1z[0],dHdS2x[0],dHdS2y[0],dHdS2z[0],dHdx[1],dHdy[1],dHdz[1]])
